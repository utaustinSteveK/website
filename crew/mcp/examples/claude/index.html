<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Comprehensive developer documentation for the Crew Management Backend API"><meta name=author content="Development Team"><link href=https://api-docs.crewing.example.com/mcp/examples/claude/ rel=canonical><link href=../openai/ rel=prev><link href=../../../models/ rel=next><link rel=icon href=../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.20"><title>Claude Integration - Crew Management API Documentation</title><link rel=stylesheet href=../../../assets/stylesheets/main.e53b48f4.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../assets/_mkdocstrings.css><link rel=stylesheet href=../../../stylesheets/custom.css><link rel=stylesheet href=../../../stylesheets/api-docs.css><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config",""),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>if("undefined"!=typeof __md_analytics){var consent=__md_get("__consent");consent&&consent.analytics&&__md_analytics()}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#claude-integration-examples class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../.. title="Crew Management API Documentation" class="md-header__button md-logo" aria-label="Crew Management API Documentation" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M7 7H5a2 2 0 0 0-2 2v8h2v-4h2v4h2V9a2 2 0 0 0-2-2m0 4H5V9h2m7-2h-4v10h2v-4h2a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2m0 4h-2V9h2m6 0v6h1v2h-4v-2h1V9h-1V7h4v2Z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Crew Management API Documentation </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Claude Integration </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media=(prefers-color-scheme) data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4a5 5 0 0 0 5-5 5 5 0 0 0-5-5"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=black data-md-color-accent=indigo aria-label="Switch to system preference" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to system preference" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5M7 15a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/example/crewing-backend title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> crewing-backend </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../../getting-started/ class=md-tabs__link> Getting Started </a> </li> <li class=md-tabs__item> <a href=../../../api/ class=md-tabs__link> API Reference </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../../ class=md-tabs__link> MCP Tools </a> </li> <li class=md-tabs__item> <a href=../../../models/ class=md-tabs__link> Data Models </a> </li> <li class=md-tabs__item> <a href=../../../testing/ class=md-tabs__link> Testing </a> </li> <li class=md-tabs__item> <a href=../../../deployment/ class=md-tabs__link> Deployment </a> </li> <li class=md-tabs__item> <a href=../../../architecture/ class=md-tabs__link> Architecture </a> </li> <li class=md-tabs__item> <a href=../../../reference/errors/ class=md-tabs__link> Reference </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title="Crew Management API Documentation" class="md-nav__button md-logo" aria-label="Crew Management API Documentation" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M7 7H5a2 2 0 0 0-2 2v8h2v-4h2v4h2V9a2 2 0 0 0-2-2m0 4H5V9h2m7-2h-4v10h2v-4h2a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2m0 4h-2V9h2m6 0v6h1v2h-4v-2h1V9h-1V7h4v2Z"/></svg> </a> Crew Management API Documentation </label> <div class=md-nav__source> <a href=https://github.com/example/crewing-backend title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> crewing-backend </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../getting-started/ class=md-nav__link> <span class=md-ellipsis> Getting Started </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../api/ class=md-nav__link> <span class=md-ellipsis> API Reference </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4 checked> <div class="md-nav__link md-nav__container"> <a href=../../ class="md-nav__link "> <span class=md-ellipsis> MCP Tools </span> </a> <label class="md-nav__link " for=__nav_4 id=__nav_4_label tabindex> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=true> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> MCP Tools </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4_2> <label class=md-nav__link for=__nav_4_2 id=__nav_4_2_label tabindex> <span class=md-ellipsis> Tools </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_2_label aria-expanded=false> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> Tools </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../tools/search-crew/ class=md-nav__link> <span class=md-ellipsis> search_crew </span> </a> </li> <li class=md-nav__item> <a href=../../tools/create-appraisal/ class=md-nav__link> <span class=md-ellipsis> create_appraisal </span> </a> </li> <li class=md-nav__item> <a href=../../tools/check-certificates/ class=md-nav__link> <span class=md-ellipsis> check_certificates </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_3 checked> <label class=md-nav__link for=__nav_4_3 id=__nav_4_3_label tabindex> <span class=md-ellipsis> LLM Examples </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_3_label aria-expanded=true> <label class=md-nav__title for=__nav_4_3> <span class="md-nav__icon md-icon"></span> LLM Examples </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../openai/ class=md-nav__link> <span class=md-ellipsis> OpenAI Integration </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Claude Integration </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Claude Integration </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#overview class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=#prerequisites class=md-nav__link> <span class=md-ellipsis> Prerequisites </span> </a> <nav class=md-nav aria-label=Prerequisites> <ul class=md-nav__list> <li class=md-nav__item> <a href=#required-dependencies class=md-nav__link> <span class=md-ellipsis> Required Dependencies </span> </a> </li> <li class=md-nav__item> <a href=#environment-setup class=md-nav__link> <span class=md-ellipsis> Environment Setup </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#basic-setup class=md-nav__link> <span class=md-ellipsis> Basic Setup </span> </a> <nav class=md-nav aria-label="Basic Setup"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#client-configuration class=md-nav__link> <span class=md-ellipsis> Client Configuration </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#claude-tool-definitions class=md-nav__link> <span class=md-ellipsis> Claude Tool Definitions </span> </a> <nav class=md-nav aria-label="Claude Tool Definitions"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#complete-claude-tool-schemas class=md-nav__link> <span class=md-ellipsis> Complete Claude Tool Schemas </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#basic-examples class=md-nav__link> <span class=md-ellipsis> Basic Examples </span> </a> <nav class=md-nav aria-label="Basic Examples"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-simple-crew-search-with-claude class=md-nav__link> <span class=md-ellipsis> 1. Simple Crew Search with Claude </span> </a> </li> <li class=md-nav__item> <a href=#2-multi-tool-compliance-analysis class=md-nav__link> <span class=md-ellipsis> 2. Multi-Tool Compliance Analysis </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#advanced-conversational-patterns class=md-nav__link> <span class=md-ellipsis> Advanced Conversational Patterns </span> </a> <nav class=md-nav aria-label="Advanced Conversational Patterns"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#multi-turn-crew-management-conversation class=md-nav__link> <span class=md-ellipsis> Multi-Turn Crew Management Conversation </span> </a> </li> <li class=md-nav__item> <a href=#intelligent-crew-planning-assistant class=md-nav__link> <span class=md-ellipsis> Intelligent Crew Planning Assistant </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#claude-specific-optimizations class=md-nav__link> <span class=md-ellipsis> Claude-Specific Optimizations </span> </a> <nav class=md-nav aria-label="Claude-Specific Optimizations"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#leveraging-claudes-reasoning-capabilities class=md-nav__link> <span class=md-ellipsis> Leveraging Claude's Reasoning Capabilities </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#error-handling-and-resilience class=md-nav__link> <span class=md-ellipsis> Error Handling and Resilience </span> </a> <nav class=md-nav aria-label="Error Handling and Resilience"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#robust-error-handling-for-claude-integration class=md-nav__link> <span class=md-ellipsis> Robust Error Handling for Claude Integration </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#performance-optimization class=md-nav__link> <span class=md-ellipsis> Performance Optimization </span> </a> <nav class=md-nav aria-label="Performance Optimization"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#efficient-claude-integration-patterns class=md-nav__link> <span class=md-ellipsis> Efficient Claude Integration Patterns </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#testing-claude-integration class=md-nav__link> <span class=md-ellipsis> Testing Claude Integration </span> </a> <nav class=md-nav aria-label="Testing Claude Integration"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#comprehensive-test-suite class=md-nav__link> <span class=md-ellipsis> Comprehensive Test Suite </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../models/ class=md-nav__link> <span class=md-ellipsis> Data Models </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../testing/ class=md-nav__link> <span class=md-ellipsis> Testing </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../deployment/ class=md-nav__link> <span class=md-ellipsis> Deployment </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../architecture/ class=md-nav__link> <span class=md-ellipsis> Architecture </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../reference/errors/ class=md-nav__link> <span class=md-ellipsis> Reference </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/example/crewing-backend/edit/master/docs/mcp/examples/claude.md title="Edit this page" class="md-content__button md-icon" rel=edit> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75z"/></svg> </a> <a href=https://github.com/example/crewing-backend/raw/master/docs/mcp/examples/claude.md title="View source of this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0 8a5 5 0 0 1-5-5 5 5 0 0 1 5-5 5 5 0 0 1 5 5 5 5 0 0 1-5 5m0-12.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5"/></svg> </a> <h1 id=claude-integration-examples>Claude Integration Examples<a class=headerlink href=#claude-integration-examples title="Anchor link to this section for reference">&para;</a></h1> <h2 id=overview>Overview<a class=headerlink href=#overview title="Anchor link to this section for reference">&para;</a></h2> <p>This guide demonstrates how to integrate the Crew Appraisals MCP tools with Anthropic's Claude using tool use (function calling). The examples show both basic usage and advanced conversational patterns optimized for Claude's capabilities.</p> <h2 id=prerequisites>Prerequisites<a class=headerlink href=#prerequisites title="Anchor link to this section for reference">&para;</a></h2> <h3 id=required-dependencies>Required Dependencies<a class=headerlink href=#required-dependencies title="Anchor link to this section for reference">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a>pip<span class=w> </span>install<span class=w> </span>anthropic<span class=w> </span>requests<span class=w> </span>python-dotenv
</span></code></pre></div> <h3 id=environment-setup>Environment Setup<a class=headerlink href=#environment-setup title="Anchor link to this section for reference">&para;</a></h3> <p>Create a <code>.env</code> file with your configuration:</p> <div class="language-text highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a>ANTHROPIC_API_KEY=your_claude_api_key_here
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>MCP_BASE_URL=https://api.crew-appraisals.com/mcp
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a>MCP_API_KEY=your_mcp_api_key_here
</span></code></pre></div> <h2 id=basic-setup>Basic Setup<a class=headerlink href=#basic-setup title="Anchor link to this section for reference">&para;</a></h2> <h3 id=client-configuration>Client Configuration<a class=headerlink href=#client-configuration title="Anchor link to this section for reference">&para;</a></h3> <div class="language-python highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=kn>import</span><span class=w> </span><span class=nn>os</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=kn>import</span><span class=w> </span><span class=nn>json</span>
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=kn>import</span><span class=w> </span><span class=nn>requests</span>
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a><span class=kn>from</span><span class=w> </span><span class=nn>anthropic</span><span class=w> </span><span class=kn>import</span> <span class=n>Anthropic</span>
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a><span class=kn>from</span><span class=w> </span><span class=nn>typing</span><span class=w> </span><span class=kn>import</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>List</span><span class=p>,</span> <span class=n>Any</span><span class=p>,</span> <span class=n>Optional</span>
</span><span id=__span-2-6><a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a><span class=kn>from</span><span class=w> </span><span class=nn>dotenv</span><span class=w> </span><span class=kn>import</span> <span class=n>load_dotenv</span>
</span><span id=__span-2-7><a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a>
</span><span id=__span-2-8><a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a><span class=n>load_dotenv</span><span class=p>()</span>
</span><span id=__span-2-9><a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a>
</span><span id=__span-2-10><a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a><span class=k>class</span><span class=w> </span><span class=nc>CrewMCPClaudeClient</span><span class=p>:</span>
</span><span id=__span-2-11><a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Client for integrating Crew Appraisals MCP tools with Claude&quot;&quot;&quot;</span>
</span><span id=__span-2-12><a id=__codelineno-2-12 name=__codelineno-2-12 href=#__codelineno-2-12></a>
</span><span id=__span-2-13><a id=__codelineno-2-13 name=__codelineno-2-13 href=#__codelineno-2-13></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-2-14><a id=__codelineno-2-14 name=__codelineno-2-14 href=#__codelineno-2-14></a>        <span class=bp>self</span><span class=o>.</span><span class=n>claude_client</span> <span class=o>=</span> <span class=n>Anthropic</span><span class=p>(</span><span class=n>api_key</span><span class=o>=</span><span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>&quot;ANTHROPIC_API_KEY&quot;</span><span class=p>))</span>
</span><span id=__span-2-15><a id=__codelineno-2-15 name=__codelineno-2-15 href=#__codelineno-2-15></a>        <span class=bp>self</span><span class=o>.</span><span class=n>mcp_base_url</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>&quot;MCP_BASE_URL&quot;</span><span class=p>)</span>
</span><span id=__span-2-16><a id=__codelineno-2-16 name=__codelineno-2-16 href=#__codelineno-2-16></a>        <span class=bp>self</span><span class=o>.</span><span class=n>mcp_api_key</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>&quot;MCP_API_KEY&quot;</span><span class=p>)</span>
</span><span id=__span-2-17><a id=__codelineno-2-17 name=__codelineno-2-17 href=#__codelineno-2-17></a>        <span class=bp>self</span><span class=o>.</span><span class=n>tools</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_load_claude_tools</span><span class=p>()</span>
</span><span id=__span-2-18><a id=__codelineno-2-18 name=__codelineno-2-18 href=#__codelineno-2-18></a>
</span><span id=__span-2-19><a id=__codelineno-2-19 name=__codelineno-2-19 href=#__codelineno-2-19></a>    <span class=k>def</span><span class=w> </span><span class=nf>_load_claude_tools</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>]:</span>
</span><span id=__span-2-20><a id=__codelineno-2-20 name=__codelineno-2-20 href=#__codelineno-2-20></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Load MCP tools and convert to Claude tool use format&quot;&quot;&quot;</span>
</span><span id=__span-2-21><a id=__codelineno-2-21 name=__codelineno-2-21 href=#__codelineno-2-21></a>        <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
</span><span id=__span-2-22><a id=__codelineno-2-22 name=__codelineno-2-22 href=#__codelineno-2-22></a>            <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>mcp_base_url</span><span class=si>}</span><span class=s2>/tools&quot;</span><span class=p>,</span>
</span><span id=__span-2-23><a id=__codelineno-2-23 name=__codelineno-2-23 href=#__codelineno-2-23></a>            <span class=n>headers</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;Authorization&quot;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&quot;Bearer </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>mcp_api_key</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>}</span>
</span><span id=__span-2-24><a id=__codelineno-2-24 name=__codelineno-2-24 href=#__codelineno-2-24></a>        <span class=p>)</span>
</span><span id=__span-2-25><a id=__codelineno-2-25 name=__codelineno-2-25 href=#__codelineno-2-25></a>        <span class=n>mcp_tools</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()[</span><span class=s2>&quot;tools&quot;</span><span class=p>]</span>
</span><span id=__span-2-26><a id=__codelineno-2-26 name=__codelineno-2-26 href=#__codelineno-2-26></a>
</span><span id=__span-2-27><a id=__codelineno-2-27 name=__codelineno-2-27 href=#__codelineno-2-27></a>        <span class=c1># Convert MCP tool schema to Claude tool use format</span>
</span><span id=__span-2-28><a id=__codelineno-2-28 name=__codelineno-2-28 href=#__codelineno-2-28></a>        <span class=n>claude_tools</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-2-29><a id=__codelineno-2-29 name=__codelineno-2-29 href=#__codelineno-2-29></a>        <span class=k>for</span> <span class=n>tool</span> <span class=ow>in</span> <span class=n>mcp_tools</span><span class=p>:</span>
</span><span id=__span-2-30><a id=__codelineno-2-30 name=__codelineno-2-30 href=#__codelineno-2-30></a>            <span class=n>claude_tools</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span><span id=__span-2-31><a id=__codelineno-2-31 name=__codelineno-2-31 href=#__codelineno-2-31></a>                <span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=n>tool</span><span class=p>[</span><span class=s2>&quot;name&quot;</span><span class=p>],</span>
</span><span id=__span-2-32><a id=__codelineno-2-32 name=__codelineno-2-32 href=#__codelineno-2-32></a>                <span class=s2>&quot;description&quot;</span><span class=p>:</span> <span class=n>tool</span><span class=p>[</span><span class=s2>&quot;description&quot;</span><span class=p>],</span>
</span><span id=__span-2-33><a id=__codelineno-2-33 name=__codelineno-2-33 href=#__codelineno-2-33></a>                <span class=s2>&quot;input_schema&quot;</span><span class=p>:</span> <span class=n>tool</span><span class=p>[</span><span class=s2>&quot;parameters&quot;</span><span class=p>]</span>
</span><span id=__span-2-34><a id=__codelineno-2-34 name=__codelineno-2-34 href=#__codelineno-2-34></a>            <span class=p>})</span>
</span><span id=__span-2-35><a id=__codelineno-2-35 name=__codelineno-2-35 href=#__codelineno-2-35></a>
</span><span id=__span-2-36><a id=__codelineno-2-36 name=__codelineno-2-36 href=#__codelineno-2-36></a>        <span class=k>return</span> <span class=n>claude_tools</span>
</span><span id=__span-2-37><a id=__codelineno-2-37 name=__codelineno-2-37 href=#__codelineno-2-37></a>
</span><span id=__span-2-38><a id=__codelineno-2-38 name=__codelineno-2-38 href=#__codelineno-2-38></a>    <span class=k>def</span><span class=w> </span><span class=nf>execute_tool</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>tool_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>parameters</span><span class=p>:</span> <span class=n>Dict</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>:</span>
</span><span id=__span-2-39><a id=__codelineno-2-39 name=__codelineno-2-39 href=#__codelineno-2-39></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Execute an MCP tool&quot;&quot;&quot;</span>
</span><span id=__span-2-40><a id=__codelineno-2-40 name=__codelineno-2-40 href=#__codelineno-2-40></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-2-41><a id=__codelineno-2-41 name=__codelineno-2-41 href=#__codelineno-2-41></a>            <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span>
</span><span id=__span-2-42><a id=__codelineno-2-42 name=__codelineno-2-42 href=#__codelineno-2-42></a>                <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>mcp_base_url</span><span class=si>}</span><span class=s2>/execute&quot;</span><span class=p>,</span>
</span><span id=__span-2-43><a id=__codelineno-2-43 name=__codelineno-2-43 href=#__codelineno-2-43></a>                <span class=n>headers</span><span class=o>=</span><span class=p>{</span>
</span><span id=__span-2-44><a id=__codelineno-2-44 name=__codelineno-2-44 href=#__codelineno-2-44></a>                    <span class=s2>&quot;Authorization&quot;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&quot;Bearer </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>mcp_api_key</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
</span><span id=__span-2-45><a id=__codelineno-2-45 name=__codelineno-2-45 href=#__codelineno-2-45></a>                    <span class=s2>&quot;Content-Type&quot;</span><span class=p>:</span> <span class=s2>&quot;application/json&quot;</span>
</span><span id=__span-2-46><a id=__codelineno-2-46 name=__codelineno-2-46 href=#__codelineno-2-46></a>                <span class=p>},</span>
</span><span id=__span-2-47><a id=__codelineno-2-47 name=__codelineno-2-47 href=#__codelineno-2-47></a>                <span class=n>json</span><span class=o>=</span><span class=p>{</span>
</span><span id=__span-2-48><a id=__codelineno-2-48 name=__codelineno-2-48 href=#__codelineno-2-48></a>                    <span class=s2>&quot;tool&quot;</span><span class=p>:</span> <span class=n>tool_name</span><span class=p>,</span>
</span><span id=__span-2-49><a id=__codelineno-2-49 name=__codelineno-2-49 href=#__codelineno-2-49></a>                    <span class=s2>&quot;parameters&quot;</span><span class=p>:</span> <span class=n>parameters</span>
</span><span id=__span-2-50><a id=__codelineno-2-50 name=__codelineno-2-50 href=#__codelineno-2-50></a>                <span class=p>}</span>
</span><span id=__span-2-51><a id=__codelineno-2-51 name=__codelineno-2-51 href=#__codelineno-2-51></a>            <span class=p>)</span>
</span><span id=__span-2-52><a id=__codelineno-2-52 name=__codelineno-2-52 href=#__codelineno-2-52></a>            <span class=n>response</span><span class=o>.</span><span class=n>raise_for_status</span><span class=p>()</span>
</span><span id=__span-2-53><a id=__codelineno-2-53 name=__codelineno-2-53 href=#__codelineno-2-53></a>            <span class=k>return</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span><span id=__span-2-54><a id=__codelineno-2-54 name=__codelineno-2-54 href=#__codelineno-2-54></a>        <span class=k>except</span> <span class=n>requests</span><span class=o>.</span><span class=n>exceptions</span><span class=o>.</span><span class=n>RequestException</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-2-55><a id=__codelineno-2-55 name=__codelineno-2-55 href=#__codelineno-2-55></a>            <span class=k>return</span> <span class=p>{</span>
</span><span id=__span-2-56><a id=__codelineno-2-56 name=__codelineno-2-56 href=#__codelineno-2-56></a>                <span class=s2>&quot;error&quot;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&quot;Failed to execute tool </span><span class=si>{</span><span class=n>tool_name</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
</span><span id=__span-2-57><a id=__codelineno-2-57 name=__codelineno-2-57 href=#__codelineno-2-57></a>                <span class=s2>&quot;success&quot;</span><span class=p>:</span> <span class=kc>False</span>
</span><span id=__span-2-58><a id=__codelineno-2-58 name=__codelineno-2-58 href=#__codelineno-2-58></a>            <span class=p>}</span>
</span><span id=__span-2-59><a id=__codelineno-2-59 name=__codelineno-2-59 href=#__codelineno-2-59></a>
</span><span id=__span-2-60><a id=__codelineno-2-60 name=__codelineno-2-60 href=#__codelineno-2-60></a>    <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>process_tool_calls</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>tool_calls</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>]:</span>
</span><span id=__span-2-61><a id=__codelineno-2-61 name=__codelineno-2-61 href=#__codelineno-2-61></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Process multiple tool calls and return results&quot;&quot;&quot;</span>
</span><span id=__span-2-62><a id=__codelineno-2-62 name=__codelineno-2-62 href=#__codelineno-2-62></a>        <span class=n>results</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-2-63><a id=__codelineno-2-63 name=__codelineno-2-63 href=#__codelineno-2-63></a>        <span class=k>for</span> <span class=n>tool_call</span> <span class=ow>in</span> <span class=n>tool_calls</span><span class=p>:</span>
</span><span id=__span-2-64><a id=__codelineno-2-64 name=__codelineno-2-64 href=#__codelineno-2-64></a>            <span class=n>tool_name</span> <span class=o>=</span> <span class=n>tool_call</span><span class=p>[</span><span class=s2>&quot;name&quot;</span><span class=p>]</span>
</span><span id=__span-2-65><a id=__codelineno-2-65 name=__codelineno-2-65 href=#__codelineno-2-65></a>            <span class=n>parameters</span> <span class=o>=</span> <span class=n>tool_call</span><span class=p>[</span><span class=s2>&quot;input&quot;</span><span class=p>]</span>
</span><span id=__span-2-66><a id=__codelineno-2-66 name=__codelineno-2-66 href=#__codelineno-2-66></a>            <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>execute_tool</span><span class=p>(</span><span class=n>tool_name</span><span class=p>,</span> <span class=n>parameters</span><span class=p>)</span>
</span><span id=__span-2-67><a id=__codelineno-2-67 name=__codelineno-2-67 href=#__codelineno-2-67></a>
</span><span id=__span-2-68><a id=__codelineno-2-68 name=__codelineno-2-68 href=#__codelineno-2-68></a>            <span class=n>results</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span><span id=__span-2-69><a id=__codelineno-2-69 name=__codelineno-2-69 href=#__codelineno-2-69></a>                <span class=s2>&quot;tool_use_id&quot;</span><span class=p>:</span> <span class=n>tool_call</span><span class=p>[</span><span class=s2>&quot;id&quot;</span><span class=p>],</span>
</span><span id=__span-2-70><a id=__codelineno-2-70 name=__codelineno-2-70 href=#__codelineno-2-70></a>                <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>result</span><span class=p>,</span> <span class=n>indent</span><span class=o>=</span><span class=mi>2</span><span class=p>),</span>
</span><span id=__span-2-71><a id=__codelineno-2-71 name=__codelineno-2-71 href=#__codelineno-2-71></a>                <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;tool_result&quot;</span>
</span><span id=__span-2-72><a id=__codelineno-2-72 name=__codelineno-2-72 href=#__codelineno-2-72></a>            <span class=p>})</span>
</span><span id=__span-2-73><a id=__codelineno-2-73 name=__codelineno-2-73 href=#__codelineno-2-73></a>
</span><span id=__span-2-74><a id=__codelineno-2-74 name=__codelineno-2-74 href=#__codelineno-2-74></a>        <span class=k>return</span> <span class=n>results</span>
</span></code></pre></div> <h2 id=claude-tool-definitions>Claude Tool Definitions<a class=headerlink href=#claude-tool-definitions title="Anchor link to this section for reference">&para;</a></h2> <h3 id=complete-claude-tool-schemas>Complete Claude Tool Schemas<a class=headerlink href=#complete-claude-tool-schemas title="Anchor link to this section for reference">&para;</a></h3> <div class="language-python highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=n>CREW_MCP_CLAUDE_TOOLS</span> <span class=o>=</span> <span class=p>[</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a>    <span class=p>{</span>
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a>        <span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=s2>&quot;search_crew&quot;</span><span class=p>,</span>
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a>        <span class=s2>&quot;description&quot;</span><span class=p>:</span> <span class=s2>&quot;&quot;&quot;Search for crew members using natural language queries with advanced filtering.</span>
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a><span class=s2>        This tool enables intelligent crew discovery using conversational queries combined with structured filters.</span>
</span><span id=__span-3-6><a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a><span class=s2>        Perfect for finding crew members based on experience, qualifications, availability, or specific requirements.&quot;&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-3-7><a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a>        <span class=s2>&quot;input_schema&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-3-8><a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a>            <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;object&quot;</span><span class=p>,</span>
</span><span id=__span-3-9><a id=__codelineno-3-9 name=__codelineno-3-9 href=#__codelineno-3-9></a>            <span class=s2>&quot;properties&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-3-10><a id=__codelineno-3-10 name=__codelineno-3-10 href=#__codelineno-3-10></a>                <span class=s2>&quot;query&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-3-11><a id=__codelineno-3-11 name=__codelineno-3-11 href=#__codelineno-3-11></a>                    <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;string&quot;</span><span class=p>,</span>
</span><span id=__span-3-12><a id=__codelineno-3-12 name=__codelineno-3-12 href=#__codelineno-3-12></a>                    <span class=s2>&quot;description&quot;</span><span class=p>:</span> <span class=s2>&quot;Natural language search query. Examples: &#39;experienced deck officers with valid STCW&#39;, &#39;available engineers for North Sea operations&#39;, &#39;certified radio operators ready for assignment&#39;&quot;</span>
</span><span id=__span-3-13><a id=__codelineno-3-13 name=__codelineno-3-13 href=#__codelineno-3-13></a>                <span class=p>},</span>
</span><span id=__span-3-14><a id=__codelineno-3-14 name=__codelineno-3-14 href=#__codelineno-3-14></a>                <span class=s2>&quot;filters&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-3-15><a id=__codelineno-3-15 name=__codelineno-3-15 href=#__codelineno-3-15></a>                    <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;object&quot;</span><span class=p>,</span>
</span><span id=__span-3-16><a id=__codelineno-3-16 name=__codelineno-3-16 href=#__codelineno-3-16></a>                    <span class=s2>&quot;description&quot;</span><span class=p>:</span> <span class=s2>&quot;Additional structured filters to refine search results&quot;</span><span class=p>,</span>
</span><span id=__span-3-17><a id=__codelineno-3-17 name=__codelineno-3-17 href=#__codelineno-3-17></a>                    <span class=s2>&quot;properties&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-3-18><a id=__codelineno-3-18 name=__codelineno-3-18 href=#__codelineno-3-18></a>                        <span class=s2>&quot;rank&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-3-19><a id=__codelineno-3-19 name=__codelineno-3-19 href=#__codelineno-3-19></a>                            <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;string&quot;</span><span class=p>,</span>
</span><span id=__span-3-20><a id=__codelineno-3-20 name=__codelineno-3-20 href=#__codelineno-3-20></a>                            <span class=s2>&quot;description&quot;</span><span class=p>:</span> <span class=s2>&quot;Filter by crew rank or position (e.g., &#39;Chief Officer&#39;, &#39;Second Engineer&#39;, &#39;Bosun&#39;)&quot;</span>
</span><span id=__span-3-21><a id=__codelineno-3-21 name=__codelineno-3-21 href=#__codelineno-3-21></a>                        <span class=p>},</span>
</span><span id=__span-3-22><a id=__codelineno-3-22 name=__codelineno-3-22 href=#__codelineno-3-22></a>                        <span class=s2>&quot;department&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-3-23><a id=__codelineno-3-23 name=__codelineno-3-23 href=#__codelineno-3-23></a>                            <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;string&quot;</span><span class=p>,</span>
</span><span id=__span-3-24><a id=__codelineno-3-24 name=__codelineno-3-24 href=#__codelineno-3-24></a>                            <span class=s2>&quot;enum&quot;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&quot;deck&quot;</span><span class=p>,</span> <span class=s2>&quot;engine&quot;</span><span class=p>,</span> <span class=s2>&quot;catering&quot;</span><span class=p>,</span> <span class=s2>&quot;radio&quot;</span><span class=p>,</span> <span class=s2>&quot;medical&quot;</span><span class=p>],</span>
</span><span id=__span-3-25><a id=__codelineno-3-25 name=__codelineno-3-25 href=#__codelineno-3-25></a>                            <span class=s2>&quot;description&quot;</span><span class=p>:</span> <span class=s2>&quot;Filter by department: deck (navigation/cargo), engine (machinery), catering (food service), radio (communications), medical (health services)&quot;</span>
</span><span id=__span-3-26><a id=__codelineno-3-26 name=__codelineno-3-26 href=#__codelineno-3-26></a>                        <span class=p>},</span>
</span><span id=__span-3-27><a id=__codelineno-3-27 name=__codelineno-3-27 href=#__codelineno-3-27></a>                        <span class=s2>&quot;status&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-3-28><a id=__codelineno-3-28 name=__codelineno-3-28 href=#__codelineno-3-28></a>                            <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;string&quot;</span><span class=p>,</span>
</span><span id=__span-3-29><a id=__codelineno-3-29 name=__codelineno-3-29 href=#__codelineno-3-29></a>                            <span class=s2>&quot;enum&quot;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&quot;active&quot;</span><span class=p>,</span> <span class=s2>&quot;available&quot;</span><span class=p>,</span> <span class=s2>&quot;assigned&quot;</span><span class=p>,</span> <span class=s2>&quot;leave&quot;</span><span class=p>],</span>
</span><span id=__span-3-30><a id=__codelineno-3-30 name=__codelineno-3-30 href=#__codelineno-3-30></a>                            <span class=s2>&quot;description&quot;</span><span class=p>:</span> <span class=s2>&quot;Filter by current crew status: active (working), available (ready for assignment), assigned (currently deployed), leave (on shore leave)&quot;</span>
</span><span id=__span-3-31><a id=__codelineno-3-31 name=__codelineno-3-31 href=#__codelineno-3-31></a>                        <span class=p>},</span>
</span><span id=__span-3-32><a id=__codelineno-3-32 name=__codelineno-3-32 href=#__codelineno-3-32></a>                        <span class=s2>&quot;vessel_id&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-3-33><a id=__codelineno-3-33 name=__codelineno-3-33 href=#__codelineno-3-33></a>                            <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;string&quot;</span><span class=p>,</span>
</span><span id=__span-3-34><a id=__codelineno-3-34 name=__codelineno-3-34 href=#__codelineno-3-34></a>                            <span class=s2>&quot;description&quot;</span><span class=p>:</span> <span class=s2>&quot;UUID to filter crew currently assigned to a specific vessel&quot;</span>
</span><span id=__span-3-35><a id=__codelineno-3-35 name=__codelineno-3-35 href=#__codelineno-3-35></a>                        <span class=p>}</span>
</span><span id=__span-3-36><a id=__codelineno-3-36 name=__codelineno-3-36 href=#__codelineno-3-36></a>                    <span class=p>}</span>
</span><span id=__span-3-37><a id=__codelineno-3-37 name=__codelineno-3-37 href=#__codelineno-3-37></a>                <span class=p>},</span>
</span><span id=__span-3-38><a id=__codelineno-3-38 name=__codelineno-3-38 href=#__codelineno-3-38></a>                <span class=s2>&quot;limit&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-3-39><a id=__codelineno-3-39 name=__codelineno-3-39 href=#__codelineno-3-39></a>                    <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;integer&quot;</span><span class=p>,</span>
</span><span id=__span-3-40><a id=__codelineno-3-40 name=__codelineno-3-40 href=#__codelineno-3-40></a>                    <span class=s2>&quot;description&quot;</span><span class=p>:</span> <span class=s2>&quot;Maximum number of results to return (1-100)&quot;</span><span class=p>,</span>
</span><span id=__span-3-41><a id=__codelineno-3-41 name=__codelineno-3-41 href=#__codelineno-3-41></a>                    <span class=s2>&quot;minimum&quot;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span><span id=__span-3-42><a id=__codelineno-3-42 name=__codelineno-3-42 href=#__codelineno-3-42></a>                    <span class=s2>&quot;maximum&quot;</span><span class=p>:</span> <span class=mi>100</span><span class=p>,</span>
</span><span id=__span-3-43><a id=__codelineno-3-43 name=__codelineno-3-43 href=#__codelineno-3-43></a>                    <span class=s2>&quot;default&quot;</span><span class=p>:</span> <span class=mi>10</span>
</span><span id=__span-3-44><a id=__codelineno-3-44 name=__codelineno-3-44 href=#__codelineno-3-44></a>                <span class=p>}</span>
</span><span id=__span-3-45><a id=__codelineno-3-45 name=__codelineno-3-45 href=#__codelineno-3-45></a>            <span class=p>},</span>
</span><span id=__span-3-46><a id=__codelineno-3-46 name=__codelineno-3-46 href=#__codelineno-3-46></a>            <span class=s2>&quot;required&quot;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&quot;query&quot;</span><span class=p>]</span>
</span><span id=__span-3-47><a id=__codelineno-3-47 name=__codelineno-3-47 href=#__codelineno-3-47></a>        <span class=p>}</span>
</span><span id=__span-3-48><a id=__codelineno-3-48 name=__codelineno-3-48 href=#__codelineno-3-48></a>    <span class=p>},</span>
</span><span id=__span-3-49><a id=__codelineno-3-49 name=__codelineno-3-49 href=#__codelineno-3-49></a>    <span class=p>{</span>
</span><span id=__span-3-50><a id=__codelineno-3-50 name=__codelineno-3-50 href=#__codelineno-3-50></a>        <span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=s2>&quot;create_appraisal&quot;</span><span class=p>,</span>
</span><span id=__span-3-51><a id=__codelineno-3-51 name=__codelineno-3-51 href=#__codelineno-3-51></a>        <span class=s2>&quot;description&quot;</span><span class=p>:</span> <span class=s2>&quot;&quot;&quot;Create a comprehensive performance appraisal for a crew member with structured evaluation categories.</span>
</span><span id=__span-3-52><a id=__codelineno-3-52 name=__codelineno-3-52 href=#__codelineno-3-52></a><span class=s2>        This tool facilitates systematic performance reviews with customizable evaluation criteria, scoring, and detailed feedback.</span>
</span><span id=__span-3-53><a id=__codelineno-3-53 name=__codelineno-3-53 href=#__codelineno-3-53></a><span class=s2>        Supports multi-category evaluations with strengths, weaknesses, and development recommendations.&quot;&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-3-54><a id=__codelineno-3-54 name=__codelineno-3-54 href=#__codelineno-3-54></a>        <span class=s2>&quot;input_schema&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-3-55><a id=__codelineno-3-55 name=__codelineno-3-55 href=#__codelineno-3-55></a>            <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;object&quot;</span><span class=p>,</span>
</span><span id=__span-3-56><a id=__codelineno-3-56 name=__codelineno-3-56 href=#__codelineno-3-56></a>            <span class=s2>&quot;properties&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-3-57><a id=__codelineno-3-57 name=__codelineno-3-57 href=#__codelineno-3-57></a>                <span class=s2>&quot;crew_member_id&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-3-58><a id=__codelineno-3-58 name=__codelineno-3-58 href=#__codelineno-3-58></a>                    <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;string&quot;</span><span class=p>,</span>
</span><span id=__span-3-59><a id=__codelineno-3-59 name=__codelineno-3-59 href=#__codelineno-3-59></a>                    <span class=s2>&quot;description&quot;</span><span class=p>:</span> <span class=s2>&quot;UUID of the crew member being evaluated&quot;</span>
</span><span id=__span-3-60><a id=__codelineno-3-60 name=__codelineno-3-60 href=#__codelineno-3-60></a>                <span class=p>},</span>
</span><span id=__span-3-61><a id=__codelineno-3-61 name=__codelineno-3-61 href=#__codelineno-3-61></a>                <span class=s2>&quot;vessel_id&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-3-62><a id=__codelineno-3-62 name=__codelineno-3-62 href=#__codelineno-3-62></a>                    <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;string&quot;</span><span class=p>,</span>
</span><span id=__span-3-63><a id=__codelineno-3-63 name=__codelineno-3-63 href=#__codelineno-3-63></a>                    <span class=s2>&quot;description&quot;</span><span class=p>:</span> <span class=s2>&quot;UUID of the vessel where the evaluation period occurred (helps provide context for performance assessment)&quot;</span>
</span><span id=__span-3-64><a id=__codelineno-3-64 name=__codelineno-3-64 href=#__codelineno-3-64></a>                <span class=p>},</span>
</span><span id=__span-3-65><a id=__codelineno-3-65 name=__codelineno-3-65 href=#__codelineno-3-65></a>                <span class=s2>&quot;period_start&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-3-66><a id=__codelineno-3-66 name=__codelineno-3-66 href=#__codelineno-3-66></a>                    <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;string&quot;</span><span class=p>,</span>
</span><span id=__span-3-67><a id=__codelineno-3-67 name=__codelineno-3-67 href=#__codelineno-3-67></a>                    <span class=s2>&quot;description&quot;</span><span class=p>:</span> <span class=s2>&quot;Start date of the evaluation period in YYYY-MM-DD format&quot;</span>
</span><span id=__span-3-68><a id=__codelineno-3-68 name=__codelineno-3-68 href=#__codelineno-3-68></a>                <span class=p>},</span>
</span><span id=__span-3-69><a id=__codelineno-3-69 name=__codelineno-3-69 href=#__codelineno-3-69></a>                <span class=s2>&quot;period_end&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-3-70><a id=__codelineno-3-70 name=__codelineno-3-70 href=#__codelineno-3-70></a>                    <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;string&quot;</span><span class=p>,</span>
</span><span id=__span-3-71><a id=__codelineno-3-71 name=__codelineno-3-71 href=#__codelineno-3-71></a>                    <span class=s2>&quot;description&quot;</span><span class=p>:</span> <span class=s2>&quot;End date of the evaluation period in YYYY-MM-DD format&quot;</span>
</span><span id=__span-3-72><a id=__codelineno-3-72 name=__codelineno-3-72 href=#__codelineno-3-72></a>                <span class=p>},</span>
</span><span id=__span-3-73><a id=__codelineno-3-73 name=__codelineno-3-73 href=#__codelineno-3-73></a>                <span class=s2>&quot;categories&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-3-74><a id=__codelineno-3-74 name=__codelineno-3-74 href=#__codelineno-3-74></a>                    <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;array&quot;</span><span class=p>,</span>
</span><span id=__span-3-75><a id=__codelineno-3-75 name=__codelineno-3-75 href=#__codelineno-3-75></a>                    <span class=s2>&quot;description&quot;</span><span class=p>:</span> <span class=s2>&quot;List of evaluation categories with detailed assessments&quot;</span><span class=p>,</span>
</span><span id=__span-3-76><a id=__codelineno-3-76 name=__codelineno-3-76 href=#__codelineno-3-76></a>                    <span class=s2>&quot;items&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-3-77><a id=__codelineno-3-77 name=__codelineno-3-77 href=#__codelineno-3-77></a>                        <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;object&quot;</span><span class=p>,</span>
</span><span id=__span-3-78><a id=__codelineno-3-78 name=__codelineno-3-78 href=#__codelineno-3-78></a>                        <span class=s2>&quot;properties&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-3-79><a id=__codelineno-3-79 name=__codelineno-3-79 href=#__codelineno-3-79></a>                            <span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-3-80><a id=__codelineno-3-80 name=__codelineno-3-80 href=#__codelineno-3-80></a>                                <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;string&quot;</span><span class=p>,</span>
</span><span id=__span-3-81><a id=__codelineno-3-81 name=__codelineno-3-81 href=#__codelineno-3-81></a>                                <span class=s2>&quot;description&quot;</span><span class=p>:</span> <span class=s2>&quot;Category name (e.g., &#39;Technical Skills&#39;, &#39;Leadership&#39;, &#39;Safety Compliance&#39;, &#39;Communication&#39;, &#39;Teamwork&#39;)&quot;</span>
</span><span id=__span-3-82><a id=__codelineno-3-82 name=__codelineno-3-82 href=#__codelineno-3-82></a>                            <span class=p>},</span>
</span><span id=__span-3-83><a id=__codelineno-3-83 name=__codelineno-3-83 href=#__codelineno-3-83></a>                            <span class=s2>&quot;score&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-3-84><a id=__codelineno-3-84 name=__codelineno-3-84 href=#__codelineno-3-84></a>                                <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;number&quot;</span><span class=p>,</span>
</span><span id=__span-3-85><a id=__codelineno-3-85 name=__codelineno-3-85 href=#__codelineno-3-85></a>                                <span class=s2>&quot;minimum&quot;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span><span id=__span-3-86><a id=__codelineno-3-86 name=__codelineno-3-86 href=#__codelineno-3-86></a>                                <span class=s2>&quot;maximum&quot;</span><span class=p>:</span> <span class=mi>5</span><span class=p>,</span>
</span><span id=__span-3-87><a id=__codelineno-3-87 name=__codelineno-3-87 href=#__codelineno-3-87></a>                                <span class=s2>&quot;description&quot;</span><span class=p>:</span> <span class=s2>&quot;Numerical score from 1 (poor) to 5 (excellent)&quot;</span>
</span><span id=__span-3-88><a id=__codelineno-3-88 name=__codelineno-3-88 href=#__codelineno-3-88></a>                            <span class=p>},</span>
</span><span id=__span-3-89><a id=__codelineno-3-89 name=__codelineno-3-89 href=#__codelineno-3-89></a>                            <span class=s2>&quot;comments&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-3-90><a id=__codelineno-3-90 name=__codelineno-3-90 href=#__codelineno-3-90></a>                                <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;string&quot;</span><span class=p>,</span>
</span><span id=__span-3-91><a id=__codelineno-3-91 name=__codelineno-3-91 href=#__codelineno-3-91></a>                                <span class=s2>&quot;description&quot;</span><span class=p>:</span> <span class=s2>&quot;Detailed comments explaining the score and providing specific examples&quot;</span>
</span><span id=__span-3-92><a id=__codelineno-3-92 name=__codelineno-3-92 href=#__codelineno-3-92></a>                            <span class=p>},</span>
</span><span id=__span-3-93><a id=__codelineno-3-93 name=__codelineno-3-93 href=#__codelineno-3-93></a>                            <span class=s2>&quot;strengths&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-3-94><a id=__codelineno-3-94 name=__codelineno-3-94 href=#__codelineno-3-94></a>                                <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;string&quot;</span><span class=p>,</span>
</span><span id=__span-3-95><a id=__codelineno-3-95 name=__codelineno-3-95 href=#__codelineno-3-95></a>                                <span class=s2>&quot;description&quot;</span><span class=p>:</span> <span class=s2>&quot;Specific strengths demonstrated in this category&quot;</span>
</span><span id=__span-3-96><a id=__codelineno-3-96 name=__codelineno-3-96 href=#__codelineno-3-96></a>                            <span class=p>},</span>
</span><span id=__span-3-97><a id=__codelineno-3-97 name=__codelineno-3-97 href=#__codelineno-3-97></a>                            <span class=s2>&quot;weaknesses&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-3-98><a id=__codelineno-3-98 name=__codelineno-3-98 href=#__codelineno-3-98></a>                                <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;string&quot;</span><span class=p>,</span>
</span><span id=__span-3-99><a id=__codelineno-3-99 name=__codelineno-3-99 href=#__codelineno-3-99></a>                                <span class=s2>&quot;description&quot;</span><span class=p>:</span> <span class=s2>&quot;Areas needing improvement or development&quot;</span>
</span><span id=__span-3-100><a id=__codelineno-3-100 name=__codelineno-3-100 href=#__codelineno-3-100></a>                            <span class=p>}</span>
</span><span id=__span-3-101><a id=__codelineno-3-101 name=__codelineno-3-101 href=#__codelineno-3-101></a>                        <span class=p>},</span>
</span><span id=__span-3-102><a id=__codelineno-3-102 name=__codelineno-3-102 href=#__codelineno-3-102></a>                        <span class=s2>&quot;required&quot;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&quot;name&quot;</span><span class=p>,</span> <span class=s2>&quot;score&quot;</span><span class=p>]</span>
</span><span id=__span-3-103><a id=__codelineno-3-103 name=__codelineno-3-103 href=#__codelineno-3-103></a>                    <span class=p>}</span>
</span><span id=__span-3-104><a id=__codelineno-3-104 name=__codelineno-3-104 href=#__codelineno-3-104></a>                <span class=p>},</span>
</span><span id=__span-3-105><a id=__codelineno-3-105 name=__codelineno-3-105 href=#__codelineno-3-105></a>                <span class=s2>&quot;evaluator_id&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-3-106><a id=__codelineno-3-106 name=__codelineno-3-106 href=#__codelineno-3-106></a>                    <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;string&quot;</span><span class=p>,</span>
</span><span id=__span-3-107><a id=__codelineno-3-107 name=__codelineno-3-107 href=#__codelineno-3-107></a>                    <span class=s2>&quot;description&quot;</span><span class=p>:</span> <span class=s2>&quot;UUID of the person conducting the evaluation (optional - defaults to AI assistant if not provided)&quot;</span>
</span><span id=__span-3-108><a id=__codelineno-3-108 name=__codelineno-3-108 href=#__codelineno-3-108></a>                <span class=p>}</span>
</span><span id=__span-3-109><a id=__codelineno-3-109 name=__codelineno-3-109 href=#__codelineno-3-109></a>            <span class=p>},</span>
</span><span id=__span-3-110><a id=__codelineno-3-110 name=__codelineno-3-110 href=#__codelineno-3-110></a>            <span class=s2>&quot;required&quot;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&quot;crew_member_id&quot;</span><span class=p>,</span> <span class=s2>&quot;vessel_id&quot;</span><span class=p>,</span> <span class=s2>&quot;period_start&quot;</span><span class=p>,</span> <span class=s2>&quot;period_end&quot;</span><span class=p>,</span> <span class=s2>&quot;categories&quot;</span><span class=p>]</span>
</span><span id=__span-3-111><a id=__codelineno-3-111 name=__codelineno-3-111 href=#__codelineno-3-111></a>        <span class=p>}</span>
</span><span id=__span-3-112><a id=__codelineno-3-112 name=__codelineno-3-112 href=#__codelineno-3-112></a>    <span class=p>},</span>
</span><span id=__span-3-113><a id=__codelineno-3-113 name=__codelineno-3-113 href=#__codelineno-3-113></a>    <span class=p>{</span>
</span><span id=__span-3-114><a id=__codelineno-3-114 name=__codelineno-3-114 href=#__codelineno-3-114></a>        <span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=s2>&quot;check_certificates&quot;</span><span class=p>,</span>
</span><span id=__span-3-115><a id=__codelineno-3-115 name=__codelineno-3-115 href=#__codelineno-3-115></a>        <span class=s2>&quot;description&quot;</span><span class=p>:</span> <span class=s2>&quot;&quot;&quot;Monitor and analyze certificate expiry status for crew members with comprehensive filtering options.</span>
</span><span id=__span-3-116><a id=__codelineno-3-116 name=__codelineno-3-116 href=#__codelineno-3-116></a><span class=s2>        Essential for compliance management, this tool helps track certificate validity, identify expiring documents,</span>
</span><span id=__span-3-117><a id=__codelineno-3-117 name=__codelineno-3-117 href=#__codelineno-3-117></a><span class=s2>        and maintain regulatory compliance across individuals, departments, or the entire organization.&quot;&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-3-118><a id=__codelineno-3-118 name=__codelineno-3-118 href=#__codelineno-3-118></a>        <span class=s2>&quot;input_schema&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-3-119><a id=__codelineno-3-119 name=__codelineno-3-119 href=#__codelineno-3-119></a>            <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;object&quot;</span><span class=p>,</span>
</span><span id=__span-3-120><a id=__codelineno-3-120 name=__codelineno-3-120 href=#__codelineno-3-120></a>            <span class=s2>&quot;properties&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-3-121><a id=__codelineno-3-121 name=__codelineno-3-121 href=#__codelineno-3-121></a>                <span class=s2>&quot;crew_member_id&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-3-122><a id=__codelineno-3-122 name=__codelineno-3-122 href=#__codelineno-3-122></a>                    <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;string&quot;</span><span class=p>,</span>
</span><span id=__span-3-123><a id=__codelineno-3-123 name=__codelineno-3-123 href=#__codelineno-3-123></a>                    <span class=s2>&quot;description&quot;</span><span class=p>:</span> <span class=s2>&quot;UUID of specific crew member to check (if omitted, checks all crew members or those in specified department)&quot;</span>
</span><span id=__span-3-124><a id=__codelineno-3-124 name=__codelineno-3-124 href=#__codelineno-3-124></a>                <span class=p>},</span>
</span><span id=__span-3-125><a id=__codelineno-3-125 name=__codelineno-3-125 href=#__codelineno-3-125></a>                <span class=s2>&quot;check_expiring&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-3-126><a id=__codelineno-3-126 name=__codelineno-3-126 href=#__codelineno-3-126></a>                    <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;boolean&quot;</span><span class=p>,</span>
</span><span id=__span-3-127><a id=__codelineno-3-127 name=__codelineno-3-127 href=#__codelineno-3-127></a>                    <span class=s2>&quot;description&quot;</span><span class=p>:</span> <span class=s2>&quot;Whether to include certificates expiring within the specified timeframe in addition to already expired ones&quot;</span><span class=p>,</span>
</span><span id=__span-3-128><a id=__codelineno-3-128 name=__codelineno-3-128 href=#__codelineno-3-128></a>                    <span class=s2>&quot;default&quot;</span><span class=p>:</span> <span class=n>true</span>
</span><span id=__span-3-129><a id=__codelineno-3-129 name=__codelineno-3-129 href=#__codelineno-3-129></a>                <span class=p>},</span>
</span><span id=__span-3-130><a id=__codelineno-3-130 name=__codelineno-3-130 href=#__codelineno-3-130></a>                <span class=s2>&quot;days_ahead&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-3-131><a id=__codelineno-3-131 name=__codelineno-3-131 href=#__codelineno-3-131></a>                    <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;integer&quot;</span><span class=p>,</span>
</span><span id=__span-3-132><a id=__codelineno-3-132 name=__codelineno-3-132 href=#__codelineno-3-132></a>                    <span class=s2>&quot;description&quot;</span><span class=p>:</span> <span class=s2>&quot;Number of days ahead to check for expiring certificates (1-365 days). Common values: 30 (urgent), 90 (quarterly planning), 180 (long-term planning)&quot;</span><span class=p>,</span>
</span><span id=__span-3-133><a id=__codelineno-3-133 name=__codelineno-3-133 href=#__codelineno-3-133></a>                    <span class=s2>&quot;minimum&quot;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span><span id=__span-3-134><a id=__codelineno-3-134 name=__codelineno-3-134 href=#__codelineno-3-134></a>                    <span class=s2>&quot;maximum&quot;</span><span class=p>:</span> <span class=mi>365</span><span class=p>,</span>
</span><span id=__span-3-135><a id=__codelineno-3-135 name=__codelineno-3-135 href=#__codelineno-3-135></a>                    <span class=s2>&quot;default&quot;</span><span class=p>:</span> <span class=mi>90</span>
</span><span id=__span-3-136><a id=__codelineno-3-136 name=__codelineno-3-136 href=#__codelineno-3-136></a>                <span class=p>},</span>
</span><span id=__span-3-137><a id=__codelineno-3-137 name=__codelineno-3-137 href=#__codelineno-3-137></a>                <span class=s2>&quot;department&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-3-138><a id=__codelineno-3-138 name=__codelineno-3-138 href=#__codelineno-3-138></a>                    <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;string&quot;</span><span class=p>,</span>
</span><span id=__span-3-139><a id=__codelineno-3-139 name=__codelineno-3-139 href=#__codelineno-3-139></a>                    <span class=s2>&quot;enum&quot;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&quot;deck&quot;</span><span class=p>,</span> <span class=s2>&quot;engine&quot;</span><span class=p>,</span> <span class=s2>&quot;catering&quot;</span><span class=p>,</span> <span class=s2>&quot;radio&quot;</span><span class=p>,</span> <span class=s2>&quot;medical&quot;</span><span class=p>],</span>
</span><span id=__span-3-140><a id=__codelineno-3-140 name=__codelineno-3-140 href=#__codelineno-3-140></a>                    <span class=s2>&quot;description&quot;</span><span class=p>:</span> <span class=s2>&quot;Filter by department to check certificates for all crew in that department&quot;</span>
</span><span id=__span-3-141><a id=__codelineno-3-141 name=__codelineno-3-141 href=#__codelineno-3-141></a>                <span class=p>}</span>
</span><span id=__span-3-142><a id=__codelineno-3-142 name=__codelineno-3-142 href=#__codelineno-3-142></a>            <span class=p>}</span>
</span><span id=__span-3-143><a id=__codelineno-3-143 name=__codelineno-3-143 href=#__codelineno-3-143></a>        <span class=p>}</span>
</span><span id=__span-3-144><a id=__codelineno-3-144 name=__codelineno-3-144 href=#__codelineno-3-144></a>    <span class=p>},</span>
</span><span id=__span-3-145><a id=__codelineno-3-145 name=__codelineno-3-145 href=#__codelineno-3-145></a>    <span class=p>{</span>
</span><span id=__span-3-146><a id=__codelineno-3-146 name=__codelineno-3-146 href=#__codelineno-3-146></a>        <span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=s2>&quot;vessel_assignment&quot;</span><span class=p>,</span>
</span><span id=__span-3-147><a id=__codelineno-3-147 name=__codelineno-3-147 href=#__codelineno-3-147></a>        <span class=s2>&quot;description&quot;</span><span class=p>:</span> <span class=s2>&quot;&quot;&quot;Create and manage crew vessel assignments with intelligent validation and conflict detection.</span>
</span><span id=__span-3-148><a id=__codelineno-3-148 name=__codelineno-3-148 href=#__codelineno-3-148></a><span class=s2>        This tool handles crew deployment, ensuring proper qualifications, avoiding conflicts, and optimizing</span>
</span><span id=__span-3-149><a id=__codelineno-3-149 name=__codelineno-3-149 href=#__codelineno-3-149></a><span class=s2>        crew utilization across the fleet. Includes automated validation for compliance and operational requirements.&quot;&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-3-150><a id=__codelineno-3-150 name=__codelineno-3-150 href=#__codelineno-3-150></a>        <span class=s2>&quot;input_schema&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-3-151><a id=__codelineno-3-151 name=__codelineno-3-151 href=#__codelineno-3-151></a>            <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;object&quot;</span><span class=p>,</span>
</span><span id=__span-3-152><a id=__codelineno-3-152 name=__codelineno-3-152 href=#__codelineno-3-152></a>            <span class=s2>&quot;properties&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-3-153><a id=__codelineno-3-153 name=__codelineno-3-153 href=#__codelineno-3-153></a>                <span class=s2>&quot;crew_member_id&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-3-154><a id=__codelineno-3-154 name=__codelineno-3-154 href=#__codelineno-3-154></a>                    <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;string&quot;</span><span class=p>,</span>
</span><span id=__span-3-155><a id=__codelineno-3-155 name=__codelineno-3-155 href=#__codelineno-3-155></a>                    <span class=s2>&quot;description&quot;</span><span class=p>:</span> <span class=s2>&quot;UUID of the crew member to assign to a vessel&quot;</span>
</span><span id=__span-3-156><a id=__codelineno-3-156 name=__codelineno-3-156 href=#__codelineno-3-156></a>                <span class=p>},</span>
</span><span id=__span-3-157><a id=__codelineno-3-157 name=__codelineno-3-157 href=#__codelineno-3-157></a>                <span class=s2>&quot;vessel_id&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-3-158><a id=__codelineno-3-158 name=__codelineno-3-158 href=#__codelineno-3-158></a>                    <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;string&quot;</span><span class=p>,</span>
</span><span id=__span-3-159><a id=__codelineno-3-159 name=__codelineno-3-159 href=#__codelineno-3-159></a>                    <span class=s2>&quot;description&quot;</span><span class=p>:</span> <span class=s2>&quot;UUID of the target vessel for the assignment&quot;</span>
</span><span id=__span-3-160><a id=__codelineno-3-160 name=__codelineno-3-160 href=#__codelineno-3-160></a>                <span class=p>},</span>
</span><span id=__span-3-161><a id=__codelineno-3-161 name=__codelineno-3-161 href=#__codelineno-3-161></a>                <span class=s2>&quot;role&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-3-162><a id=__codelineno-3-162 name=__codelineno-3-162 href=#__codelineno-3-162></a>                    <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;string&quot;</span><span class=p>,</span>
</span><span id=__span-3-163><a id=__codelineno-3-163 name=__codelineno-3-163 href=#__codelineno-3-163></a>                    <span class=s2>&quot;description&quot;</span><span class=p>:</span> <span class=s2>&quot;Position/role on the vessel. Examples: &#39;Master&#39; (Captain), &#39;Chief Officer&#39;, &#39;Second Officer&#39;, &#39;Third Officer&#39;, &#39;Chief Engineer&#39;, &#39;Second Engineer&#39;, &#39;Third Engineer&#39;, &#39;Bosun&#39;, &#39;Able Seaman&#39;, &#39;Ordinary Seaman&#39;, &#39;Chief Cook&#39;, &#39;Steward&#39;, &#39;Galley Hand&#39;&quot;</span>
</span><span id=__span-3-164><a id=__codelineno-3-164 name=__codelineno-3-164 href=#__codelineno-3-164></a>                <span class=p>},</span>
</span><span id=__span-3-165><a id=__codelineno-3-165 name=__codelineno-3-165 href=#__codelineno-3-165></a>                <span class=s2>&quot;start_date&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-3-166><a id=__codelineno-3-166 name=__codelineno-3-166 href=#__codelineno-3-166></a>                    <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;string&quot;</span><span class=p>,</span>
</span><span id=__span-3-167><a id=__codelineno-3-167 name=__codelineno-3-167 href=#__codelineno-3-167></a>                    <span class=s2>&quot;description&quot;</span><span class=p>:</span> <span class=s2>&quot;Assignment start date in YYYY-MM-DD format&quot;</span>
</span><span id=__span-3-168><a id=__codelineno-3-168 name=__codelineno-3-168 href=#__codelineno-3-168></a>                <span class=p>},</span>
</span><span id=__span-3-169><a id=__codelineno-3-169 name=__codelineno-3-169 href=#__codelineno-3-169></a>                <span class=s2>&quot;end_date&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-3-170><a id=__codelineno-3-170 name=__codelineno-3-170 href=#__codelineno-3-170></a>                    <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;string&quot;</span><span class=p>,</span>
</span><span id=__span-3-171><a id=__codelineno-3-171 name=__codelineno-3-171 href=#__codelineno-3-171></a>                    <span class=s2>&quot;description&quot;</span><span class=p>:</span> <span class=s2>&quot;Assignment end date in YYYY-MM-DD format (optional - omit for open-ended assignments)&quot;</span>
</span><span id=__span-3-172><a id=__codelineno-3-172 name=__codelineno-3-172 href=#__codelineno-3-172></a>                <span class=p>}</span>
</span><span id=__span-3-173><a id=__codelineno-3-173 name=__codelineno-3-173 href=#__codelineno-3-173></a>            <span class=p>},</span>
</span><span id=__span-3-174><a id=__codelineno-3-174 name=__codelineno-3-174 href=#__codelineno-3-174></a>            <span class=s2>&quot;required&quot;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&quot;crew_member_id&quot;</span><span class=p>,</span> <span class=s2>&quot;vessel_id&quot;</span><span class=p>,</span> <span class=s2>&quot;role&quot;</span><span class=p>,</span> <span class=s2>&quot;start_date&quot;</span><span class=p>]</span>
</span><span id=__span-3-175><a id=__codelineno-3-175 name=__codelineno-3-175 href=#__codelineno-3-175></a>        <span class=p>}</span>
</span><span id=__span-3-176><a id=__codelineno-3-176 name=__codelineno-3-176 href=#__codelineno-3-176></a>    <span class=p>},</span>
</span><span id=__span-3-177><a id=__codelineno-3-177 name=__codelineno-3-177 href=#__codelineno-3-177></a>    <span class=p>{</span>
</span><span id=__span-3-178><a id=__codelineno-3-178 name=__codelineno-3-178 href=#__codelineno-3-178></a>        <span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=s2>&quot;compliance_report&quot;</span><span class=p>,</span>
</span><span id=__span-3-179><a id=__codelineno-3-179 name=__codelineno-3-179 href=#__codelineno-3-179></a>        <span class=s2>&quot;description&quot;</span><span class=p>:</span> <span class=s2>&quot;&quot;&quot;Generate comprehensive compliance reports with risk analysis and actionable recommendations.</span>
</span><span id=__span-3-180><a id=__codelineno-3-180 name=__codelineno-3-180 href=#__codelineno-3-180></a><span class=s2>        This powerful tool provides detailed compliance status for vessels, departments, or the entire organization,</span>
</span><span id=__span-3-181><a id=__codelineno-3-181 name=__codelineno-3-181 href=#__codelineno-3-181></a><span class=s2>        including certificate analysis, manning compliance, and regulatory risk assessment.&quot;&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-3-182><a id=__codelineno-3-182 name=__codelineno-3-182 href=#__codelineno-3-182></a>        <span class=s2>&quot;input_schema&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-3-183><a id=__codelineno-3-183 name=__codelineno-3-183 href=#__codelineno-3-183></a>            <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;object&quot;</span><span class=p>,</span>
</span><span id=__span-3-184><a id=__codelineno-3-184 name=__codelineno-3-184 href=#__codelineno-3-184></a>            <span class=s2>&quot;properties&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-3-185><a id=__codelineno-3-185 name=__codelineno-3-185 href=#__codelineno-3-185></a>                <span class=s2>&quot;vessel_id&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-3-186><a id=__codelineno-3-186 name=__codelineno-3-186 href=#__codelineno-3-186></a>                    <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;string&quot;</span><span class=p>,</span>
</span><span id=__span-3-187><a id=__codelineno-3-187 name=__codelineno-3-187 href=#__codelineno-3-187></a>                    <span class=s2>&quot;description&quot;</span><span class=p>:</span> <span class=s2>&quot;UUID of specific vessel to analyze (generates vessel-specific compliance report including manning, certificates, and operational readiness)&quot;</span>
</span><span id=__span-3-188><a id=__codelineno-3-188 name=__codelineno-3-188 href=#__codelineno-3-188></a>                <span class=p>},</span>
</span><span id=__span-3-189><a id=__codelineno-3-189 name=__codelineno-3-189 href=#__codelineno-3-189></a>                <span class=s2>&quot;department_id&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-3-190><a id=__codelineno-3-190 name=__codelineno-3-190 href=#__codelineno-3-190></a>                    <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;string&quot;</span><span class=p>,</span>
</span><span id=__span-3-191><a id=__codelineno-3-191 name=__codelineno-3-191 href=#__codelineno-3-191></a>                    <span class=s2>&quot;enum&quot;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&quot;deck&quot;</span><span class=p>,</span> <span class=s2>&quot;engine&quot;</span><span class=p>,</span> <span class=s2>&quot;catering&quot;</span><span class=p>,</span> <span class=s2>&quot;radio&quot;</span><span class=p>,</span> <span class=s2>&quot;medical&quot;</span><span class=p>],</span>
</span><span id=__span-3-192><a id=__codelineno-3-192 name=__codelineno-3-192 href=#__codelineno-3-192></a>                    <span class=s2>&quot;description&quot;</span><span class=p>:</span> <span class=s2>&quot;Department to analyze across all vessels and shore-based positions&quot;</span>
</span><span id=__span-3-193><a id=__codelineno-3-193 name=__codelineno-3-193 href=#__codelineno-3-193></a>                <span class=p>},</span>
</span><span id=__span-3-194><a id=__codelineno-3-194 name=__codelineno-3-194 href=#__codelineno-3-194></a>                <span class=s2>&quot;include_expiring&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-3-195><a id=__codelineno-3-195 name=__codelineno-3-195 href=#__codelineno-3-195></a>                    <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;boolean&quot;</span><span class=p>,</span>
</span><span id=__span-3-196><a id=__codelineno-3-196 name=__codelineno-3-196 href=#__codelineno-3-196></a>                    <span class=s2>&quot;description&quot;</span><span class=p>:</span> <span class=s2>&quot;Include certificates expiring within 90 days in the compliance analysis&quot;</span><span class=p>,</span>
</span><span id=__span-3-197><a id=__codelineno-3-197 name=__codelineno-3-197 href=#__codelineno-3-197></a>                    <span class=s2>&quot;default&quot;</span><span class=p>:</span> <span class=n>true</span>
</span><span id=__span-3-198><a id=__codelineno-3-198 name=__codelineno-3-198 href=#__codelineno-3-198></a>                <span class=p>},</span>
</span><span id=__span-3-199><a id=__codelineno-3-199 name=__codelineno-3-199 href=#__codelineno-3-199></a>                <span class=s2>&quot;format&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-3-200><a id=__codelineno-3-200 name=__codelineno-3-200 href=#__codelineno-3-200></a>                    <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;string&quot;</span><span class=p>,</span>
</span><span id=__span-3-201><a id=__codelineno-3-201 name=__codelineno-3-201 href=#__codelineno-3-201></a>                    <span class=s2>&quot;enum&quot;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&quot;summary&quot;</span><span class=p>,</span> <span class=s2>&quot;detailed&quot;</span><span class=p>,</span> <span class=s2>&quot;csv&quot;</span><span class=p>],</span>
</span><span id=__span-3-202><a id=__codelineno-3-202 name=__codelineno-3-202 href=#__codelineno-3-202></a>                    <span class=s2>&quot;description&quot;</span><span class=p>:</span> <span class=s2>&quot;Report format: &#39;summary&#39; for executive overview, &#39;detailed&#39; for comprehensive analysis, &#39;csv&#39; for data export&quot;</span><span class=p>,</span>
</span><span id=__span-3-203><a id=__codelineno-3-203 name=__codelineno-3-203 href=#__codelineno-3-203></a>                    <span class=s2>&quot;default&quot;</span><span class=p>:</span> <span class=s2>&quot;summary&quot;</span>
</span><span id=__span-3-204><a id=__codelineno-3-204 name=__codelineno-3-204 href=#__codelineno-3-204></a>                <span class=p>}</span>
</span><span id=__span-3-205><a id=__codelineno-3-205 name=__codelineno-3-205 href=#__codelineno-3-205></a>            <span class=p>}</span>
</span><span id=__span-3-206><a id=__codelineno-3-206 name=__codelineno-3-206 href=#__codelineno-3-206></a>        <span class=p>}</span>
</span><span id=__span-3-207><a id=__codelineno-3-207 name=__codelineno-3-207 href=#__codelineno-3-207></a>    <span class=p>}</span>
</span><span id=__span-3-208><a id=__codelineno-3-208 name=__codelineno-3-208 href=#__codelineno-3-208></a><span class=p>]</span>
</span></code></pre></div> <h2 id=basic-examples>Basic Examples<a class=headerlink href=#basic-examples title="Anchor link to this section for reference">&para;</a></h2> <h3 id=1-simple-crew-search-with-claude>1. Simple Crew Search with Claude<a class=headerlink href=#1-simple-crew-search-with-claude title="Anchor link to this section for reference">&para;</a></h3> <div class="language-python highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>claude_crew_search_example</span><span class=p>():</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a>    <span class=n>client</span> <span class=o>=</span> <span class=n>CrewMCPClaudeClient</span><span class=p>()</span>
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a>
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a>    <span class=n>message</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=n>claude_client</span><span class=o>.</span><span class=n>messages</span><span class=o>.</span><span class=n>create</span><span class=p>(</span>
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a>        <span class=n>model</span><span class=o>=</span><span class=s2>&quot;claude-3-5-sonnet-20241022&quot;</span><span class=p>,</span>
</span><span id=__span-4-6><a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a>        <span class=n>max_tokens</span><span class=o>=</span><span class=mi>1024</span><span class=p>,</span>
</span><span id=__span-4-7><a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a>        <span class=n>system</span><span class=o>=</span><span class=s2>&quot;&quot;&quot;You are an expert maritime crew management assistant. You help find, evaluate,</span>
</span><span id=__span-4-8><a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a><span class=s2>        and manage crew members for maritime vessels. Always provide helpful context and</span>
</span><span id=__span-4-9><a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a><span class=s2>        actionable information when using tools.&quot;&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-4-10><a id=__codelineno-4-10 name=__codelineno-4-10 href=#__codelineno-4-10></a>        <span class=n>messages</span><span class=o>=</span><span class=p>[</span>
</span><span id=__span-4-11><a id=__codelineno-4-11 name=__codelineno-4-11 href=#__codelineno-4-11></a>            <span class=p>{</span>
</span><span id=__span-4-12><a id=__codelineno-4-12 name=__codelineno-4-12 href=#__codelineno-4-12></a>                <span class=s2>&quot;role&quot;</span><span class=p>:</span> <span class=s2>&quot;user&quot;</span><span class=p>,</span>
</span><span id=__span-4-13><a id=__codelineno-4-13 name=__codelineno-4-13 href=#__codelineno-4-13></a>                <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=s2>&quot;I need to find experienced deck officers who are currently available for assignment to our North Sea operations.&quot;</span>
</span><span id=__span-4-14><a id=__codelineno-4-14 name=__codelineno-4-14 href=#__codelineno-4-14></a>            <span class=p>}</span>
</span><span id=__span-4-15><a id=__codelineno-4-15 name=__codelineno-4-15 href=#__codelineno-4-15></a>        <span class=p>],</span>
</span><span id=__span-4-16><a id=__codelineno-4-16 name=__codelineno-4-16 href=#__codelineno-4-16></a>        <span class=n>tools</span><span class=o>=</span><span class=n>CREW_MCP_CLAUDE_TOOLS</span>
</span><span id=__span-4-17><a id=__codelineno-4-17 name=__codelineno-4-17 href=#__codelineno-4-17></a>    <span class=p>)</span>
</span><span id=__span-4-18><a id=__codelineno-4-18 name=__codelineno-4-18 href=#__codelineno-4-18></a>
</span><span id=__span-4-19><a id=__codelineno-4-19 name=__codelineno-4-19 href=#__codelineno-4-19></a>    <span class=c1># Process tool calls if present</span>
</span><span id=__span-4-20><a id=__codelineno-4-20 name=__codelineno-4-20 href=#__codelineno-4-20></a>    <span class=k>if</span> <span class=n>message</span><span class=o>.</span><span class=n>content</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>type</span> <span class=o>==</span> <span class=s2>&quot;tool_use&quot;</span><span class=p>:</span>
</span><span id=__span-4-21><a id=__codelineno-4-21 name=__codelineno-4-21 href=#__codelineno-4-21></a>        <span class=n>tool_call</span> <span class=o>=</span> <span class=n>message</span><span class=o>.</span><span class=n>content</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span><span id=__span-4-22><a id=__codelineno-4-22 name=__codelineno-4-22 href=#__codelineno-4-22></a>        <span class=n>result</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=n>execute_tool</span><span class=p>(</span><span class=n>tool_call</span><span class=o>.</span><span class=n>name</span><span class=p>,</span> <span class=n>tool_call</span><span class=o>.</span><span class=n>input</span><span class=p>)</span>
</span><span id=__span-4-23><a id=__codelineno-4-23 name=__codelineno-4-23 href=#__codelineno-4-23></a>
</span><span id=__span-4-24><a id=__codelineno-4-24 name=__codelineno-4-24 href=#__codelineno-4-24></a>        <span class=c1># Create follow-up message with tool results</span>
</span><span id=__span-4-25><a id=__codelineno-4-25 name=__codelineno-4-25 href=#__codelineno-4-25></a>        <span class=n>follow_up</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=n>claude_client</span><span class=o>.</span><span class=n>messages</span><span class=o>.</span><span class=n>create</span><span class=p>(</span>
</span><span id=__span-4-26><a id=__codelineno-4-26 name=__codelineno-4-26 href=#__codelineno-4-26></a>            <span class=n>model</span><span class=o>=</span><span class=s2>&quot;claude-3-5-sonnet-20241022&quot;</span><span class=p>,</span>
</span><span id=__span-4-27><a id=__codelineno-4-27 name=__codelineno-4-27 href=#__codelineno-4-27></a>            <span class=n>max_tokens</span><span class=o>=</span><span class=mi>1024</span><span class=p>,</span>
</span><span id=__span-4-28><a id=__codelineno-4-28 name=__codelineno-4-28 href=#__codelineno-4-28></a>            <span class=n>messages</span><span class=o>=</span><span class=p>[</span>
</span><span id=__span-4-29><a id=__codelineno-4-29 name=__codelineno-4-29 href=#__codelineno-4-29></a>                <span class=p>{</span>
</span><span id=__span-4-30><a id=__codelineno-4-30 name=__codelineno-4-30 href=#__codelineno-4-30></a>                    <span class=s2>&quot;role&quot;</span><span class=p>:</span> <span class=s2>&quot;user&quot;</span><span class=p>,</span>
</span><span id=__span-4-31><a id=__codelineno-4-31 name=__codelineno-4-31 href=#__codelineno-4-31></a>                    <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=s2>&quot;I need to find experienced deck officers who are currently available for assignment to our North Sea operations.&quot;</span>
</span><span id=__span-4-32><a id=__codelineno-4-32 name=__codelineno-4-32 href=#__codelineno-4-32></a>                <span class=p>},</span>
</span><span id=__span-4-33><a id=__codelineno-4-33 name=__codelineno-4-33 href=#__codelineno-4-33></a>                <span class=p>{</span>
</span><span id=__span-4-34><a id=__codelineno-4-34 name=__codelineno-4-34 href=#__codelineno-4-34></a>                    <span class=s2>&quot;role&quot;</span><span class=p>:</span> <span class=s2>&quot;assistant&quot;</span><span class=p>,</span>
</span><span id=__span-4-35><a id=__codelineno-4-35 name=__codelineno-4-35 href=#__codelineno-4-35></a>                    <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=n>message</span><span class=o>.</span><span class=n>content</span>
</span><span id=__span-4-36><a id=__codelineno-4-36 name=__codelineno-4-36 href=#__codelineno-4-36></a>                <span class=p>},</span>
</span><span id=__span-4-37><a id=__codelineno-4-37 name=__codelineno-4-37 href=#__codelineno-4-37></a>                <span class=p>{</span>
</span><span id=__span-4-38><a id=__codelineno-4-38 name=__codelineno-4-38 href=#__codelineno-4-38></a>                    <span class=s2>&quot;role&quot;</span><span class=p>:</span> <span class=s2>&quot;user&quot;</span><span class=p>,</span>
</span><span id=__span-4-39><a id=__codelineno-4-39 name=__codelineno-4-39 href=#__codelineno-4-39></a>                    <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=p>[</span>
</span><span id=__span-4-40><a id=__codelineno-4-40 name=__codelineno-4-40 href=#__codelineno-4-40></a>                        <span class=p>{</span>
</span><span id=__span-4-41><a id=__codelineno-4-41 name=__codelineno-4-41 href=#__codelineno-4-41></a>                            <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;tool_result&quot;</span><span class=p>,</span>
</span><span id=__span-4-42><a id=__codelineno-4-42 name=__codelineno-4-42 href=#__codelineno-4-42></a>                            <span class=s2>&quot;tool_use_id&quot;</span><span class=p>:</span> <span class=n>tool_call</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
</span><span id=__span-4-43><a id=__codelineno-4-43 name=__codelineno-4-43 href=#__codelineno-4-43></a>                            <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>result</span><span class=p>)</span>
</span><span id=__span-4-44><a id=__codelineno-4-44 name=__codelineno-4-44 href=#__codelineno-4-44></a>                        <span class=p>}</span>
</span><span id=__span-4-45><a id=__codelineno-4-45 name=__codelineno-4-45 href=#__codelineno-4-45></a>                    <span class=p>]</span>
</span><span id=__span-4-46><a id=__codelineno-4-46 name=__codelineno-4-46 href=#__codelineno-4-46></a>                <span class=p>}</span>
</span><span id=__span-4-47><a id=__codelineno-4-47 name=__codelineno-4-47 href=#__codelineno-4-47></a>            <span class=p>],</span>
</span><span id=__span-4-48><a id=__codelineno-4-48 name=__codelineno-4-48 href=#__codelineno-4-48></a>            <span class=n>tools</span><span class=o>=</span><span class=n>CREW_MCP_CLAUDE_TOOLS</span>
</span><span id=__span-4-49><a id=__codelineno-4-49 name=__codelineno-4-49 href=#__codelineno-4-49></a>        <span class=p>)</span>
</span><span id=__span-4-50><a id=__codelineno-4-50 name=__codelineno-4-50 href=#__codelineno-4-50></a>
</span><span id=__span-4-51><a id=__codelineno-4-51 name=__codelineno-4-51 href=#__codelineno-4-51></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Claude&#39;s Response:&quot;</span><span class=p>,</span> <span class=n>follow_up</span><span class=o>.</span><span class=n>content</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
</span><span id=__span-4-52><a id=__codelineno-4-52 name=__codelineno-4-52 href=#__codelineno-4-52></a>    <span class=k>else</span><span class=p>:</span>
</span><span id=__span-4-53><a id=__codelineno-4-53 name=__codelineno-4-53 href=#__codelineno-4-53></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Claude&#39;s Response:&quot;</span><span class=p>,</span> <span class=n>message</span><span class=o>.</span><span class=n>content</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
</span><span id=__span-4-54><a id=__codelineno-4-54 name=__codelineno-4-54 href=#__codelineno-4-54></a>
</span><span id=__span-4-55><a id=__codelineno-4-55 name=__codelineno-4-55 href=#__codelineno-4-55></a><span class=c1># Run the example</span>
</span><span id=__span-4-56><a id=__codelineno-4-56 name=__codelineno-4-56 href=#__codelineno-4-56></a><span class=kn>import</span><span class=w> </span><span class=nn>asyncio</span>
</span><span id=__span-4-57><a id=__codelineno-4-57 name=__codelineno-4-57 href=#__codelineno-4-57></a><span class=n>asyncio</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>claude_crew_search_example</span><span class=p>())</span>
</span></code></pre></div> <h3 id=2-multi-tool-compliance-analysis>2. Multi-Tool Compliance Analysis<a class=headerlink href=#2-multi-tool-compliance-analysis title="Anchor link to this section for reference">&para;</a></h3> <div class="language-python highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>claude_compliance_workflow</span><span class=p>():</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a>    <span class=n>client</span> <span class=o>=</span> <span class=n>CrewMCPClaudeClient</span><span class=p>()</span>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a>
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a>    <span class=c1># Initial request for comprehensive analysis</span>
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a>    <span class=n>message</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=n>claude_client</span><span class=o>.</span><span class=n>messages</span><span class=o>.</span><span class=n>create</span><span class=p>(</span>
</span><span id=__span-5-6><a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a>        <span class=n>model</span><span class=o>=</span><span class=s2>&quot;claude-3-5-sonnet-20241022&quot;</span><span class=p>,</span>
</span><span id=__span-5-7><a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a>        <span class=n>max_tokens</span><span class=o>=</span><span class=mi>2048</span><span class=p>,</span>
</span><span id=__span-5-8><a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a>        <span class=n>system</span><span class=o>=</span><span class=s2>&quot;&quot;&quot;You are a maritime compliance expert. When asked to analyze compliance,</span>
</span><span id=__span-5-9><a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a><span class=s2>        you should use multiple tools to provide a comprehensive assessment including:</span>
</span><span id=__span-5-10><a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a><span class=s2>        1. Overall compliance status</span>
</span><span id=__span-5-11><a id=__codelineno-5-11 name=__codelineno-5-11 href=#__codelineno-5-11></a><span class=s2>        2. Certificate expiry analysis</span>
</span><span id=__span-5-12><a id=__codelineno-5-12 name=__codelineno-5-12 href=#__codelineno-5-12></a><span class=s2>        3. Specific recommendations for improvement</span>
</span><span id=__span-5-13><a id=__codelineno-5-13 name=__codelineno-5-13 href=#__codelineno-5-13></a>
</span><span id=__span-5-14><a id=__codelineno-5-14 name=__codelineno-5-14 href=#__codelineno-5-14></a><span class=s2>        Always provide actionable insights and prioritize safety-critical issues.&quot;&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-5-15><a id=__codelineno-5-15 name=__codelineno-5-15 href=#__codelineno-5-15></a>        <span class=n>messages</span><span class=o>=</span><span class=p>[</span>
</span><span id=__span-5-16><a id=__codelineno-5-16 name=__codelineno-5-16 href=#__codelineno-5-16></a>            <span class=p>{</span>
</span><span id=__span-5-17><a id=__codelineno-5-17 name=__codelineno-5-17 href=#__codelineno-5-17></a>                <span class=s2>&quot;role&quot;</span><span class=p>:</span> <span class=s2>&quot;user&quot;</span><span class=p>,</span>
</span><span id=__span-5-18><a id=__codelineno-5-18 name=__codelineno-5-18 href=#__codelineno-5-18></a>                <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=s2>&quot;I need a comprehensive compliance analysis for MV Ocean Pioneer (vessel ID: 123e4567-e89b-12d3-a456-426614174000). The vessel is scheduled for departure in 5 days and we want to ensure full compliance.&quot;</span>
</span><span id=__span-5-19><a id=__codelineno-5-19 name=__codelineno-5-19 href=#__codelineno-5-19></a>            <span class=p>}</span>
</span><span id=__span-5-20><a id=__codelineno-5-20 name=__codelineno-5-20 href=#__codelineno-5-20></a>        <span class=p>],</span>
</span><span id=__span-5-21><a id=__codelineno-5-21 name=__codelineno-5-21 href=#__codelineno-5-21></a>        <span class=n>tools</span><span class=o>=</span><span class=n>CREW_MCP_CLAUDE_TOOLS</span>
</span><span id=__span-5-22><a id=__codelineno-5-22 name=__codelineno-5-22 href=#__codelineno-5-22></a>    <span class=p>)</span>
</span><span id=__span-5-23><a id=__codelineno-5-23 name=__codelineno-5-23 href=#__codelineno-5-23></a>
</span><span id=__span-5-24><a id=__codelineno-5-24 name=__codelineno-5-24 href=#__codelineno-5-24></a>    <span class=c1># Handle multiple tool calls in sequence</span>
</span><span id=__span-5-25><a id=__codelineno-5-25 name=__codelineno-5-25 href=#__codelineno-5-25></a>    <span class=n>conversation</span> <span class=o>=</span> <span class=p>[</span>
</span><span id=__span-5-26><a id=__codelineno-5-26 name=__codelineno-5-26 href=#__codelineno-5-26></a>        <span class=p>{</span>
</span><span id=__span-5-27><a id=__codelineno-5-27 name=__codelineno-5-27 href=#__codelineno-5-27></a>            <span class=s2>&quot;role&quot;</span><span class=p>:</span> <span class=s2>&quot;user&quot;</span><span class=p>,</span>
</span><span id=__span-5-28><a id=__codelineno-5-28 name=__codelineno-5-28 href=#__codelineno-5-28></a>            <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=s2>&quot;I need a comprehensive compliance analysis for MV Ocean Pioneer (vessel ID: 123e4567-e89b-12d3-a456-426614174000). The vessel is scheduled for departure in 5 days and we want to ensure full compliance.&quot;</span>
</span><span id=__span-5-29><a id=__codelineno-5-29 name=__codelineno-5-29 href=#__codelineno-5-29></a>        <span class=p>}</span>
</span><span id=__span-5-30><a id=__codelineno-5-30 name=__codelineno-5-30 href=#__codelineno-5-30></a>    <span class=p>]</span>
</span><span id=__span-5-31><a id=__codelineno-5-31 name=__codelineno-5-31 href=#__codelineno-5-31></a>
</span><span id=__span-5-32><a id=__codelineno-5-32 name=__codelineno-5-32 href=#__codelineno-5-32></a>    <span class=c1># Process initial response</span>
</span><span id=__span-5-33><a id=__codelineno-5-33 name=__codelineno-5-33 href=#__codelineno-5-33></a>    <span class=n>current_message</span> <span class=o>=</span> <span class=n>message</span>
</span><span id=__span-5-34><a id=__codelineno-5-34 name=__codelineno-5-34 href=#__codelineno-5-34></a>    <span class=n>conversation</span><span class=o>.</span><span class=n>append</span><span class=p>({</span><span class=s2>&quot;role&quot;</span><span class=p>:</span> <span class=s2>&quot;assistant&quot;</span><span class=p>,</span> <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=n>current_message</span><span class=o>.</span><span class=n>content</span><span class=p>})</span>
</span><span id=__span-5-35><a id=__codelineno-5-35 name=__codelineno-5-35 href=#__codelineno-5-35></a>
</span><span id=__span-5-36><a id=__codelineno-5-36 name=__codelineno-5-36 href=#__codelineno-5-36></a>    <span class=c1># Continue conversation until no more tool calls</span>
</span><span id=__span-5-37><a id=__codelineno-5-37 name=__codelineno-5-37 href=#__codelineno-5-37></a>    <span class=k>while</span> <span class=nb>any</span><span class=p>(</span><span class=n>content</span><span class=o>.</span><span class=n>type</span> <span class=o>==</span> <span class=s2>&quot;tool_use&quot;</span> <span class=k>for</span> <span class=n>content</span> <span class=ow>in</span> <span class=n>current_message</span><span class=o>.</span><span class=n>content</span><span class=p>):</span>
</span><span id=__span-5-38><a id=__codelineno-5-38 name=__codelineno-5-38 href=#__codelineno-5-38></a>        <span class=n>tool_results</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-5-39><a id=__codelineno-5-39 name=__codelineno-5-39 href=#__codelineno-5-39></a>
</span><span id=__span-5-40><a id=__codelineno-5-40 name=__codelineno-5-40 href=#__codelineno-5-40></a>        <span class=k>for</span> <span class=n>content_block</span> <span class=ow>in</span> <span class=n>current_message</span><span class=o>.</span><span class=n>content</span><span class=p>:</span>
</span><span id=__span-5-41><a id=__codelineno-5-41 name=__codelineno-5-41 href=#__codelineno-5-41></a>            <span class=k>if</span> <span class=n>content_block</span><span class=o>.</span><span class=n>type</span> <span class=o>==</span> <span class=s2>&quot;tool_use&quot;</span><span class=p>:</span>
</span><span id=__span-5-42><a id=__codelineno-5-42 name=__codelineno-5-42 href=#__codelineno-5-42></a>                <span class=n>result</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=n>execute_tool</span><span class=p>(</span><span class=n>content_block</span><span class=o>.</span><span class=n>name</span><span class=p>,</span> <span class=n>content_block</span><span class=o>.</span><span class=n>input</span><span class=p>)</span>
</span><span id=__span-5-43><a id=__codelineno-5-43 name=__codelineno-5-43 href=#__codelineno-5-43></a>                <span class=n>tool_results</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span><span id=__span-5-44><a id=__codelineno-5-44 name=__codelineno-5-44 href=#__codelineno-5-44></a>                    <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;tool_result&quot;</span><span class=p>,</span>
</span><span id=__span-5-45><a id=__codelineno-5-45 name=__codelineno-5-45 href=#__codelineno-5-45></a>                    <span class=s2>&quot;tool_use_id&quot;</span><span class=p>:</span> <span class=n>content_block</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
</span><span id=__span-5-46><a id=__codelineno-5-46 name=__codelineno-5-46 href=#__codelineno-5-46></a>                    <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>result</span><span class=p>,</span> <span class=n>indent</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span>
</span><span id=__span-5-47><a id=__codelineno-5-47 name=__codelineno-5-47 href=#__codelineno-5-47></a>                <span class=p>})</span>
</span><span id=__span-5-48><a id=__codelineno-5-48 name=__codelineno-5-48 href=#__codelineno-5-48></a>
</span><span id=__span-5-49><a id=__codelineno-5-49 name=__codelineno-5-49 href=#__codelineno-5-49></a>        <span class=c1># Add tool results to conversation</span>
</span><span id=__span-5-50><a id=__codelineno-5-50 name=__codelineno-5-50 href=#__codelineno-5-50></a>        <span class=n>conversation</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span><span id=__span-5-51><a id=__codelineno-5-51 name=__codelineno-5-51 href=#__codelineno-5-51></a>            <span class=s2>&quot;role&quot;</span><span class=p>:</span> <span class=s2>&quot;user&quot;</span><span class=p>,</span>
</span><span id=__span-5-52><a id=__codelineno-5-52 name=__codelineno-5-52 href=#__codelineno-5-52></a>            <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=n>tool_results</span>
</span><span id=__span-5-53><a id=__codelineno-5-53 name=__codelineno-5-53 href=#__codelineno-5-53></a>        <span class=p>})</span>
</span><span id=__span-5-54><a id=__codelineno-5-54 name=__codelineno-5-54 href=#__codelineno-5-54></a>
</span><span id=__span-5-55><a id=__codelineno-5-55 name=__codelineno-5-55 href=#__codelineno-5-55></a>        <span class=c1># Get next response from Claude</span>
</span><span id=__span-5-56><a id=__codelineno-5-56 name=__codelineno-5-56 href=#__codelineno-5-56></a>        <span class=n>current_message</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=n>claude_client</span><span class=o>.</span><span class=n>messages</span><span class=o>.</span><span class=n>create</span><span class=p>(</span>
</span><span id=__span-5-57><a id=__codelineno-5-57 name=__codelineno-5-57 href=#__codelineno-5-57></a>            <span class=n>model</span><span class=o>=</span><span class=s2>&quot;claude-3-5-sonnet-20241022&quot;</span><span class=p>,</span>
</span><span id=__span-5-58><a id=__codelineno-5-58 name=__codelineno-5-58 href=#__codelineno-5-58></a>            <span class=n>max_tokens</span><span class=o>=</span><span class=mi>2048</span><span class=p>,</span>
</span><span id=__span-5-59><a id=__codelineno-5-59 name=__codelineno-5-59 href=#__codelineno-5-59></a>            <span class=n>messages</span><span class=o>=</span><span class=n>conversation</span><span class=p>,</span>
</span><span id=__span-5-60><a id=__codelineno-5-60 name=__codelineno-5-60 href=#__codelineno-5-60></a>            <span class=n>tools</span><span class=o>=</span><span class=n>CREW_MCP_CLAUDE_TOOLS</span>
</span><span id=__span-5-61><a id=__codelineno-5-61 name=__codelineno-5-61 href=#__codelineno-5-61></a>        <span class=p>)</span>
</span><span id=__span-5-62><a id=__codelineno-5-62 name=__codelineno-5-62 href=#__codelineno-5-62></a>
</span><span id=__span-5-63><a id=__codelineno-5-63 name=__codelineno-5-63 href=#__codelineno-5-63></a>        <span class=n>conversation</span><span class=o>.</span><span class=n>append</span><span class=p>({</span><span class=s2>&quot;role&quot;</span><span class=p>:</span> <span class=s2>&quot;assistant&quot;</span><span class=p>,</span> <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=n>current_message</span><span class=o>.</span><span class=n>content</span><span class=p>})</span>
</span><span id=__span-5-64><a id=__codelineno-5-64 name=__codelineno-5-64 href=#__codelineno-5-64></a>
</span><span id=__span-5-65><a id=__codelineno-5-65 name=__codelineno-5-65 href=#__codelineno-5-65></a>    <span class=c1># Print final analysis</span>
</span><span id=__span-5-66><a id=__codelineno-5-66 name=__codelineno-5-66 href=#__codelineno-5-66></a>    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Final Compliance Analysis:&quot;</span><span class=p>)</span>
</span><span id=__span-5-67><a id=__codelineno-5-67 name=__codelineno-5-67 href=#__codelineno-5-67></a>    <span class=k>for</span> <span class=n>content</span> <span class=ow>in</span> <span class=n>current_message</span><span class=o>.</span><span class=n>content</span><span class=p>:</span>
</span><span id=__span-5-68><a id=__codelineno-5-68 name=__codelineno-5-68 href=#__codelineno-5-68></a>        <span class=k>if</span> <span class=n>content</span><span class=o>.</span><span class=n>type</span> <span class=o>==</span> <span class=s2>&quot;text&quot;</span><span class=p>:</span>
</span><span id=__span-5-69><a id=__codelineno-5-69 name=__codelineno-5-69 href=#__codelineno-5-69></a>            <span class=nb>print</span><span class=p>(</span><span class=n>content</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
</span></code></pre></div> <h2 id=advanced-conversational-patterns>Advanced Conversational Patterns<a class=headerlink href=#advanced-conversational-patterns title="Anchor link to this section for reference">&para;</a></h2> <h3 id=multi-turn-crew-management-conversation>Multi-Turn Crew Management Conversation<a class=headerlink href=#multi-turn-crew-management-conversation title="Anchor link to this section for reference">&para;</a></h3> <div class="language-python highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=k>class</span><span class=w> </span><span class=nc>ClaudeCrewConversationManager</span><span class=p>:</span>
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Advanced conversation manager optimized for Claude&#39;s capabilities&quot;&quot;&quot;</span>
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a>
</span><span id=__span-6-4><a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-6-5><a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a>        <span class=bp>self</span><span class=o>.</span><span class=n>client</span> <span class=o>=</span> <span class=n>CrewMCPClaudeClient</span><span class=p>()</span>
</span><span id=__span-6-6><a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a>        <span class=bp>self</span><span class=o>.</span><span class=n>conversation</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-6-7><a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a>        <span class=bp>self</span><span class=o>.</span><span class=n>system_prompt</span> <span class=o>=</span> <span class=s2>&quot;&quot;&quot;You are Claude, an expert maritime crew management AI assistant.</span>
</span><span id=__span-6-8><a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a>
</span><span id=__span-6-9><a id=__codelineno-6-9 name=__codelineno-6-9 href=#__codelineno-6-9></a><span class=s2>        You specialize in:</span>
</span><span id=__span-6-10><a id=__codelineno-6-10 name=__codelineno-6-10 href=#__codelineno-6-10></a><span class=s2>        - Crew recruitment and assignment optimization</span>
</span><span id=__span-6-11><a id=__codelineno-6-11 name=__codelineno-6-11 href=#__codelineno-6-11></a><span class=s2>        - Maritime compliance and safety regulations</span>
</span><span id=__span-6-12><a id=__codelineno-6-12 name=__codelineno-6-12 href=#__codelineno-6-12></a><span class=s2>        - Performance evaluation and career development</span>
</span><span id=__span-6-13><a id=__codelineno-6-13 name=__codelineno-6-13 href=#__codelineno-6-13></a><span class=s2>        - Vessel manning and operational readiness</span>
</span><span id=__span-6-14><a id=__codelineno-6-14 name=__codelineno-6-14 href=#__codelineno-6-14></a><span class=s2>        - Certificate management and renewal planning</span>
</span><span id=__span-6-15><a id=__codelineno-6-15 name=__codelineno-6-15 href=#__codelineno-6-15></a>
</span><span id=__span-6-16><a id=__codelineno-6-16 name=__codelineno-6-16 href=#__codelineno-6-16></a><span class=s2>        Your approach:</span>
</span><span id=__span-6-17><a id=__codelineno-6-17 name=__codelineno-6-17 href=#__codelineno-6-17></a><span class=s2>        - Always consider safety as the top priority</span>
</span><span id=__span-6-18><a id=__codelineno-6-18 name=__codelineno-6-18 href=#__codelineno-6-18></a><span class=s2>        - Provide practical, actionable recommendations</span>
</span><span id=__span-6-19><a id=__codelineno-6-19 name=__codelineno-6-19 href=#__codelineno-6-19></a><span class=s2>        - Use multiple tools when needed for comprehensive analysis</span>
</span><span id=__span-6-20><a id=__codelineno-6-20 name=__codelineno-6-20 href=#__codelineno-6-20></a><span class=s2>        - Explain your reasoning and recommendations clearly</span>
</span><span id=__span-6-21><a id=__codelineno-6-21 name=__codelineno-6-21 href=#__codelineno-6-21></a><span class=s2>        - Anticipate follow-up needs and offer proactive suggestions</span>
</span><span id=__span-6-22><a id=__codelineno-6-22 name=__codelineno-6-22 href=#__codelineno-6-22></a>
</span><span id=__span-6-23><a id=__codelineno-6-23 name=__codelineno-6-23 href=#__codelineno-6-23></a><span class=s2>        When using tools:</span>
</span><span id=__span-6-24><a id=__codelineno-6-24 name=__codelineno-6-24 href=#__codelineno-6-24></a><span class=s2>        - Choose the most appropriate tool(s) for each query</span>
</span><span id=__span-6-25><a id=__codelineno-6-25 name=__codelineno-6-25 href=#__codelineno-6-25></a><span class=s2>        - Use specific parameters that match the user&#39;s intent</span>
</span><span id=__span-6-26><a id=__codelineno-6-26 name=__codelineno-6-26 href=#__codelineno-6-26></a><span class=s2>        - Interpret results in context and provide meaningful insights</span>
</span><span id=__span-6-27><a id=__codelineno-6-27 name=__codelineno-6-27 href=#__codelineno-6-27></a><span class=s2>        - Suggest related actions or considerations when relevant&quot;&quot;&quot;</span>
</span><span id=__span-6-28><a id=__codelineno-6-28 name=__codelineno-6-28 href=#__codelineno-6-28></a>
</span><span id=__span-6-29><a id=__codelineno-6-29 name=__codelineno-6-29 href=#__codelineno-6-29></a>    <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>chat</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_input</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span><span id=__span-6-30><a id=__codelineno-6-30 name=__codelineno-6-30 href=#__codelineno-6-30></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Process user input and return Claude&#39;s response&quot;&quot;&quot;</span>
</span><span id=__span-6-31><a id=__codelineno-6-31 name=__codelineno-6-31 href=#__codelineno-6-31></a>
</span><span id=__span-6-32><a id=__codelineno-6-32 name=__codelineno-6-32 href=#__codelineno-6-32></a>        <span class=c1># Add user message to conversation</span>
</span><span id=__span-6-33><a id=__codelineno-6-33 name=__codelineno-6-33 href=#__codelineno-6-33></a>        <span class=bp>self</span><span class=o>.</span><span class=n>conversation</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span><span id=__span-6-34><a id=__codelineno-6-34 name=__codelineno-6-34 href=#__codelineno-6-34></a>            <span class=s2>&quot;role&quot;</span><span class=p>:</span> <span class=s2>&quot;user&quot;</span><span class=p>,</span>
</span><span id=__span-6-35><a id=__codelineno-6-35 name=__codelineno-6-35 href=#__codelineno-6-35></a>            <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=n>user_input</span>
</span><span id=__span-6-36><a id=__codelineno-6-36 name=__codelineno-6-36 href=#__codelineno-6-36></a>        <span class=p>})</span>
</span><span id=__span-6-37><a id=__codelineno-6-37 name=__codelineno-6-37 href=#__codelineno-6-37></a>
</span><span id=__span-6-38><a id=__codelineno-6-38 name=__codelineno-6-38 href=#__codelineno-6-38></a>        <span class=c1># Get response from Claude</span>
</span><span id=__span-6-39><a id=__codelineno-6-39 name=__codelineno-6-39 href=#__codelineno-6-39></a>        <span class=n>message</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>claude_client</span><span class=o>.</span><span class=n>messages</span><span class=o>.</span><span class=n>create</span><span class=p>(</span>
</span><span id=__span-6-40><a id=__codelineno-6-40 name=__codelineno-6-40 href=#__codelineno-6-40></a>            <span class=n>model</span><span class=o>=</span><span class=s2>&quot;claude-3-5-sonnet-20241022&quot;</span><span class=p>,</span>
</span><span id=__span-6-41><a id=__codelineno-6-41 name=__codelineno-6-41 href=#__codelineno-6-41></a>            <span class=n>max_tokens</span><span class=o>=</span><span class=mi>2048</span><span class=p>,</span>
</span><span id=__span-6-42><a id=__codelineno-6-42 name=__codelineno-6-42 href=#__codelineno-6-42></a>            <span class=n>system</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>system_prompt</span><span class=p>,</span>
</span><span id=__span-6-43><a id=__codelineno-6-43 name=__codelineno-6-43 href=#__codelineno-6-43></a>            <span class=n>messages</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>conversation</span><span class=p>,</span>
</span><span id=__span-6-44><a id=__codelineno-6-44 name=__codelineno-6-44 href=#__codelineno-6-44></a>            <span class=n>tools</span><span class=o>=</span><span class=n>CREW_MCP_CLAUDE_TOOLS</span>
</span><span id=__span-6-45><a id=__codelineno-6-45 name=__codelineno-6-45 href=#__codelineno-6-45></a>        <span class=p>)</span>
</span><span id=__span-6-46><a id=__codelineno-6-46 name=__codelineno-6-46 href=#__codelineno-6-46></a>
</span><span id=__span-6-47><a id=__codelineno-6-47 name=__codelineno-6-47 href=#__codelineno-6-47></a>        <span class=c1># Add assistant message to conversation</span>
</span><span id=__span-6-48><a id=__codelineno-6-48 name=__codelineno-6-48 href=#__codelineno-6-48></a>        <span class=bp>self</span><span class=o>.</span><span class=n>conversation</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span><span id=__span-6-49><a id=__codelineno-6-49 name=__codelineno-6-49 href=#__codelineno-6-49></a>            <span class=s2>&quot;role&quot;</span><span class=p>:</span> <span class=s2>&quot;assistant&quot;</span><span class=p>,</span>
</span><span id=__span-6-50><a id=__codelineno-6-50 name=__codelineno-6-50 href=#__codelineno-6-50></a>            <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=n>message</span><span class=o>.</span><span class=n>content</span>
</span><span id=__span-6-51><a id=__codelineno-6-51 name=__codelineno-6-51 href=#__codelineno-6-51></a>        <span class=p>})</span>
</span><span id=__span-6-52><a id=__codelineno-6-52 name=__codelineno-6-52 href=#__codelineno-6-52></a>
</span><span id=__span-6-53><a id=__codelineno-6-53 name=__codelineno-6-53 href=#__codelineno-6-53></a>        <span class=c1># Process tool calls if present</span>
</span><span id=__span-6-54><a id=__codelineno-6-54 name=__codelineno-6-54 href=#__codelineno-6-54></a>        <span class=k>while</span> <span class=nb>any</span><span class=p>(</span><span class=n>content</span><span class=o>.</span><span class=n>type</span> <span class=o>==</span> <span class=s2>&quot;tool_use&quot;</span> <span class=k>for</span> <span class=n>content</span> <span class=ow>in</span> <span class=n>message</span><span class=o>.</span><span class=n>content</span><span class=p>):</span>
</span><span id=__span-6-55><a id=__codelineno-6-55 name=__codelineno-6-55 href=#__codelineno-6-55></a>            <span class=n>tool_results</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-6-56><a id=__codelineno-6-56 name=__codelineno-6-56 href=#__codelineno-6-56></a>
</span><span id=__span-6-57><a id=__codelineno-6-57 name=__codelineno-6-57 href=#__codelineno-6-57></a>            <span class=k>for</span> <span class=n>content_block</span> <span class=ow>in</span> <span class=n>message</span><span class=o>.</span><span class=n>content</span><span class=p>:</span>
</span><span id=__span-6-58><a id=__codelineno-6-58 name=__codelineno-6-58 href=#__codelineno-6-58></a>                <span class=k>if</span> <span class=n>content_block</span><span class=o>.</span><span class=n>type</span> <span class=o>==</span> <span class=s2>&quot;tool_use&quot;</span><span class=p>:</span>
</span><span id=__span-6-59><a id=__codelineno-6-59 name=__codelineno-6-59 href=#__codelineno-6-59></a>                    <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>execute_tool</span><span class=p>(</span>
</span><span id=__span-6-60><a id=__codelineno-6-60 name=__codelineno-6-60 href=#__codelineno-6-60></a>                        <span class=n>content_block</span><span class=o>.</span><span class=n>name</span><span class=p>,</span>
</span><span id=__span-6-61><a id=__codelineno-6-61 name=__codelineno-6-61 href=#__codelineno-6-61></a>                        <span class=n>content_block</span><span class=o>.</span><span class=n>input</span>
</span><span id=__span-6-62><a id=__codelineno-6-62 name=__codelineno-6-62 href=#__codelineno-6-62></a>                    <span class=p>)</span>
</span><span id=__span-6-63><a id=__codelineno-6-63 name=__codelineno-6-63 href=#__codelineno-6-63></a>                    <span class=n>tool_results</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span><span id=__span-6-64><a id=__codelineno-6-64 name=__codelineno-6-64 href=#__codelineno-6-64></a>                        <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;tool_result&quot;</span><span class=p>,</span>
</span><span id=__span-6-65><a id=__codelineno-6-65 name=__codelineno-6-65 href=#__codelineno-6-65></a>                        <span class=s2>&quot;tool_use_id&quot;</span><span class=p>:</span> <span class=n>content_block</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
</span><span id=__span-6-66><a id=__codelineno-6-66 name=__codelineno-6-66 href=#__codelineno-6-66></a>                        <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>result</span><span class=p>,</span> <span class=n>indent</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span>
</span><span id=__span-6-67><a id=__codelineno-6-67 name=__codelineno-6-67 href=#__codelineno-6-67></a>                    <span class=p>})</span>
</span><span id=__span-6-68><a id=__codelineno-6-68 name=__codelineno-6-68 href=#__codelineno-6-68></a>
</span><span id=__span-6-69><a id=__codelineno-6-69 name=__codelineno-6-69 href=#__codelineno-6-69></a>            <span class=c1># Add tool results to conversation</span>
</span><span id=__span-6-70><a id=__codelineno-6-70 name=__codelineno-6-70 href=#__codelineno-6-70></a>            <span class=bp>self</span><span class=o>.</span><span class=n>conversation</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span><span id=__span-6-71><a id=__codelineno-6-71 name=__codelineno-6-71 href=#__codelineno-6-71></a>                <span class=s2>&quot;role&quot;</span><span class=p>:</span> <span class=s2>&quot;user&quot;</span><span class=p>,</span>
</span><span id=__span-6-72><a id=__codelineno-6-72 name=__codelineno-6-72 href=#__codelineno-6-72></a>                <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=n>tool_results</span>
</span><span id=__span-6-73><a id=__codelineno-6-73 name=__codelineno-6-73 href=#__codelineno-6-73></a>            <span class=p>})</span>
</span><span id=__span-6-74><a id=__codelineno-6-74 name=__codelineno-6-74 href=#__codelineno-6-74></a>
</span><span id=__span-6-75><a id=__codelineno-6-75 name=__codelineno-6-75 href=#__codelineno-6-75></a>            <span class=c1># Get next response</span>
</span><span id=__span-6-76><a id=__codelineno-6-76 name=__codelineno-6-76 href=#__codelineno-6-76></a>            <span class=n>message</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>claude_client</span><span class=o>.</span><span class=n>messages</span><span class=o>.</span><span class=n>create</span><span class=p>(</span>
</span><span id=__span-6-77><a id=__codelineno-6-77 name=__codelineno-6-77 href=#__codelineno-6-77></a>                <span class=n>model</span><span class=o>=</span><span class=s2>&quot;claude-3-5-sonnet-20241022&quot;</span><span class=p>,</span>
</span><span id=__span-6-78><a id=__codelineno-6-78 name=__codelineno-6-78 href=#__codelineno-6-78></a>                <span class=n>max_tokens</span><span class=o>=</span><span class=mi>2048</span><span class=p>,</span>
</span><span id=__span-6-79><a id=__codelineno-6-79 name=__codelineno-6-79 href=#__codelineno-6-79></a>                <span class=n>messages</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>conversation</span><span class=p>,</span>
</span><span id=__span-6-80><a id=__codelineno-6-80 name=__codelineno-6-80 href=#__codelineno-6-80></a>                <span class=n>tools</span><span class=o>=</span><span class=n>CREW_MCP_CLAUDE_TOOLS</span>
</span><span id=__span-6-81><a id=__codelineno-6-81 name=__codelineno-6-81 href=#__codelineno-6-81></a>            <span class=p>)</span>
</span><span id=__span-6-82><a id=__codelineno-6-82 name=__codelineno-6-82 href=#__codelineno-6-82></a>
</span><span id=__span-6-83><a id=__codelineno-6-83 name=__codelineno-6-83 href=#__codelineno-6-83></a>            <span class=bp>self</span><span class=o>.</span><span class=n>conversation</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span><span id=__span-6-84><a id=__codelineno-6-84 name=__codelineno-6-84 href=#__codelineno-6-84></a>                <span class=s2>&quot;role&quot;</span><span class=p>:</span> <span class=s2>&quot;assistant&quot;</span><span class=p>,</span>
</span><span id=__span-6-85><a id=__codelineno-6-85 name=__codelineno-6-85 href=#__codelineno-6-85></a>                <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=n>message</span><span class=o>.</span><span class=n>content</span>
</span><span id=__span-6-86><a id=__codelineno-6-86 name=__codelineno-6-86 href=#__codelineno-6-86></a>            <span class=p>})</span>
</span><span id=__span-6-87><a id=__codelineno-6-87 name=__codelineno-6-87 href=#__codelineno-6-87></a>
</span><span id=__span-6-88><a id=__codelineno-6-88 name=__codelineno-6-88 href=#__codelineno-6-88></a>        <span class=c1># Extract and return text response</span>
</span><span id=__span-6-89><a id=__codelineno-6-89 name=__codelineno-6-89 href=#__codelineno-6-89></a>        <span class=n>text_responses</span> <span class=o>=</span> <span class=p>[</span>
</span><span id=__span-6-90><a id=__codelineno-6-90 name=__codelineno-6-90 href=#__codelineno-6-90></a>            <span class=n>content</span><span class=o>.</span><span class=n>text</span> <span class=k>for</span> <span class=n>content</span> <span class=ow>in</span> <span class=n>message</span><span class=o>.</span><span class=n>content</span>
</span><span id=__span-6-91><a id=__codelineno-6-91 name=__codelineno-6-91 href=#__codelineno-6-91></a>            <span class=k>if</span> <span class=n>content</span><span class=o>.</span><span class=n>type</span> <span class=o>==</span> <span class=s2>&quot;text&quot;</span>
</span><span id=__span-6-92><a id=__codelineno-6-92 name=__codelineno-6-92 href=#__codelineno-6-92></a>        <span class=p>]</span>
</span><span id=__span-6-93><a id=__codelineno-6-93 name=__codelineno-6-93 href=#__codelineno-6-93></a>
</span><span id=__span-6-94><a id=__codelineno-6-94 name=__codelineno-6-94 href=#__codelineno-6-94></a>        <span class=k>return</span> <span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>text_responses</span><span class=p>)</span>
</span><span id=__span-6-95><a id=__codelineno-6-95 name=__codelineno-6-95 href=#__codelineno-6-95></a>
</span><span id=__span-6-96><a id=__codelineno-6-96 name=__codelineno-6-96 href=#__codelineno-6-96></a><span class=c1># Example usage</span>
</span><span id=__span-6-97><a id=__codelineno-6-97 name=__codelineno-6-97 href=#__codelineno-6-97></a><span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>advanced_conversation_example</span><span class=p>():</span>
</span><span id=__span-6-98><a id=__codelineno-6-98 name=__codelineno-6-98 href=#__codelineno-6-98></a>    <span class=n>manager</span> <span class=o>=</span> <span class=n>ClaudeCrewConversationManager</span><span class=p>()</span>
</span><span id=__span-6-99><a id=__codelineno-6-99 name=__codelineno-6-99 href=#__codelineno-6-99></a>
</span><span id=__span-6-100><a id=__codelineno-6-100 name=__codelineno-6-100 href=#__codelineno-6-100></a>    <span class=c1># Multi-turn conversation</span>
</span><span id=__span-6-101><a id=__codelineno-6-101 name=__codelineno-6-101 href=#__codelineno-6-101></a>    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;🤖 Claude Crew Management Assistant Ready</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-6-102><a id=__codelineno-6-102 name=__codelineno-6-102 href=#__codelineno-6-102></a>
</span><span id=__span-6-103><a id=__codelineno-6-103 name=__codelineno-6-103 href=#__codelineno-6-103></a>    <span class=n>response1</span> <span class=o>=</span> <span class=k>await</span> <span class=n>manager</span><span class=o>.</span><span class=n>chat</span><span class=p>(</span>
</span><span id=__span-6-104><a id=__codelineno-6-104 name=__codelineno-6-104 href=#__codelineno-6-104></a>        <span class=s2>&quot;I&#39;m planning crew assignments for Q1 2025. Can you help me understand our current crew availability and compliance status?&quot;</span>
</span><span id=__span-6-105><a id=__codelineno-6-105 name=__codelineno-6-105 href=#__codelineno-6-105></a>    <span class=p>)</span>
</span><span id=__span-6-106><a id=__codelineno-6-106 name=__codelineno-6-106 href=#__codelineno-6-106></a>    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Claude:&quot;</span><span class=p>,</span> <span class=n>response1</span><span class=p>,</span> <span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-6-107><a id=__codelineno-6-107 name=__codelineno-6-107 href=#__codelineno-6-107></a>
</span><span id=__span-6-108><a id=__codelineno-6-108 name=__codelineno-6-108 href=#__codelineno-6-108></a>    <span class=n>response2</span> <span class=o>=</span> <span class=k>await</span> <span class=n>manager</span><span class=o>.</span><span class=n>chat</span><span class=p>(</span>
</span><span id=__span-6-109><a id=__codelineno-6-109 name=__codelineno-6-109 href=#__codelineno-6-109></a>        <span class=s2>&quot;Focus on the deck department first. I need to know who&#39;s available and if there are any compliance issues that could affect assignments.&quot;</span>
</span><span id=__span-6-110><a id=__codelineno-6-110 name=__codelineno-6-110 href=#__codelineno-6-110></a>    <span class=p>)</span>
</span><span id=__span-6-111><a id=__codelineno-6-111 name=__codelineno-6-111 href=#__codelineno-6-111></a>    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Claude:&quot;</span><span class=p>,</span> <span class=n>response2</span><span class=p>,</span> <span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-6-112><a id=__codelineno-6-112 name=__codelineno-6-112 href=#__codelineno-6-112></a>
</span><span id=__span-6-113><a id=__codelineno-6-113 name=__codelineno-6-113 href=#__codelineno-6-113></a>    <span class=n>response3</span> <span class=o>=</span> <span class=k>await</span> <span class=n>manager</span><span class=o>.</span><span class=n>chat</span><span class=p>(</span>
</span><span id=__span-6-114><a id=__codelineno-6-114 name=__codelineno-6-114 href=#__codelineno-6-114></a>        <span class=s2>&quot;Based on what you found, what would be your top 3 recommendations for optimizing our deck department assignments?&quot;</span>
</span><span id=__span-6-115><a id=__codelineno-6-115 name=__codelineno-6-115 href=#__codelineno-6-115></a>    <span class=p>)</span>
</span><span id=__span-6-116><a id=__codelineno-6-116 name=__codelineno-6-116 href=#__codelineno-6-116></a>    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Claude:&quot;</span><span class=p>,</span> <span class=n>response3</span><span class=p>,</span> <span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-6-117><a id=__codelineno-6-117 name=__codelineno-6-117 href=#__codelineno-6-117></a>
</span><span id=__span-6-118><a id=__codelineno-6-118 name=__codelineno-6-118 href=#__codelineno-6-118></a>    <span class=n>response4</span> <span class=o>=</span> <span class=k>await</span> <span class=n>manager</span><span class=o>.</span><span class=n>chat</span><span class=p>(</span>
</span><span id=__span-6-119><a id=__codelineno-6-119 name=__codelineno-6-119 href=#__codelineno-6-119></a>        <span class=s2>&quot;Let&#39;s create some specific assignments. I need to assign crew to MV Arctic Explorer for a 3-month North Sea operation starting February 1st.&quot;</span>
</span><span id=__span-6-120><a id=__codelineno-6-120 name=__codelineno-6-120 href=#__codelineno-6-120></a>    <span class=p>)</span>
</span><span id=__span-6-121><a id=__codelineno-6-121 name=__codelineno-6-121 href=#__codelineno-6-121></a>    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Claude:&quot;</span><span class=p>,</span> <span class=n>response4</span><span class=p>,</span> <span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>)</span>
</span></code></pre></div> <h3 id=intelligent-crew-planning-assistant>Intelligent Crew Planning Assistant<a class=headerlink href=#intelligent-crew-planning-assistant title="Anchor link to this section for reference">&para;</a></h3> <div class="language-python highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=k>class</span><span class=w> </span><span class=nc>IntelligentCrewPlanner</span><span class=p>:</span>
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;AI-powered crew planning with Claude&#39;s reasoning capabilities&quot;&quot;&quot;</span>
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a>
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-7-5><a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a>        <span class=bp>self</span><span class=o>.</span><span class=n>client</span> <span class=o>=</span> <span class=n>CrewMCPClaudeClient</span><span class=p>()</span>
</span><span id=__span-7-6><a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a>
</span><span id=__span-7-7><a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a>    <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>plan_vessel_crewing</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>vessel_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>voyage_details</span><span class=p>:</span> <span class=n>Dict</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>:</span>
</span><span id=__span-7-8><a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Comprehensive vessel crewing plan with AI recommendations&quot;&quot;&quot;</span>
</span><span id=__span-7-9><a id=__codelineno-7-9 name=__codelineno-7-9 href=#__codelineno-7-9></a>
</span><span id=__span-7-10><a id=__codelineno-7-10 name=__codelineno-7-10 href=#__codelineno-7-10></a>        <span class=n>planning_prompt</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;&quot;&quot;</span>
</span><span id=__span-7-11><a id=__codelineno-7-11 name=__codelineno-7-11 href=#__codelineno-7-11></a><span class=s2>        I need to develop a comprehensive crewing plan for vessel </span><span class=si>{</span><span class=n>vessel_id</span><span class=si>}</span><span class=s2>.</span>
</span><span id=__span-7-12><a id=__codelineno-7-12 name=__codelineno-7-12 href=#__codelineno-7-12></a>
</span><span id=__span-7-13><a id=__codelineno-7-13 name=__codelineno-7-13 href=#__codelineno-7-13></a><span class=s2>        Voyage Details:</span>
</span><span id=__span-7-14><a id=__codelineno-7-14 name=__codelineno-7-14 href=#__codelineno-7-14></a><span class=s2>        - Destination: </span><span class=si>{</span><span class=n>voyage_details</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;destination&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;Not specified&#39;</span><span class=p>)</span><span class=si>}</span>
</span><span id=__span-7-15><a id=__codelineno-7-15 name=__codelineno-7-15 href=#__codelineno-7-15></a><span class=s2>        - Duration: </span><span class=si>{</span><span class=n>voyage_details</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;duration&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;Not specified&#39;</span><span class=p>)</span><span class=si>}</span>
</span><span id=__span-7-16><a id=__codelineno-7-16 name=__codelineno-7-16 href=#__codelineno-7-16></a><span class=s2>        - Special Requirements: </span><span class=si>{</span><span class=n>voyage_details</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;requirements&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;Standard operation&#39;</span><span class=p>)</span><span class=si>}</span>
</span><span id=__span-7-17><a id=__codelineno-7-17 name=__codelineno-7-17 href=#__codelineno-7-17></a><span class=s2>        - Departure Date: </span><span class=si>{</span><span class=n>voyage_details</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;departure_date&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;Not specified&#39;</span><span class=p>)</span><span class=si>}</span>
</span><span id=__span-7-18><a id=__codelineno-7-18 name=__codelineno-7-18 href=#__codelineno-7-18></a>
</span><span id=__span-7-19><a id=__codelineno-7-19 name=__codelineno-7-19 href=#__codelineno-7-19></a><span class=s2>        Please help me:</span>
</span><span id=__span-7-20><a id=__codelineno-7-20 name=__codelineno-7-20 href=#__codelineno-7-20></a><span class=s2>        1. Assess the current compliance status of the vessel</span>
</span><span id=__span-7-21><a id=__codelineno-7-21 name=__codelineno-7-21 href=#__codelineno-7-21></a><span class=s2>        2. Identify available crew members suitable for this voyage</span>
</span><span id=__span-7-22><a id=__codelineno-7-22 name=__codelineno-7-22 href=#__codelineno-7-22></a><span class=s2>        3. Check certificate validity for the voyage duration</span>
</span><span id=__span-7-23><a id=__codelineno-7-23 name=__codelineno-7-23 href=#__codelineno-7-23></a><span class=s2>        4. Recommend optimal crew assignments</span>
</span><span id=__span-7-24><a id=__codelineno-7-24 name=__codelineno-7-24 href=#__codelineno-7-24></a><span class=s2>        5. Highlight any risks or concerns</span>
</span><span id=__span-7-25><a id=__codelineno-7-25 name=__codelineno-7-25 href=#__codelineno-7-25></a><span class=s2>        6. Suggest specific actions to ensure successful deployment</span>
</span><span id=__span-7-26><a id=__codelineno-7-26 name=__codelineno-7-26 href=#__codelineno-7-26></a>
</span><span id=__span-7-27><a id=__codelineno-7-27 name=__codelineno-7-27 href=#__codelineno-7-27></a><span class=s2>        Consider factors like:</span>
</span><span id=__span-7-28><a id=__codelineno-7-28 name=__codelineno-7-28 href=#__codelineno-7-28></a><span class=s2>        - Certificate expiry dates vs voyage duration</span>
</span><span id=__span-7-29><a id=__codelineno-7-29 name=__codelineno-7-29 href=#__codelineno-7-29></a><span class=s2>        - Crew experience and qualifications for the route/operation</span>
</span><span id=__span-7-30><a id=__codelineno-7-30 name=__codelineno-7-30 href=#__codelineno-7-30></a><span class=s2>        - Regulatory requirements for the destination</span>
</span><span id=__span-7-31><a id=__codelineno-7-31 name=__codelineno-7-31 href=#__codelineno-7-31></a><span class=s2>        - Crew availability and rotation schedules</span>
</span><span id=__span-7-32><a id=__codelineno-7-32 name=__codelineno-7-32 href=#__codelineno-7-32></a><span class=s2>        &quot;&quot;&quot;</span>
</span><span id=__span-7-33><a id=__codelineno-7-33 name=__codelineno-7-33 href=#__codelineno-7-33></a>
</span><span id=__span-7-34><a id=__codelineno-7-34 name=__codelineno-7-34 href=#__codelineno-7-34></a>        <span class=n>message</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>claude_client</span><span class=o>.</span><span class=n>messages</span><span class=o>.</span><span class=n>create</span><span class=p>(</span>
</span><span id=__span-7-35><a id=__codelineno-7-35 name=__codelineno-7-35 href=#__codelineno-7-35></a>            <span class=n>model</span><span class=o>=</span><span class=s2>&quot;claude-3-5-sonnet-20241022&quot;</span><span class=p>,</span>
</span><span id=__span-7-36><a id=__codelineno-7-36 name=__codelineno-7-36 href=#__codelineno-7-36></a>            <span class=n>max_tokens</span><span class=o>=</span><span class=mi>3000</span><span class=p>,</span>
</span><span id=__span-7-37><a id=__codelineno-7-37 name=__codelineno-7-37 href=#__codelineno-7-37></a>            <span class=n>system</span><span class=o>=</span><span class=s2>&quot;&quot;&quot;You are an expert maritime crew planner with deep knowledge of:</span>
</span><span id=__span-7-38><a id=__codelineno-7-38 name=__codelineno-7-38 href=#__codelineno-7-38></a><span class=s2>            - International maritime regulations (STCW, MLC, etc.)</span>
</span><span id=__span-7-39><a id=__codelineno-7-39 name=__codelineno-7-39 href=#__codelineno-7-39></a><span class=s2>            - Crew rotation and fatigue management</span>
</span><span id=__span-7-40><a id=__codelineno-7-40 name=__codelineno-7-40 href=#__codelineno-7-40></a><span class=s2>            - Route-specific requirements and challenges</span>
</span><span id=__span-7-41><a id=__codelineno-7-41 name=__codelineno-7-41 href=#__codelineno-7-41></a><span class=s2>            - Risk assessment and mitigation strategies</span>
</span><span id=__span-7-42><a id=__codelineno-7-42 name=__codelineno-7-42 href=#__codelineno-7-42></a>
</span><span id=__span-7-43><a id=__codelineno-7-43 name=__codelineno-7-43 href=#__codelineno-7-43></a><span class=s2>            Your planning approach:</span>
</span><span id=__span-7-44><a id=__codelineno-7-44 name=__codelineno-7-44 href=#__codelineno-7-44></a><span class=s2>            1. Always start with compliance and safety assessment</span>
</span><span id=__span-7-45><a id=__codelineno-7-45 name=__codelineno-7-45 href=#__codelineno-7-45></a><span class=s2>            2. Use multiple tools to gather comprehensive information</span>
</span><span id=__span-7-46><a id=__codelineno-7-46 name=__codelineno-7-46 href=#__codelineno-7-46></a><span class=s2>            3. Provide specific, actionable recommendations</span>
</span><span id=__span-7-47><a id=__codelineno-7-47 name=__codelineno-7-47 href=#__codelineno-7-47></a><span class=s2>            4. Identify and prioritize risks</span>
</span><span id=__span-7-48><a id=__codelineno-7-48 name=__codelineno-7-48 href=#__codelineno-7-48></a><span class=s2>            5. Create contingency plans for identified issues</span>
</span><span id=__span-7-49><a id=__codelineno-7-49 name=__codelineno-7-49 href=#__codelineno-7-49></a><span class=s2>            6. Consider operational efficiency and crew welfare&quot;&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-7-50><a id=__codelineno-7-50 name=__codelineno-7-50 href=#__codelineno-7-50></a>            <span class=n>messages</span><span class=o>=</span><span class=p>[{</span>
</span><span id=__span-7-51><a id=__codelineno-7-51 name=__codelineno-7-51 href=#__codelineno-7-51></a>                <span class=s2>&quot;role&quot;</span><span class=p>:</span> <span class=s2>&quot;user&quot;</span><span class=p>,</span>
</span><span id=__span-7-52><a id=__codelineno-7-52 name=__codelineno-7-52 href=#__codelineno-7-52></a>                <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=n>planning_prompt</span>
</span><span id=__span-7-53><a id=__codelineno-7-53 name=__codelineno-7-53 href=#__codelineno-7-53></a>            <span class=p>}],</span>
</span><span id=__span-7-54><a id=__codelineno-7-54 name=__codelineno-7-54 href=#__codelineno-7-54></a>            <span class=n>tools</span><span class=o>=</span><span class=n>CREW_MCP_CLAUDE_TOOLS</span>
</span><span id=__span-7-55><a id=__codelineno-7-55 name=__codelineno-7-55 href=#__codelineno-7-55></a>        <span class=p>)</span>
</span><span id=__span-7-56><a id=__codelineno-7-56 name=__codelineno-7-56 href=#__codelineno-7-56></a>
</span><span id=__span-7-57><a id=__codelineno-7-57 name=__codelineno-7-57 href=#__codelineno-7-57></a>        <span class=c1># Process the complete planning workflow</span>
</span><span id=__span-7-58><a id=__codelineno-7-58 name=__codelineno-7-58 href=#__codelineno-7-58></a>        <span class=n>conversation</span> <span class=o>=</span> <span class=p>[{</span><span class=s2>&quot;role&quot;</span><span class=p>:</span> <span class=s2>&quot;user&quot;</span><span class=p>,</span> <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=n>planning_prompt</span><span class=p>}]</span>
</span><span id=__span-7-59><a id=__codelineno-7-59 name=__codelineno-7-59 href=#__codelineno-7-59></a>        <span class=n>current_message</span> <span class=o>=</span> <span class=n>message</span>
</span><span id=__span-7-60><a id=__codelineno-7-60 name=__codelineno-7-60 href=#__codelineno-7-60></a>        <span class=n>conversation</span><span class=o>.</span><span class=n>append</span><span class=p>({</span><span class=s2>&quot;role&quot;</span><span class=p>:</span> <span class=s2>&quot;assistant&quot;</span><span class=p>,</span> <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=n>current_message</span><span class=o>.</span><span class=n>content</span><span class=p>})</span>
</span><span id=__span-7-61><a id=__codelineno-7-61 name=__codelineno-7-61 href=#__codelineno-7-61></a>
</span><span id=__span-7-62><a id=__codelineno-7-62 name=__codelineno-7-62 href=#__codelineno-7-62></a>        <span class=c1># Continue until planning is complete</span>
</span><span id=__span-7-63><a id=__codelineno-7-63 name=__codelineno-7-63 href=#__codelineno-7-63></a>        <span class=k>while</span> <span class=nb>any</span><span class=p>(</span><span class=n>content</span><span class=o>.</span><span class=n>type</span> <span class=o>==</span> <span class=s2>&quot;tool_use&quot;</span> <span class=k>for</span> <span class=n>content</span> <span class=ow>in</span> <span class=n>current_message</span><span class=o>.</span><span class=n>content</span><span class=p>):</span>
</span><span id=__span-7-64><a id=__codelineno-7-64 name=__codelineno-7-64 href=#__codelineno-7-64></a>            <span class=n>tool_results</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-7-65><a id=__codelineno-7-65 name=__codelineno-7-65 href=#__codelineno-7-65></a>
</span><span id=__span-7-66><a id=__codelineno-7-66 name=__codelineno-7-66 href=#__codelineno-7-66></a>            <span class=k>for</span> <span class=n>content_block</span> <span class=ow>in</span> <span class=n>current_message</span><span class=o>.</span><span class=n>content</span><span class=p>:</span>
</span><span id=__span-7-67><a id=__codelineno-7-67 name=__codelineno-7-67 href=#__codelineno-7-67></a>                <span class=k>if</span> <span class=n>content_block</span><span class=o>.</span><span class=n>type</span> <span class=o>==</span> <span class=s2>&quot;tool_use&quot;</span><span class=p>:</span>
</span><span id=__span-7-68><a id=__codelineno-7-68 name=__codelineno-7-68 href=#__codelineno-7-68></a>                    <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>execute_tool</span><span class=p>(</span>
</span><span id=__span-7-69><a id=__codelineno-7-69 name=__codelineno-7-69 href=#__codelineno-7-69></a>                        <span class=n>content_block</span><span class=o>.</span><span class=n>name</span><span class=p>,</span>
</span><span id=__span-7-70><a id=__codelineno-7-70 name=__codelineno-7-70 href=#__codelineno-7-70></a>                        <span class=n>content_block</span><span class=o>.</span><span class=n>input</span>
</span><span id=__span-7-71><a id=__codelineno-7-71 name=__codelineno-7-71 href=#__codelineno-7-71></a>                    <span class=p>)</span>
</span><span id=__span-7-72><a id=__codelineno-7-72 name=__codelineno-7-72 href=#__codelineno-7-72></a>                    <span class=n>tool_results</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span><span id=__span-7-73><a id=__codelineno-7-73 name=__codelineno-7-73 href=#__codelineno-7-73></a>                        <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;tool_result&quot;</span><span class=p>,</span>
</span><span id=__span-7-74><a id=__codelineno-7-74 name=__codelineno-7-74 href=#__codelineno-7-74></a>                        <span class=s2>&quot;tool_use_id&quot;</span><span class=p>:</span> <span class=n>content_block</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
</span><span id=__span-7-75><a id=__codelineno-7-75 name=__codelineno-7-75 href=#__codelineno-7-75></a>                        <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>result</span><span class=p>,</span> <span class=n>indent</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span>
</span><span id=__span-7-76><a id=__codelineno-7-76 name=__codelineno-7-76 href=#__codelineno-7-76></a>                    <span class=p>})</span>
</span><span id=__span-7-77><a id=__codelineno-7-77 name=__codelineno-7-77 href=#__codelineno-7-77></a>
</span><span id=__span-7-78><a id=__codelineno-7-78 name=__codelineno-7-78 href=#__codelineno-7-78></a>            <span class=n>conversation</span><span class=o>.</span><span class=n>append</span><span class=p>({</span><span class=s2>&quot;role&quot;</span><span class=p>:</span> <span class=s2>&quot;user&quot;</span><span class=p>,</span> <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=n>tool_results</span><span class=p>})</span>
</span><span id=__span-7-79><a id=__codelineno-7-79 name=__codelineno-7-79 href=#__codelineno-7-79></a>
</span><span id=__span-7-80><a id=__codelineno-7-80 name=__codelineno-7-80 href=#__codelineno-7-80></a>            <span class=n>current_message</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>claude_client</span><span class=o>.</span><span class=n>messages</span><span class=o>.</span><span class=n>create</span><span class=p>(</span>
</span><span id=__span-7-81><a id=__codelineno-7-81 name=__codelineno-7-81 href=#__codelineno-7-81></a>                <span class=n>model</span><span class=o>=</span><span class=s2>&quot;claude-3-5-sonnet-20241022&quot;</span><span class=p>,</span>
</span><span id=__span-7-82><a id=__codelineno-7-82 name=__codelineno-7-82 href=#__codelineno-7-82></a>                <span class=n>max_tokens</span><span class=o>=</span><span class=mi>3000</span><span class=p>,</span>
</span><span id=__span-7-83><a id=__codelineno-7-83 name=__codelineno-7-83 href=#__codelineno-7-83></a>                <span class=n>messages</span><span class=o>=</span><span class=n>conversation</span><span class=p>,</span>
</span><span id=__span-7-84><a id=__codelineno-7-84 name=__codelineno-7-84 href=#__codelineno-7-84></a>                <span class=n>tools</span><span class=o>=</span><span class=n>CREW_MCP_CLAUDE_TOOLS</span>
</span><span id=__span-7-85><a id=__codelineno-7-85 name=__codelineno-7-85 href=#__codelineno-7-85></a>            <span class=p>)</span>
</span><span id=__span-7-86><a id=__codelineno-7-86 name=__codelineno-7-86 href=#__codelineno-7-86></a>
</span><span id=__span-7-87><a id=__codelineno-7-87 name=__codelineno-7-87 href=#__codelineno-7-87></a>            <span class=n>conversation</span><span class=o>.</span><span class=n>append</span><span class=p>({</span><span class=s2>&quot;role&quot;</span><span class=p>:</span> <span class=s2>&quot;assistant&quot;</span><span class=p>,</span> <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=n>current_message</span><span class=o>.</span><span class=n>content</span><span class=p>})</span>
</span><span id=__span-7-88><a id=__codelineno-7-88 name=__codelineno-7-88 href=#__codelineno-7-88></a>
</span><span id=__span-7-89><a id=__codelineno-7-89 name=__codelineno-7-89 href=#__codelineno-7-89></a>        <span class=c1># Extract final recommendations</span>
</span><span id=__span-7-90><a id=__codelineno-7-90 name=__codelineno-7-90 href=#__codelineno-7-90></a>        <span class=n>final_response</span> <span class=o>=</span> <span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>join</span><span class=p>([</span>
</span><span id=__span-7-91><a id=__codelineno-7-91 name=__codelineno-7-91 href=#__codelineno-7-91></a>            <span class=n>content</span><span class=o>.</span><span class=n>text</span> <span class=k>for</span> <span class=n>content</span> <span class=ow>in</span> <span class=n>current_message</span><span class=o>.</span><span class=n>content</span>
</span><span id=__span-7-92><a id=__codelineno-7-92 name=__codelineno-7-92 href=#__codelineno-7-92></a>            <span class=k>if</span> <span class=n>content</span><span class=o>.</span><span class=n>type</span> <span class=o>==</span> <span class=s2>&quot;text&quot;</span>
</span><span id=__span-7-93><a id=__codelineno-7-93 name=__codelineno-7-93 href=#__codelineno-7-93></a>        <span class=p>])</span>
</span><span id=__span-7-94><a id=__codelineno-7-94 name=__codelineno-7-94 href=#__codelineno-7-94></a>
</span><span id=__span-7-95><a id=__codelineno-7-95 name=__codelineno-7-95 href=#__codelineno-7-95></a>        <span class=k>return</span> <span class=p>{</span>
</span><span id=__span-7-96><a id=__codelineno-7-96 name=__codelineno-7-96 href=#__codelineno-7-96></a>            <span class=s2>&quot;vessel_id&quot;</span><span class=p>:</span> <span class=n>vessel_id</span><span class=p>,</span>
</span><span id=__span-7-97><a id=__codelineno-7-97 name=__codelineno-7-97 href=#__codelineno-7-97></a>            <span class=s2>&quot;voyage_details&quot;</span><span class=p>:</span> <span class=n>voyage_details</span><span class=p>,</span>
</span><span id=__span-7-98><a id=__codelineno-7-98 name=__codelineno-7-98 href=#__codelineno-7-98></a>            <span class=s2>&quot;planning_results&quot;</span><span class=p>:</span> <span class=n>final_response</span><span class=p>,</span>
</span><span id=__span-7-99><a id=__codelineno-7-99 name=__codelineno-7-99 href=#__codelineno-7-99></a>            <span class=s2>&quot;conversation_log&quot;</span><span class=p>:</span> <span class=n>conversation</span>
</span><span id=__span-7-100><a id=__codelineno-7-100 name=__codelineno-7-100 href=#__codelineno-7-100></a>        <span class=p>}</span>
</span><span id=__span-7-101><a id=__codelineno-7-101 name=__codelineno-7-101 href=#__codelineno-7-101></a>
</span><span id=__span-7-102><a id=__codelineno-7-102 name=__codelineno-7-102 href=#__codelineno-7-102></a><span class=c1># Usage example</span>
</span><span id=__span-7-103><a id=__codelineno-7-103 name=__codelineno-7-103 href=#__codelineno-7-103></a><span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>comprehensive_planning_example</span><span class=p>():</span>
</span><span id=__span-7-104><a id=__codelineno-7-104 name=__codelineno-7-104 href=#__codelineno-7-104></a>    <span class=n>planner</span> <span class=o>=</span> <span class=n>IntelligentCrewPlanner</span><span class=p>()</span>
</span><span id=__span-7-105><a id=__codelineno-7-105 name=__codelineno-7-105 href=#__codelineno-7-105></a>
</span><span id=__span-7-106><a id=__codelineno-7-106 name=__codelineno-7-106 href=#__codelineno-7-106></a>    <span class=n>voyage_details</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-7-107><a id=__codelineno-7-107 name=__codelineno-7-107 href=#__codelineno-7-107></a>        <span class=s2>&quot;destination&quot;</span><span class=p>:</span> <span class=s2>&quot;North Sea (Norwegian sector)&quot;</span><span class=p>,</span>
</span><span id=__span-7-108><a id=__codelineno-7-108 name=__codelineno-7-108 href=#__codelineno-7-108></a>        <span class=s2>&quot;duration&quot;</span><span class=p>:</span> <span class=s2>&quot;90 days&quot;</span><span class=p>,</span>
</span><span id=__span-7-109><a id=__codelineno-7-109 name=__codelineno-7-109 href=#__codelineno-7-109></a>        <span class=s2>&quot;departure_date&quot;</span><span class=p>:</span> <span class=s2>&quot;2025-02-01&quot;</span><span class=p>,</span>
</span><span id=__span-7-110><a id=__codelineno-7-110 name=__codelineno-7-110 href=#__codelineno-7-110></a>        <span class=s2>&quot;requirements&quot;</span><span class=p>:</span> <span class=s2>&quot;Offshore support operations, helicopter deck operations, dynamic positioning&quot;</span>
</span><span id=__span-7-111><a id=__codelineno-7-111 name=__codelineno-7-111 href=#__codelineno-7-111></a>    <span class=p>}</span>
</span><span id=__span-7-112><a id=__codelineno-7-112 name=__codelineno-7-112 href=#__codelineno-7-112></a>
</span><span id=__span-7-113><a id=__codelineno-7-113 name=__codelineno-7-113 href=#__codelineno-7-113></a>    <span class=n>planning_result</span> <span class=o>=</span> <span class=k>await</span> <span class=n>planner</span><span class=o>.</span><span class=n>plan_vessel_crewing</span><span class=p>(</span>
</span><span id=__span-7-114><a id=__codelineno-7-114 name=__codelineno-7-114 href=#__codelineno-7-114></a>        <span class=n>vessel_id</span><span class=o>=</span><span class=s2>&quot;vessel-123&quot;</span><span class=p>,</span>
</span><span id=__span-7-115><a id=__codelineno-7-115 name=__codelineno-7-115 href=#__codelineno-7-115></a>        <span class=n>voyage_details</span><span class=o>=</span><span class=n>voyage_details</span>
</span><span id=__span-7-116><a id=__codelineno-7-116 name=__codelineno-7-116 href=#__codelineno-7-116></a>    <span class=p>)</span>
</span><span id=__span-7-117><a id=__codelineno-7-117 name=__codelineno-7-117 href=#__codelineno-7-117></a>
</span><span id=__span-7-118><a id=__codelineno-7-118 name=__codelineno-7-118 href=#__codelineno-7-118></a>    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;=== COMPREHENSIVE CREWING PLAN ===&quot;</span><span class=p>)</span>
</span><span id=__span-7-119><a id=__codelineno-7-119 name=__codelineno-7-119 href=#__codelineno-7-119></a>    <span class=nb>print</span><span class=p>(</span><span class=n>planning_result</span><span class=p>[</span><span class=s2>&quot;planning_results&quot;</span><span class=p>])</span>
</span></code></pre></div> <h2 id=claude-specific-optimizations>Claude-Specific Optimizations<a class=headerlink href=#claude-specific-optimizations title="Anchor link to this section for reference">&para;</a></h2> <h3 id=leveraging-claudes-reasoning-capabilities>Leveraging Claude's Reasoning Capabilities<a class=headerlink href=#leveraging-claudes-reasoning-capabilities title="Anchor link to this section for reference">&para;</a></h3> <div class="language-python highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=k>class</span><span class=w> </span><span class=nc>ClaudeReasoningEnhancedClient</span><span class=p>(</span><span class=n>CrewMCPClaudeClient</span><span class=p>):</span>
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Enhanced client that leverages Claude&#39;s reasoning for better decision making&quot;&quot;&quot;</span>
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a>
</span><span id=__span-8-4><a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a>    <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>analyze_with_reasoning</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>query</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>context</span><span class=p>:</span> <span class=n>Dict</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>:</span>
</span><span id=__span-8-5><a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Use Claude&#39;s reasoning capabilities for complex analysis&quot;&quot;&quot;</span>
</span><span id=__span-8-6><a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a>
</span><span id=__span-8-7><a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a>        <span class=n>reasoning_prompt</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;&quot;&quot;</span>
</span><span id=__span-8-8><a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a><span class=s2>        Please analyze this crew management query step by step:</span>
</span><span id=__span-8-9><a id=__codelineno-8-9 name=__codelineno-8-9 href=#__codelineno-8-9></a>
</span><span id=__span-8-10><a id=__codelineno-8-10 name=__codelineno-8-10 href=#__codelineno-8-10></a><span class=s2>        Query: </span><span class=si>{</span><span class=n>query</span><span class=si>}</span>
</span><span id=__span-8-11><a id=__codelineno-8-11 name=__codelineno-8-11 href=#__codelineno-8-11></a>
</span><span id=__span-8-12><a id=__codelineno-8-12 name=__codelineno-8-12 href=#__codelineno-8-12></a><span class=s2>        </span><span class=si>{</span><span class=sa>f</span><span class=s2>&quot;Context: </span><span class=si>{</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>context</span><span class=p>,</span><span class=w> </span><span class=n>indent</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=n>context</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=s2>&quot;&quot;</span><span class=si>}</span>
</span><span id=__span-8-13><a id=__codelineno-8-13 name=__codelineno-8-13 href=#__codelineno-8-13></a>
</span><span id=__span-8-14><a id=__codelineno-8-14 name=__codelineno-8-14 href=#__codelineno-8-14></a><span class=s2>        I want you to:</span>
</span><span id=__span-8-15><a id=__codelineno-8-15 name=__codelineno-8-15 href=#__codelineno-8-15></a><span class=s2>        1. Break down the query into specific components</span>
</span><span id=__span-8-16><a id=__codelineno-8-16 name=__codelineno-8-16 href=#__codelineno-8-16></a><span class=s2>        2. Determine what information you need to gather</span>
</span><span id=__span-8-17><a id=__codelineno-8-17 name=__codelineno-8-17 href=#__codelineno-8-17></a><span class=s2>        3. Plan your approach using available tools</span>
</span><span id=__span-8-18><a id=__codelineno-8-18 name=__codelineno-8-18 href=#__codelineno-8-18></a><span class=s2>        4. Execute your plan systematically</span>
</span><span id=__span-8-19><a id=__codelineno-8-19 name=__codelineno-8-19 href=#__codelineno-8-19></a><span class=s2>        5. Analyze the results holistically</span>
</span><span id=__span-8-20><a id=__codelineno-8-20 name=__codelineno-8-20 href=#__codelineno-8-20></a><span class=s2>        6. Provide clear recommendations with reasoning</span>
</span><span id=__span-8-21><a id=__codelineno-8-21 name=__codelineno-8-21 href=#__codelineno-8-21></a>
</span><span id=__span-8-22><a id=__codelineno-8-22 name=__codelineno-8-22 href=#__codelineno-8-22></a><span class=s2>        Think through each step carefully and explain your reasoning process.</span>
</span><span id=__span-8-23><a id=__codelineno-8-23 name=__codelineno-8-23 href=#__codelineno-8-23></a><span class=s2>        &quot;&quot;&quot;</span>
</span><span id=__span-8-24><a id=__codelineno-8-24 name=__codelineno-8-24 href=#__codelineno-8-24></a>
</span><span id=__span-8-25><a id=__codelineno-8-25 name=__codelineno-8-25 href=#__codelineno-8-25></a>        <span class=n>message</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>claude_client</span><span class=o>.</span><span class=n>messages</span><span class=o>.</span><span class=n>create</span><span class=p>(</span>
</span><span id=__span-8-26><a id=__codelineno-8-26 name=__codelineno-8-26 href=#__codelineno-8-26></a>            <span class=n>model</span><span class=o>=</span><span class=s2>&quot;claude-3-5-sonnet-20241022&quot;</span><span class=p>,</span>
</span><span id=__span-8-27><a id=__codelineno-8-27 name=__codelineno-8-27 href=#__codelineno-8-27></a>            <span class=n>max_tokens</span><span class=o>=</span><span class=mi>4000</span><span class=p>,</span>
</span><span id=__span-8-28><a id=__codelineno-8-28 name=__codelineno-8-28 href=#__codelineno-8-28></a>            <span class=n>system</span><span class=o>=</span><span class=s2>&quot;&quot;&quot;You are an expert maritime operations analyst with advanced reasoning capabilities.</span>
</span><span id=__span-8-29><a id=__codelineno-8-29 name=__codelineno-8-29 href=#__codelineno-8-29></a>
</span><span id=__span-8-30><a id=__codelineno-8-30 name=__codelineno-8-30 href=#__codelineno-8-30></a><span class=s2>            Your analytical approach:</span>
</span><span id=__span-8-31><a id=__codelineno-8-31 name=__codelineno-8-31 href=#__codelineno-8-31></a><span class=s2>            1. Think systematically and break down complex problems</span>
</span><span id=__span-8-32><a id=__codelineno-8-32 name=__codelineno-8-32 href=#__codelineno-8-32></a><span class=s2>            2. Gather comprehensive information before making decisions</span>
</span><span id=__span-8-33><a id=__codelineno-8-33 name=__codelineno-8-33 href=#__codelineno-8-33></a><span class=s2>            3. Consider multiple perspectives and potential outcomes</span>
</span><span id=__span-8-34><a id=__codelineno-8-34 name=__codelineno-8-34 href=#__codelineno-8-34></a><span class=s2>            4. Provide clear reasoning for all recommendations</span>
</span><span id=__span-8-35><a id=__codelineno-8-35 name=__codelineno-8-35 href=#__codelineno-8-35></a><span class=s2>            5. Anticipate edge cases and potential issues</span>
</span><span id=__span-8-36><a id=__codelineno-8-36 name=__codelineno-8-36 href=#__codelineno-8-36></a><span class=s2>            6. Balance competing priorities (safety, compliance, efficiency, cost)</span>
</span><span id=__span-8-37><a id=__codelineno-8-37 name=__codelineno-8-37 href=#__codelineno-8-37></a>
</span><span id=__span-8-38><a id=__codelineno-8-38 name=__codelineno-8-38 href=#__codelineno-8-38></a><span class=s2>            When using tools:</span>
</span><span id=__span-8-39><a id=__codelineno-8-39 name=__codelineno-8-39 href=#__codelineno-8-39></a><span class=s2>            - Explain why you&#39;re choosing specific tools and parameters</span>
</span><span id=__span-8-40><a id=__codelineno-8-40 name=__codelineno-8-40 href=#__codelineno-8-40></a><span class=s2>            - Interpret results in context of the broader question</span>
</span><span id=__span-8-41><a id=__codelineno-8-41 name=__codelineno-8-41 href=#__codelineno-8-41></a><span class=s2>            - Look for patterns and relationships in the data</span>
</span><span id=__span-8-42><a id=__codelineno-8-42 name=__codelineno-8-42 href=#__codelineno-8-42></a><span class=s2>            - Consider both immediate and long-term implications&quot;&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-8-43><a id=__codelineno-8-43 name=__codelineno-8-43 href=#__codelineno-8-43></a>            <span class=n>messages</span><span class=o>=</span><span class=p>[{</span>
</span><span id=__span-8-44><a id=__codelineno-8-44 name=__codelineno-8-44 href=#__codelineno-8-44></a>                <span class=s2>&quot;role&quot;</span><span class=p>:</span> <span class=s2>&quot;user&quot;</span><span class=p>,</span>
</span><span id=__span-8-45><a id=__codelineno-8-45 name=__codelineno-8-45 href=#__codelineno-8-45></a>                <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=n>reasoning_prompt</span>
</span><span id=__span-8-46><a id=__codelineno-8-46 name=__codelineno-8-46 href=#__codelineno-8-46></a>            <span class=p>}],</span>
</span><span id=__span-8-47><a id=__codelineno-8-47 name=__codelineno-8-47 href=#__codelineno-8-47></a>            <span class=n>tools</span><span class=o>=</span><span class=n>CREW_MCP_CLAUDE_TOOLS</span>
</span><span id=__span-8-48><a id=__codelineno-8-48 name=__codelineno-8-48 href=#__codelineno-8-48></a>        <span class=p>)</span>
</span><span id=__span-8-49><a id=__codelineno-8-49 name=__codelineno-8-49 href=#__codelineno-8-49></a>
</span><span id=__span-8-50><a id=__codelineno-8-50 name=__codelineno-8-50 href=#__codelineno-8-50></a>        <span class=c1># Process the complete reasoning workflow</span>
</span><span id=__span-8-51><a id=__codelineno-8-51 name=__codelineno-8-51 href=#__codelineno-8-51></a>        <span class=n>analysis_result</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_process_complete_workflow</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
</span><span id=__span-8-52><a id=__codelineno-8-52 name=__codelineno-8-52 href=#__codelineno-8-52></a>
</span><span id=__span-8-53><a id=__codelineno-8-53 name=__codelineno-8-53 href=#__codelineno-8-53></a>        <span class=k>return</span> <span class=p>{</span>
</span><span id=__span-8-54><a id=__codelineno-8-54 name=__codelineno-8-54 href=#__codelineno-8-54></a>            <span class=s2>&quot;query&quot;</span><span class=p>:</span> <span class=n>query</span><span class=p>,</span>
</span><span id=__span-8-55><a id=__codelineno-8-55 name=__codelineno-8-55 href=#__codelineno-8-55></a>            <span class=s2>&quot;context&quot;</span><span class=p>:</span> <span class=n>context</span><span class=p>,</span>
</span><span id=__span-8-56><a id=__codelineno-8-56 name=__codelineno-8-56 href=#__codelineno-8-56></a>            <span class=s2>&quot;analysis&quot;</span><span class=p>:</span> <span class=n>analysis_result</span><span class=p>,</span>
</span><span id=__span-8-57><a id=__codelineno-8-57 name=__codelineno-8-57 href=#__codelineno-8-57></a>            <span class=s2>&quot;reasoning_approach&quot;</span><span class=p>:</span> <span class=s2>&quot;systematic_breakdown&quot;</span>
</span><span id=__span-8-58><a id=__codelineno-8-58 name=__codelineno-8-58 href=#__codelineno-8-58></a>        <span class=p>}</span>
</span><span id=__span-8-59><a id=__codelineno-8-59 name=__codelineno-8-59 href=#__codelineno-8-59></a>
</span><span id=__span-8-60><a id=__codelineno-8-60 name=__codelineno-8-60 href=#__codelineno-8-60></a>    <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>_process_complete_workflow</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>initial_message</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span><span id=__span-8-61><a id=__codelineno-8-61 name=__codelineno-8-61 href=#__codelineno-8-61></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Process complete workflow until Claude reaches conclusions&quot;&quot;&quot;</span>
</span><span id=__span-8-62><a id=__codelineno-8-62 name=__codelineno-8-62 href=#__codelineno-8-62></a>
</span><span id=__span-8-63><a id=__codelineno-8-63 name=__codelineno-8-63 href=#__codelineno-8-63></a>        <span class=n>conversation</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-8-64><a id=__codelineno-8-64 name=__codelineno-8-64 href=#__codelineno-8-64></a>        <span class=n>current_message</span> <span class=o>=</span> <span class=n>initial_message</span>
</span><span id=__span-8-65><a id=__codelineno-8-65 name=__codelineno-8-65 href=#__codelineno-8-65></a>
</span><span id=__span-8-66><a id=__codelineno-8-66 name=__codelineno-8-66 href=#__codelineno-8-66></a>        <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span><span id=__span-8-67><a id=__codelineno-8-67 name=__codelineno-8-67 href=#__codelineno-8-67></a>            <span class=n>conversation</span><span class=o>.</span><span class=n>append</span><span class=p>({</span><span class=s2>&quot;role&quot;</span><span class=p>:</span> <span class=s2>&quot;assistant&quot;</span><span class=p>,</span> <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=n>current_message</span><span class=o>.</span><span class=n>content</span><span class=p>})</span>
</span><span id=__span-8-68><a id=__codelineno-8-68 name=__codelineno-8-68 href=#__codelineno-8-68></a>
</span><span id=__span-8-69><a id=__codelineno-8-69 name=__codelineno-8-69 href=#__codelineno-8-69></a>            <span class=c1># Check if there are tool calls to process</span>
</span><span id=__span-8-70><a id=__codelineno-8-70 name=__codelineno-8-70 href=#__codelineno-8-70></a>            <span class=n>tool_calls</span> <span class=o>=</span> <span class=p>[</span><span class=n>c</span> <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>current_message</span><span class=o>.</span><span class=n>content</span> <span class=k>if</span> <span class=n>c</span><span class=o>.</span><span class=n>type</span> <span class=o>==</span> <span class=s2>&quot;tool_use&quot;</span><span class=p>]</span>
</span><span id=__span-8-71><a id=__codelineno-8-71 name=__codelineno-8-71 href=#__codelineno-8-71></a>
</span><span id=__span-8-72><a id=__codelineno-8-72 name=__codelineno-8-72 href=#__codelineno-8-72></a>            <span class=k>if</span> <span class=ow>not</span> <span class=n>tool_calls</span><span class=p>:</span>
</span><span id=__span-8-73><a id=__codelineno-8-73 name=__codelineno-8-73 href=#__codelineno-8-73></a>                <span class=c1># No more tool calls, extract final response</span>
</span><span id=__span-8-74><a id=__codelineno-8-74 name=__codelineno-8-74 href=#__codelineno-8-74></a>                <span class=k>break</span>
</span><span id=__span-8-75><a id=__codelineno-8-75 name=__codelineno-8-75 href=#__codelineno-8-75></a>
</span><span id=__span-8-76><a id=__codelineno-8-76 name=__codelineno-8-76 href=#__codelineno-8-76></a>            <span class=c1># Process tool calls</span>
</span><span id=__span-8-77><a id=__codelineno-8-77 name=__codelineno-8-77 href=#__codelineno-8-77></a>            <span class=n>tool_results</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-8-78><a id=__codelineno-8-78 name=__codelineno-8-78 href=#__codelineno-8-78></a>            <span class=k>for</span> <span class=n>tool_call</span> <span class=ow>in</span> <span class=n>tool_calls</span><span class=p>:</span>
</span><span id=__span-8-79><a id=__codelineno-8-79 name=__codelineno-8-79 href=#__codelineno-8-79></a>                <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>execute_tool</span><span class=p>(</span><span class=n>tool_call</span><span class=o>.</span><span class=n>name</span><span class=p>,</span> <span class=n>tool_call</span><span class=o>.</span><span class=n>input</span><span class=p>)</span>
</span><span id=__span-8-80><a id=__codelineno-8-80 name=__codelineno-8-80 href=#__codelineno-8-80></a>                <span class=n>tool_results</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span><span id=__span-8-81><a id=__codelineno-8-81 name=__codelineno-8-81 href=#__codelineno-8-81></a>                    <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;tool_result&quot;</span><span class=p>,</span>
</span><span id=__span-8-82><a id=__codelineno-8-82 name=__codelineno-8-82 href=#__codelineno-8-82></a>                    <span class=s2>&quot;tool_use_id&quot;</span><span class=p>:</span> <span class=n>tool_call</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
</span><span id=__span-8-83><a id=__codelineno-8-83 name=__codelineno-8-83 href=#__codelineno-8-83></a>                    <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>result</span><span class=p>,</span> <span class=n>indent</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span>
</span><span id=__span-8-84><a id=__codelineno-8-84 name=__codelineno-8-84 href=#__codelineno-8-84></a>                <span class=p>})</span>
</span><span id=__span-8-85><a id=__codelineno-8-85 name=__codelineno-8-85 href=#__codelineno-8-85></a>
</span><span id=__span-8-86><a id=__codelineno-8-86 name=__codelineno-8-86 href=#__codelineno-8-86></a>            <span class=n>conversation</span><span class=o>.</span><span class=n>append</span><span class=p>({</span><span class=s2>&quot;role&quot;</span><span class=p>:</span> <span class=s2>&quot;user&quot;</span><span class=p>,</span> <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=n>tool_results</span><span class=p>})</span>
</span><span id=__span-8-87><a id=__codelineno-8-87 name=__codelineno-8-87 href=#__codelineno-8-87></a>
</span><span id=__span-8-88><a id=__codelineno-8-88 name=__codelineno-8-88 href=#__codelineno-8-88></a>            <span class=c1># Get next response</span>
</span><span id=__span-8-89><a id=__codelineno-8-89 name=__codelineno-8-89 href=#__codelineno-8-89></a>            <span class=n>current_message</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>claude_client</span><span class=o>.</span><span class=n>messages</span><span class=o>.</span><span class=n>create</span><span class=p>(</span>
</span><span id=__span-8-90><a id=__codelineno-8-90 name=__codelineno-8-90 href=#__codelineno-8-90></a>                <span class=n>model</span><span class=o>=</span><span class=s2>&quot;claude-3-5-sonnet-20241022&quot;</span><span class=p>,</span>
</span><span id=__span-8-91><a id=__codelineno-8-91 name=__codelineno-8-91 href=#__codelineno-8-91></a>                <span class=n>max_tokens</span><span class=o>=</span><span class=mi>4000</span><span class=p>,</span>
</span><span id=__span-8-92><a id=__codelineno-8-92 name=__codelineno-8-92 href=#__codelineno-8-92></a>                <span class=n>messages</span><span class=o>=</span><span class=n>conversation</span><span class=p>,</span>
</span><span id=__span-8-93><a id=__codelineno-8-93 name=__codelineno-8-93 href=#__codelineno-8-93></a>                <span class=n>tools</span><span class=o>=</span><span class=n>CREW_MCP_CLAUDE_TOOLS</span>
</span><span id=__span-8-94><a id=__codelineno-8-94 name=__codelineno-8-94 href=#__codelineno-8-94></a>            <span class=p>)</span>
</span><span id=__span-8-95><a id=__codelineno-8-95 name=__codelineno-8-95 href=#__codelineno-8-95></a>
</span><span id=__span-8-96><a id=__codelineno-8-96 name=__codelineno-8-96 href=#__codelineno-8-96></a>        <span class=c1># Extract final text response</span>
</span><span id=__span-8-97><a id=__codelineno-8-97 name=__codelineno-8-97 href=#__codelineno-8-97></a>        <span class=k>return</span> <span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>join</span><span class=p>([</span>
</span><span id=__span-8-98><a id=__codelineno-8-98 name=__codelineno-8-98 href=#__codelineno-8-98></a>            <span class=n>content</span><span class=o>.</span><span class=n>text</span> <span class=k>for</span> <span class=n>content</span> <span class=ow>in</span> <span class=n>current_message</span><span class=o>.</span><span class=n>content</span>
</span><span id=__span-8-99><a id=__codelineno-8-99 name=__codelineno-8-99 href=#__codelineno-8-99></a>            <span class=k>if</span> <span class=n>content</span><span class=o>.</span><span class=n>type</span> <span class=o>==</span> <span class=s2>&quot;text&quot;</span>
</span><span id=__span-8-100><a id=__codelineno-8-100 name=__codelineno-8-100 href=#__codelineno-8-100></a>        <span class=p>])</span>
</span><span id=__span-8-101><a id=__codelineno-8-101 name=__codelineno-8-101 href=#__codelineno-8-101></a>
</span><span id=__span-8-102><a id=__codelineno-8-102 name=__codelineno-8-102 href=#__codelineno-8-102></a><span class=c1># Example usage</span>
</span><span id=__span-8-103><a id=__codelineno-8-103 name=__codelineno-8-103 href=#__codelineno-8-103></a><span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>reasoning_analysis_example</span><span class=p>():</span>
</span><span id=__span-8-104><a id=__codelineno-8-104 name=__codelineno-8-104 href=#__codelineno-8-104></a>    <span class=n>client</span> <span class=o>=</span> <span class=n>ClaudeReasoningEnhancedClient</span><span class=p>()</span>
</span><span id=__span-8-105><a id=__codelineno-8-105 name=__codelineno-8-105 href=#__codelineno-8-105></a>
</span><span id=__span-8-106><a id=__codelineno-8-106 name=__codelineno-8-106 href=#__codelineno-8-106></a>    <span class=n>complex_query</span> <span class=o>=</span> <span class=s2>&quot;&quot;&quot;</span>
</span><span id=__span-8-107><a id=__codelineno-8-107 name=__codelineno-8-107 href=#__codelineno-8-107></a><span class=s2>    Our company is expanding operations to the Arctic region. We need to:</span>
</span><span id=__span-8-108><a id=__codelineno-8-108 name=__codelineno-8-108 href=#__codelineno-8-108></a><span class=s2>    1. Assess our current crew capabilities for Arctic operations</span>
</span><span id=__span-8-109><a id=__codelineno-8-109 name=__codelineno-8-109 href=#__codelineno-8-109></a><span class=s2>    2. Identify training and certification gaps</span>
</span><span id=__span-8-110><a id=__codelineno-8-110 name=__codelineno-8-110 href=#__codelineno-8-110></a><span class=s2>    3. Plan crew assignments for 3 new Arctic-class vessels</span>
</span><span id=__span-8-111><a id=__codelineno-8-111 name=__codelineno-8-111 href=#__codelineno-8-111></a><span class=s2>    4. Ensure full compliance with polar code requirements</span>
</span><span id=__span-8-112><a id=__codelineno-8-112 name=__codelineno-8-112 href=#__codelineno-8-112></a><span class=s2>    5. Develop a 12-month crew rotation strategy</span>
</span><span id=__span-8-113><a id=__codelineno-8-113 name=__codelineno-8-113 href=#__codelineno-8-113></a>
</span><span id=__span-8-114><a id=__codelineno-8-114 name=__codelineno-8-114 href=#__codelineno-8-114></a><span class=s2>    The operations will involve ice-strengthened vessels, extended voyages,</span>
</span><span id=__span-8-115><a id=__codelineno-8-115 name=__codelineno-8-115 href=#__codelineno-8-115></a><span class=s2>    and extreme weather conditions. Safety and compliance are paramount.</span>
</span><span id=__span-8-116><a id=__codelineno-8-116 name=__codelineno-8-116 href=#__codelineno-8-116></a><span class=s2>    &quot;&quot;&quot;</span>
</span><span id=__span-8-117><a id=__codelineno-8-117 name=__codelineno-8-117 href=#__codelineno-8-117></a>
</span><span id=__span-8-118><a id=__codelineno-8-118 name=__codelineno-8-118 href=#__codelineno-8-118></a>    <span class=n>result</span> <span class=o>=</span> <span class=k>await</span> <span class=n>client</span><span class=o>.</span><span class=n>analyze_with_reasoning</span><span class=p>(</span>
</span><span id=__span-8-119><a id=__codelineno-8-119 name=__codelineno-8-119 href=#__codelineno-8-119></a>        <span class=n>query</span><span class=o>=</span><span class=n>complex_query</span><span class=p>,</span>
</span><span id=__span-8-120><a id=__codelineno-8-120 name=__codelineno-8-120 href=#__codelineno-8-120></a>        <span class=n>context</span><span class=o>=</span><span class=p>{</span>
</span><span id=__span-8-121><a id=__codelineno-8-121 name=__codelineno-8-121 href=#__codelineno-8-121></a>            <span class=s2>&quot;operation_type&quot;</span><span class=p>:</span> <span class=s2>&quot;Arctic commercial shipping&quot;</span><span class=p>,</span>
</span><span id=__span-8-122><a id=__codelineno-8-122 name=__codelineno-8-122 href=#__codelineno-8-122></a>            <span class=s2>&quot;vessel_count&quot;</span><span class=p>:</span> <span class=mi>3</span><span class=p>,</span>
</span><span id=__span-8-123><a id=__codelineno-8-123 name=__codelineno-8-123 href=#__codelineno-8-123></a>            <span class=s2>&quot;crew_per_vessel&quot;</span><span class=p>:</span> <span class=mi>20</span><span class=p>,</span>
</span><span id=__span-8-124><a id=__codelineno-8-124 name=__codelineno-8-124 href=#__codelineno-8-124></a>            <span class=s2>&quot;operation_start&quot;</span><span class=p>:</span> <span class=s2>&quot;2025-04-01&quot;</span>
</span><span id=__span-8-125><a id=__codelineno-8-125 name=__codelineno-8-125 href=#__codelineno-8-125></a>        <span class=p>}</span>
</span><span id=__span-8-126><a id=__codelineno-8-126 name=__codelineno-8-126 href=#__codelineno-8-126></a>    <span class=p>)</span>
</span><span id=__span-8-127><a id=__codelineno-8-127 name=__codelineno-8-127 href=#__codelineno-8-127></a>
</span><span id=__span-8-128><a id=__codelineno-8-128 name=__codelineno-8-128 href=#__codelineno-8-128></a>    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;=== CLAUDE&#39;S SYSTEMATIC ANALYSIS ===&quot;</span><span class=p>)</span>
</span><span id=__span-8-129><a id=__codelineno-8-129 name=__codelineno-8-129 href=#__codelineno-8-129></a>    <span class=nb>print</span><span class=p>(</span><span class=n>result</span><span class=p>[</span><span class=s2>&quot;analysis&quot;</span><span class=p>])</span>
</span></code></pre></div> <h2 id=error-handling-and-resilience>Error Handling and Resilience<a class=headerlink href=#error-handling-and-resilience title="Anchor link to this section for reference">&para;</a></h2> <h3 id=robust-error-handling-for-claude-integration>Robust Error Handling for Claude Integration<a class=headerlink href=#robust-error-handling-for-claude-integration title="Anchor link to this section for reference">&para;</a></h3> <div class="language-python highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=kn>import</span><span class=w> </span><span class=nn>logging</span>
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=kn>from</span><span class=w> </span><span class=nn>typing</span><span class=w> </span><span class=kn>import</span> <span class=n>Optional</span><span class=p>,</span> <span class=n>Union</span>
</span><span id=__span-9-3><a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a><span class=kn>from</span><span class=w> </span><span class=nn>anthropic</span><span class=w> </span><span class=kn>import</span> <span class=n>APIError</span><span class=p>,</span> <span class=n>APITimeoutError</span>
</span><span id=__span-9-4><a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a>
</span><span id=__span-9-5><a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a><span class=k>class</span><span class=w> </span><span class=nc>ResilientClaudeClient</span><span class=p>(</span><span class=n>CrewMCPClaudeClient</span><span class=p>):</span>
</span><span id=__span-9-6><a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Claude client with comprehensive error handling and resilience&quot;&quot;&quot;</span>
</span><span id=__span-9-7><a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a>
</span><span id=__span-9-8><a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-9-9><a id=__codelineno-9-9 name=__codelineno-9-9 href=#__codelineno-9-9></a>        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>()</span>
</span><span id=__span-9-10><a id=__codelineno-9-10 name=__codelineno-9-10 href=#__codelineno-9-10></a>        <span class=bp>self</span><span class=o>.</span><span class=n>logger</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>getLogger</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span><span id=__span-9-11><a id=__codelineno-9-11 name=__codelineno-9-11 href=#__codelineno-9-11></a>        <span class=bp>self</span><span class=o>.</span><span class=n>max_retries</span> <span class=o>=</span> <span class=mi>3</span>
</span><span id=__span-9-12><a id=__codelineno-9-12 name=__codelineno-9-12 href=#__codelineno-9-12></a>        <span class=bp>self</span><span class=o>.</span><span class=n>retry_delay</span> <span class=o>=</span> <span class=mi>2</span>
</span><span id=__span-9-13><a id=__codelineno-9-13 name=__codelineno-9-13 href=#__codelineno-9-13></a>
</span><span id=__span-9-14><a id=__codelineno-9-14 name=__codelineno-9-14 href=#__codelineno-9-14></a>    <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>safe_message_create</span><span class=p>(</span>
</span><span id=__span-9-15><a id=__codelineno-9-15 name=__codelineno-9-15 href=#__codelineno-9-15></a>        <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-9-16><a id=__codelineno-9-16 name=__codelineno-9-16 href=#__codelineno-9-16></a>        <span class=n>messages</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>],</span>
</span><span id=__span-9-17><a id=__codelineno-9-17 name=__codelineno-9-17 href=#__codelineno-9-17></a>        <span class=n>max_tokens</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>1024</span><span class=p>,</span>
</span><span id=__span-9-18><a id=__codelineno-9-18 name=__codelineno-9-18 href=#__codelineno-9-18></a>        <span class=n>tools</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-9-19><a id=__codelineno-9-19 name=__codelineno-9-19 href=#__codelineno-9-19></a>        <span class=n>system</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-9-20><a id=__codelineno-9-20 name=__codelineno-9-20 href=#__codelineno-9-20></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>]:</span>
</span><span id=__span-9-21><a id=__codelineno-9-21 name=__codelineno-9-21 href=#__codelineno-9-21></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Create message with error handling and retries&quot;&quot;&quot;</span>
</span><span id=__span-9-22><a id=__codelineno-9-22 name=__codelineno-9-22 href=#__codelineno-9-22></a>
</span><span id=__span-9-23><a id=__codelineno-9-23 name=__codelineno-9-23 href=#__codelineno-9-23></a>        <span class=k>for</span> <span class=n>attempt</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>max_retries</span><span class=p>):</span>
</span><span id=__span-9-24><a id=__codelineno-9-24 name=__codelineno-9-24 href=#__codelineno-9-24></a>            <span class=k>try</span><span class=p>:</span>
</span><span id=__span-9-25><a id=__codelineno-9-25 name=__codelineno-9-25 href=#__codelineno-9-25></a>                <span class=n>response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>claude_client</span><span class=o>.</span><span class=n>messages</span><span class=o>.</span><span class=n>create</span><span class=p>(</span>
</span><span id=__span-9-26><a id=__codelineno-9-26 name=__codelineno-9-26 href=#__codelineno-9-26></a>                    <span class=n>model</span><span class=o>=</span><span class=s2>&quot;claude-3-5-sonnet-20241022&quot;</span><span class=p>,</span>
</span><span id=__span-9-27><a id=__codelineno-9-27 name=__codelineno-9-27 href=#__codelineno-9-27></a>                    <span class=n>max_tokens</span><span class=o>=</span><span class=n>max_tokens</span><span class=p>,</span>
</span><span id=__span-9-28><a id=__codelineno-9-28 name=__codelineno-9-28 href=#__codelineno-9-28></a>                    <span class=n>system</span><span class=o>=</span><span class=n>system</span><span class=p>,</span>
</span><span id=__span-9-29><a id=__codelineno-9-29 name=__codelineno-9-29 href=#__codelineno-9-29></a>                    <span class=n>messages</span><span class=o>=</span><span class=n>messages</span><span class=p>,</span>
</span><span id=__span-9-30><a id=__codelineno-9-30 name=__codelineno-9-30 href=#__codelineno-9-30></a>                    <span class=n>tools</span><span class=o>=</span><span class=n>tools</span> <span class=ow>or</span> <span class=bp>self</span><span class=o>.</span><span class=n>tools</span>
</span><span id=__span-9-31><a id=__codelineno-9-31 name=__codelineno-9-31 href=#__codelineno-9-31></a>                <span class=p>)</span>
</span><span id=__span-9-32><a id=__codelineno-9-32 name=__codelineno-9-32 href=#__codelineno-9-32></a>                <span class=k>return</span> <span class=n>response</span>
</span><span id=__span-9-33><a id=__codelineno-9-33 name=__codelineno-9-33 href=#__codelineno-9-33></a>
</span><span id=__span-9-34><a id=__codelineno-9-34 name=__codelineno-9-34 href=#__codelineno-9-34></a>            <span class=k>except</span> <span class=n>APITimeoutError</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-9-35><a id=__codelineno-9-35 name=__codelineno-9-35 href=#__codelineno-9-35></a>                <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Claude API timeout (attempt </span><span class=si>{</span><span class=n>attempt</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=si>}</span><span class=s2>): </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-9-36><a id=__codelineno-9-36 name=__codelineno-9-36 href=#__codelineno-9-36></a>                <span class=k>if</span> <span class=n>attempt</span> <span class=o>&lt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>max_retries</span> <span class=o>-</span> <span class=mi>1</span><span class=p>:</span>
</span><span id=__span-9-37><a id=__codelineno-9-37 name=__codelineno-9-37 href=#__codelineno-9-37></a>                    <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>retry_delay</span> <span class=o>*</span> <span class=p>(</span><span class=mi>2</span> <span class=o>**</span> <span class=n>attempt</span><span class=p>))</span>
</span><span id=__span-9-38><a id=__codelineno-9-38 name=__codelineno-9-38 href=#__codelineno-9-38></a>                    <span class=k>continue</span>
</span><span id=__span-9-39><a id=__codelineno-9-39 name=__codelineno-9-39 href=#__codelineno-9-39></a>                <span class=k>else</span><span class=p>:</span>
</span><span id=__span-9-40><a id=__codelineno-9-40 name=__codelineno-9-40 href=#__codelineno-9-40></a>                    <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=s2>&quot;Claude API timeout after all retries&quot;</span><span class=p>)</span>
</span><span id=__span-9-41><a id=__codelineno-9-41 name=__codelineno-9-41 href=#__codelineno-9-41></a>                    <span class=k>return</span> <span class=kc>None</span>
</span><span id=__span-9-42><a id=__codelineno-9-42 name=__codelineno-9-42 href=#__codelineno-9-42></a>
</span><span id=__span-9-43><a id=__codelineno-9-43 name=__codelineno-9-43 href=#__codelineno-9-43></a>            <span class=k>except</span> <span class=n>APIError</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-9-44><a id=__codelineno-9-44 name=__codelineno-9-44 href=#__codelineno-9-44></a>                <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Claude API error: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-9-45><a id=__codelineno-9-45 name=__codelineno-9-45 href=#__codelineno-9-45></a>                <span class=k>if</span> <span class=n>e</span><span class=o>.</span><span class=n>status_code</span> <span class=ow>in</span> <span class=p>[</span><span class=mi>429</span><span class=p>,</span> <span class=mi>500</span><span class=p>,</span> <span class=mi>502</span><span class=p>,</span> <span class=mi>503</span><span class=p>,</span> <span class=mi>504</span><span class=p>]:</span>  <span class=c1># Retryable errors</span>
</span><span id=__span-9-46><a id=__codelineno-9-46 name=__codelineno-9-46 href=#__codelineno-9-46></a>                    <span class=k>if</span> <span class=n>attempt</span> <span class=o>&lt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>max_retries</span> <span class=o>-</span> <span class=mi>1</span><span class=p>:</span>
</span><span id=__span-9-47><a id=__codelineno-9-47 name=__codelineno-9-47 href=#__codelineno-9-47></a>                        <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>retry_delay</span> <span class=o>*</span> <span class=p>(</span><span class=mi>2</span> <span class=o>**</span> <span class=n>attempt</span><span class=p>))</span>
</span><span id=__span-9-48><a id=__codelineno-9-48 name=__codelineno-9-48 href=#__codelineno-9-48></a>                        <span class=k>continue</span>
</span><span id=__span-9-49><a id=__codelineno-9-49 name=__codelineno-9-49 href=#__codelineno-9-49></a>                <span class=k>return</span> <span class=kc>None</span>
</span><span id=__span-9-50><a id=__codelineno-9-50 name=__codelineno-9-50 href=#__codelineno-9-50></a>
</span><span id=__span-9-51><a id=__codelineno-9-51 name=__codelineno-9-51 href=#__codelineno-9-51></a>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-9-52><a id=__codelineno-9-52 name=__codelineno-9-52 href=#__codelineno-9-52></a>                <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Unexpected error in Claude API call: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-9-53><a id=__codelineno-9-53 name=__codelineno-9-53 href=#__codelineno-9-53></a>                <span class=k>return</span> <span class=kc>None</span>
</span><span id=__span-9-54><a id=__codelineno-9-54 name=__codelineno-9-54 href=#__codelineno-9-54></a>
</span><span id=__span-9-55><a id=__codelineno-9-55 name=__codelineno-9-55 href=#__codelineno-9-55></a>        <span class=k>return</span> <span class=kc>None</span>
</span><span id=__span-9-56><a id=__codelineno-9-56 name=__codelineno-9-56 href=#__codelineno-9-56></a>
</span><span id=__span-9-57><a id=__codelineno-9-57 name=__codelineno-9-57 href=#__codelineno-9-57></a>    <span class=k>def</span><span class=w> </span><span class=nf>safe_execute_tool</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>tool_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>parameters</span><span class=p>:</span> <span class=n>Dict</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>:</span>
</span><span id=__span-9-58><a id=__codelineno-9-58 name=__codelineno-9-58 href=#__codelineno-9-58></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Execute MCP tool with comprehensive error handling&quot;&quot;&quot;</span>
</span><span id=__span-9-59><a id=__codelineno-9-59 name=__codelineno-9-59 href=#__codelineno-9-59></a>
</span><span id=__span-9-60><a id=__codelineno-9-60 name=__codelineno-9-60 href=#__codelineno-9-60></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-9-61><a id=__codelineno-9-61 name=__codelineno-9-61 href=#__codelineno-9-61></a>            <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>execute_tool</span><span class=p>(</span><span class=n>tool_name</span><span class=p>,</span> <span class=n>parameters</span><span class=p>)</span>
</span><span id=__span-9-62><a id=__codelineno-9-62 name=__codelineno-9-62 href=#__codelineno-9-62></a>
</span><span id=__span-9-63><a id=__codelineno-9-63 name=__codelineno-9-63 href=#__codelineno-9-63></a>            <span class=k>if</span> <span class=ow>not</span> <span class=n>result</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;success&quot;</span><span class=p>,</span> <span class=kc>True</span><span class=p>):</span>
</span><span id=__span-9-64><a id=__codelineno-9-64 name=__codelineno-9-64 href=#__codelineno-9-64></a>                <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Tool execution warning: </span><span class=si>{</span><span class=n>result</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;error&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;Unknown error&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-9-65><a id=__codelineno-9-65 name=__codelineno-9-65 href=#__codelineno-9-65></a>                <span class=k>return</span> <span class=p>{</span>
</span><span id=__span-9-66><a id=__codelineno-9-66 name=__codelineno-9-66 href=#__codelineno-9-66></a>                    <span class=s2>&quot;error&quot;</span><span class=p>:</span> <span class=n>result</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;error&quot;</span><span class=p>,</span> <span class=s2>&quot;Tool execution failed&quot;</span><span class=p>),</span>
</span><span id=__span-9-67><a id=__codelineno-9-67 name=__codelineno-9-67 href=#__codelineno-9-67></a>                    <span class=s2>&quot;tool_name&quot;</span><span class=p>:</span> <span class=n>tool_name</span><span class=p>,</span>
</span><span id=__span-9-68><a id=__codelineno-9-68 name=__codelineno-9-68 href=#__codelineno-9-68></a>                    <span class=s2>&quot;parameters&quot;</span><span class=p>:</span> <span class=n>parameters</span><span class=p>,</span>
</span><span id=__span-9-69><a id=__codelineno-9-69 name=__codelineno-9-69 href=#__codelineno-9-69></a>                    <span class=s2>&quot;fallback_available&quot;</span><span class=p>:</span> <span class=kc>True</span>
</span><span id=__span-9-70><a id=__codelineno-9-70 name=__codelineno-9-70 href=#__codelineno-9-70></a>                <span class=p>}</span>
</span><span id=__span-9-71><a id=__codelineno-9-71 name=__codelineno-9-71 href=#__codelineno-9-71></a>
</span><span id=__span-9-72><a id=__codelineno-9-72 name=__codelineno-9-72 href=#__codelineno-9-72></a>            <span class=k>return</span> <span class=n>result</span>
</span><span id=__span-9-73><a id=__codelineno-9-73 name=__codelineno-9-73 href=#__codelineno-9-73></a>
</span><span id=__span-9-74><a id=__codelineno-9-74 name=__codelineno-9-74 href=#__codelineno-9-74></a>        <span class=k>except</span> <span class=n>requests</span><span class=o>.</span><span class=n>exceptions</span><span class=o>.</span><span class=n>Timeout</span><span class=p>:</span>
</span><span id=__span-9-75><a id=__codelineno-9-75 name=__codelineno-9-75 href=#__codelineno-9-75></a>            <span class=k>return</span> <span class=p>{</span>
</span><span id=__span-9-76><a id=__codelineno-9-76 name=__codelineno-9-76 href=#__codelineno-9-76></a>                <span class=s2>&quot;error&quot;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&quot;Tool </span><span class=si>{</span><span class=n>tool_name</span><span class=si>}</span><span class=s2> timed out&quot;</span><span class=p>,</span>
</span><span id=__span-9-77><a id=__codelineno-9-77 name=__codelineno-9-77 href=#__codelineno-9-77></a>                <span class=s2>&quot;suggestion&quot;</span><span class=p>:</span> <span class=s2>&quot;Try with reduced parameters or check system status&quot;</span>
</span><span id=__span-9-78><a id=__codelineno-9-78 name=__codelineno-9-78 href=#__codelineno-9-78></a>            <span class=p>}</span>
</span><span id=__span-9-79><a id=__codelineno-9-79 name=__codelineno-9-79 href=#__codelineno-9-79></a>
</span><span id=__span-9-80><a id=__codelineno-9-80 name=__codelineno-9-80 href=#__codelineno-9-80></a>        <span class=k>except</span> <span class=n>requests</span><span class=o>.</span><span class=n>exceptions</span><span class=o>.</span><span class=n>ConnectionError</span><span class=p>:</span>
</span><span id=__span-9-81><a id=__codelineno-9-81 name=__codelineno-9-81 href=#__codelineno-9-81></a>            <span class=k>return</span> <span class=p>{</span>
</span><span id=__span-9-82><a id=__codelineno-9-82 name=__codelineno-9-82 href=#__codelineno-9-82></a>                <span class=s2>&quot;error&quot;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&quot;Connection error for tool </span><span class=si>{</span><span class=n>tool_name</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
</span><span id=__span-9-83><a id=__codelineno-9-83 name=__codelineno-9-83 href=#__codelineno-9-83></a>                <span class=s2>&quot;suggestion&quot;</span><span class=p>:</span> <span class=s2>&quot;Check network connectivity and MCP server status&quot;</span>
</span><span id=__span-9-84><a id=__codelineno-9-84 name=__codelineno-9-84 href=#__codelineno-9-84></a>            <span class=p>}</span>
</span><span id=__span-9-85><a id=__codelineno-9-85 name=__codelineno-9-85 href=#__codelineno-9-85></a>
</span><span id=__span-9-86><a id=__codelineno-9-86 name=__codelineno-9-86 href=#__codelineno-9-86></a>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-9-87><a id=__codelineno-9-87 name=__codelineno-9-87 href=#__codelineno-9-87></a>            <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Unexpected error in tool execution: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-9-88><a id=__codelineno-9-88 name=__codelineno-9-88 href=#__codelineno-9-88></a>            <span class=k>return</span> <span class=p>{</span>
</span><span id=__span-9-89><a id=__codelineno-9-89 name=__codelineno-9-89 href=#__codelineno-9-89></a>                <span class=s2>&quot;error&quot;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&quot;Unexpected error: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
</span><span id=__span-9-90><a id=__codelineno-9-90 name=__codelineno-9-90 href=#__codelineno-9-90></a>                <span class=s2>&quot;tool_name&quot;</span><span class=p>:</span> <span class=n>tool_name</span>
</span><span id=__span-9-91><a id=__codelineno-9-91 name=__codelineno-9-91 href=#__codelineno-9-91></a>            <span class=p>}</span>
</span><span id=__span-9-92><a id=__codelineno-9-92 name=__codelineno-9-92 href=#__codelineno-9-92></a>
</span><span id=__span-9-93><a id=__codelineno-9-93 name=__codelineno-9-93 href=#__codelineno-9-93></a>    <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>resilient_conversation</span><span class=p>(</span>
</span><span id=__span-9-94><a id=__codelineno-9-94 name=__codelineno-9-94 href=#__codelineno-9-94></a>        <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-9-95><a id=__codelineno-9-95 name=__codelineno-9-95 href=#__codelineno-9-95></a>        <span class=n>user_input</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-9-96><a id=__codelineno-9-96 name=__codelineno-9-96 href=#__codelineno-9-96></a>        <span class=n>context</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-9-97><a id=__codelineno-9-97 name=__codelineno-9-97 href=#__codelineno-9-97></a>        <span class=n>fallback_response</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-9-98><a id=__codelineno-9-98 name=__codelineno-9-98 href=#__codelineno-9-98></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span><span id=__span-9-99><a id=__codelineno-9-99 name=__codelineno-9-99 href=#__codelineno-9-99></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Conduct conversation with fallback mechanisms&quot;&quot;&quot;</span>
</span><span id=__span-9-100><a id=__codelineno-9-100 name=__codelineno-9-100 href=#__codelineno-9-100></a>
</span><span id=__span-9-101><a id=__codelineno-9-101 name=__codelineno-9-101 href=#__codelineno-9-101></a>        <span class=n>messages</span> <span class=o>=</span> <span class=p>[{</span>
</span><span id=__span-9-102><a id=__codelineno-9-102 name=__codelineno-9-102 href=#__codelineno-9-102></a>            <span class=s2>&quot;role&quot;</span><span class=p>:</span> <span class=s2>&quot;user&quot;</span><span class=p>,</span>
</span><span id=__span-9-103><a id=__codelineno-9-103 name=__codelineno-9-103 href=#__codelineno-9-103></a>            <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=n>user_input</span>
</span><span id=__span-9-104><a id=__codelineno-9-104 name=__codelineno-9-104 href=#__codelineno-9-104></a>        <span class=p>}]</span>
</span><span id=__span-9-105><a id=__codelineno-9-105 name=__codelineno-9-105 href=#__codelineno-9-105></a>
</span><span id=__span-9-106><a id=__codelineno-9-106 name=__codelineno-9-106 href=#__codelineno-9-106></a>        <span class=k>if</span> <span class=n>context</span><span class=p>:</span>
</span><span id=__span-9-107><a id=__codelineno-9-107 name=__codelineno-9-107 href=#__codelineno-9-107></a>            <span class=n>messages</span><span class=o>.</span><span class=n>insert</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=p>{</span>
</span><span id=__span-9-108><a id=__codelineno-9-108 name=__codelineno-9-108 href=#__codelineno-9-108></a>                <span class=s2>&quot;role&quot;</span><span class=p>:</span> <span class=s2>&quot;user&quot;</span><span class=p>,</span>
</span><span id=__span-9-109><a id=__codelineno-9-109 name=__codelineno-9-109 href=#__codelineno-9-109></a>                <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&quot;Context: </span><span class=si>{</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>context</span><span class=p>,</span><span class=w> </span><span class=n>indent</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-9-110><a id=__codelineno-9-110 name=__codelineno-9-110 href=#__codelineno-9-110></a>            <span class=p>})</span>
</span><span id=__span-9-111><a id=__codelineno-9-111 name=__codelineno-9-111 href=#__codelineno-9-111></a>
</span><span id=__span-9-112><a id=__codelineno-9-112 name=__codelineno-9-112 href=#__codelineno-9-112></a>        <span class=n>response</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>safe_message_create</span><span class=p>(</span><span class=n>messages</span><span class=p>)</span>
</span><span id=__span-9-113><a id=__codelineno-9-113 name=__codelineno-9-113 href=#__codelineno-9-113></a>
</span><span id=__span-9-114><a id=__codelineno-9-114 name=__codelineno-9-114 href=#__codelineno-9-114></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>response</span><span class=p>:</span>
</span><span id=__span-9-115><a id=__codelineno-9-115 name=__codelineno-9-115 href=#__codelineno-9-115></a>            <span class=k>return</span> <span class=n>fallback_response</span> <span class=ow>or</span> <span class=s2>&quot;I&#39;m sorry, I&#39;m having trouble connecting to my systems right now. Please try again in a moment.&quot;</span>
</span><span id=__span-9-116><a id=__codelineno-9-116 name=__codelineno-9-116 href=#__codelineno-9-116></a>
</span><span id=__span-9-117><a id=__codelineno-9-117 name=__codelineno-9-117 href=#__codelineno-9-117></a>        <span class=c1># Process tool calls safely</span>
</span><span id=__span-9-118><a id=__codelineno-9-118 name=__codelineno-9-118 href=#__codelineno-9-118></a>        <span class=n>conversation</span> <span class=o>=</span> <span class=n>messages</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
</span><span id=__span-9-119><a id=__codelineno-9-119 name=__codelineno-9-119 href=#__codelineno-9-119></a>        <span class=n>current_message</span> <span class=o>=</span> <span class=n>response</span>
</span><span id=__span-9-120><a id=__codelineno-9-120 name=__codelineno-9-120 href=#__codelineno-9-120></a>        <span class=n>conversation</span><span class=o>.</span><span class=n>append</span><span class=p>({</span><span class=s2>&quot;role&quot;</span><span class=p>:</span> <span class=s2>&quot;assistant&quot;</span><span class=p>,</span> <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=n>current_message</span><span class=o>.</span><span class=n>content</span><span class=p>})</span>
</span><span id=__span-9-121><a id=__codelineno-9-121 name=__codelineno-9-121 href=#__codelineno-9-121></a>
</span><span id=__span-9-122><a id=__codelineno-9-122 name=__codelineno-9-122 href=#__codelineno-9-122></a>        <span class=n>iteration_count</span> <span class=o>=</span> <span class=mi>0</span>
</span><span id=__span-9-123><a id=__codelineno-9-123 name=__codelineno-9-123 href=#__codelineno-9-123></a>        <span class=n>max_iterations</span> <span class=o>=</span> <span class=mi>5</span>  <span class=c1># Prevent infinite loops</span>
</span><span id=__span-9-124><a id=__codelineno-9-124 name=__codelineno-9-124 href=#__codelineno-9-124></a>
</span><span id=__span-9-125><a id=__codelineno-9-125 name=__codelineno-9-125 href=#__codelineno-9-125></a>        <span class=k>while</span> <span class=p>(</span><span class=nb>any</span><span class=p>(</span><span class=n>content</span><span class=o>.</span><span class=n>type</span> <span class=o>==</span> <span class=s2>&quot;tool_use&quot;</span> <span class=k>for</span> <span class=n>content</span> <span class=ow>in</span> <span class=n>current_message</span><span class=o>.</span><span class=n>content</span><span class=p>)</span> <span class=ow>and</span>
</span><span id=__span-9-126><a id=__codelineno-9-126 name=__codelineno-9-126 href=#__codelineno-9-126></a>               <span class=n>iteration_count</span> <span class=o>&lt;</span> <span class=n>max_iterations</span><span class=p>):</span>
</span><span id=__span-9-127><a id=__codelineno-9-127 name=__codelineno-9-127 href=#__codelineno-9-127></a>
</span><span id=__span-9-128><a id=__codelineno-9-128 name=__codelineno-9-128 href=#__codelineno-9-128></a>            <span class=n>tool_results</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-9-129><a id=__codelineno-9-129 name=__codelineno-9-129 href=#__codelineno-9-129></a>            <span class=k>for</span> <span class=n>content_block</span> <span class=ow>in</span> <span class=n>current_message</span><span class=o>.</span><span class=n>content</span><span class=p>:</span>
</span><span id=__span-9-130><a id=__codelineno-9-130 name=__codelineno-9-130 href=#__codelineno-9-130></a>                <span class=k>if</span> <span class=n>content_block</span><span class=o>.</span><span class=n>type</span> <span class=o>==</span> <span class=s2>&quot;tool_use&quot;</span><span class=p>:</span>
</span><span id=__span-9-131><a id=__codelineno-9-131 name=__codelineno-9-131 href=#__codelineno-9-131></a>                    <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>safe_execute_tool</span><span class=p>(</span>
</span><span id=__span-9-132><a id=__codelineno-9-132 name=__codelineno-9-132 href=#__codelineno-9-132></a>                        <span class=n>content_block</span><span class=o>.</span><span class=n>name</span><span class=p>,</span>
</span><span id=__span-9-133><a id=__codelineno-9-133 name=__codelineno-9-133 href=#__codelineno-9-133></a>                        <span class=n>content_block</span><span class=o>.</span><span class=n>input</span>
</span><span id=__span-9-134><a id=__codelineno-9-134 name=__codelineno-9-134 href=#__codelineno-9-134></a>                    <span class=p>)</span>
</span><span id=__span-9-135><a id=__codelineno-9-135 name=__codelineno-9-135 href=#__codelineno-9-135></a>                    <span class=n>tool_results</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span><span id=__span-9-136><a id=__codelineno-9-136 name=__codelineno-9-136 href=#__codelineno-9-136></a>                        <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;tool_result&quot;</span><span class=p>,</span>
</span><span id=__span-9-137><a id=__codelineno-9-137 name=__codelineno-9-137 href=#__codelineno-9-137></a>                        <span class=s2>&quot;tool_use_id&quot;</span><span class=p>:</span> <span class=n>content_block</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
</span><span id=__span-9-138><a id=__codelineno-9-138 name=__codelineno-9-138 href=#__codelineno-9-138></a>                        <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>result</span><span class=p>,</span> <span class=n>indent</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span>
</span><span id=__span-9-139><a id=__codelineno-9-139 name=__codelineno-9-139 href=#__codelineno-9-139></a>                    <span class=p>})</span>
</span><span id=__span-9-140><a id=__codelineno-9-140 name=__codelineno-9-140 href=#__codelineno-9-140></a>
</span><span id=__span-9-141><a id=__codelineno-9-141 name=__codelineno-9-141 href=#__codelineno-9-141></a>            <span class=n>conversation</span><span class=o>.</span><span class=n>append</span><span class=p>({</span><span class=s2>&quot;role&quot;</span><span class=p>:</span> <span class=s2>&quot;user&quot;</span><span class=p>,</span> <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=n>tool_results</span><span class=p>})</span>
</span><span id=__span-9-142><a id=__codelineno-9-142 name=__codelineno-9-142 href=#__codelineno-9-142></a>
</span><span id=__span-9-143><a id=__codelineno-9-143 name=__codelineno-9-143 href=#__codelineno-9-143></a>            <span class=n>next_response</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>safe_message_create</span><span class=p>(</span><span class=n>conversation</span><span class=p>)</span>
</span><span id=__span-9-144><a id=__codelineno-9-144 name=__codelineno-9-144 href=#__codelineno-9-144></a>            <span class=k>if</span> <span class=ow>not</span> <span class=n>next_response</span><span class=p>:</span>
</span><span id=__span-9-145><a id=__codelineno-9-145 name=__codelineno-9-145 href=#__codelineno-9-145></a>                <span class=k>break</span>
</span><span id=__span-9-146><a id=__codelineno-9-146 name=__codelineno-9-146 href=#__codelineno-9-146></a>
</span><span id=__span-9-147><a id=__codelineno-9-147 name=__codelineno-9-147 href=#__codelineno-9-147></a>            <span class=n>current_message</span> <span class=o>=</span> <span class=n>next_response</span>
</span><span id=__span-9-148><a id=__codelineno-9-148 name=__codelineno-9-148 href=#__codelineno-9-148></a>            <span class=n>conversation</span><span class=o>.</span><span class=n>append</span><span class=p>({</span><span class=s2>&quot;role&quot;</span><span class=p>:</span> <span class=s2>&quot;assistant&quot;</span><span class=p>,</span> <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=n>current_message</span><span class=o>.</span><span class=n>content</span><span class=p>})</span>
</span><span id=__span-9-149><a id=__codelineno-9-149 name=__codelineno-9-149 href=#__codelineno-9-149></a>            <span class=n>iteration_count</span> <span class=o>+=</span> <span class=mi>1</span>
</span><span id=__span-9-150><a id=__codelineno-9-150 name=__codelineno-9-150 href=#__codelineno-9-150></a>
</span><span id=__span-9-151><a id=__codelineno-9-151 name=__codelineno-9-151 href=#__codelineno-9-151></a>        <span class=c1># Extract final response</span>
</span><span id=__span-9-152><a id=__codelineno-9-152 name=__codelineno-9-152 href=#__codelineno-9-152></a>        <span class=n>text_responses</span> <span class=o>=</span> <span class=p>[</span>
</span><span id=__span-9-153><a id=__codelineno-9-153 name=__codelineno-9-153 href=#__codelineno-9-153></a>            <span class=n>content</span><span class=o>.</span><span class=n>text</span> <span class=k>for</span> <span class=n>content</span> <span class=ow>in</span> <span class=n>current_message</span><span class=o>.</span><span class=n>content</span>
</span><span id=__span-9-154><a id=__codelineno-9-154 name=__codelineno-9-154 href=#__codelineno-9-154></a>            <span class=k>if</span> <span class=n>content</span><span class=o>.</span><span class=n>type</span> <span class=o>==</span> <span class=s2>&quot;text&quot;</span>
</span><span id=__span-9-155><a id=__codelineno-9-155 name=__codelineno-9-155 href=#__codelineno-9-155></a>        <span class=p>]</span>
</span><span id=__span-9-156><a id=__codelineno-9-156 name=__codelineno-9-156 href=#__codelineno-9-156></a>
</span><span id=__span-9-157><a id=__codelineno-9-157 name=__codelineno-9-157 href=#__codelineno-9-157></a>        <span class=k>return</span> <span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>text_responses</span><span class=p>)</span> <span class=k>if</span> <span class=n>text_responses</span> <span class=k>else</span> <span class=s2>&quot;I encountered some issues processing your request, but I&#39;m working on it.&quot;</span>
</span><span id=__span-9-158><a id=__codelineno-9-158 name=__codelineno-9-158 href=#__codelineno-9-158></a>
</span><span id=__span-9-159><a id=__codelineno-9-159 name=__codelineno-9-159 href=#__codelineno-9-159></a><span class=c1># Example usage with error handling</span>
</span><span id=__span-9-160><a id=__codelineno-9-160 name=__codelineno-9-160 href=#__codelineno-9-160></a><span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>error_handling_example</span><span class=p>():</span>
</span><span id=__span-9-161><a id=__codelineno-9-161 name=__codelineno-9-161 href=#__codelineno-9-161></a>    <span class=n>client</span> <span class=o>=</span> <span class=n>ResilientClaudeClient</span><span class=p>()</span>
</span><span id=__span-9-162><a id=__codelineno-9-162 name=__codelineno-9-162 href=#__codelineno-9-162></a>
</span><span id=__span-9-163><a id=__codelineno-9-163 name=__codelineno-9-163 href=#__codelineno-9-163></a>    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-9-164><a id=__codelineno-9-164 name=__codelineno-9-164 href=#__codelineno-9-164></a>        <span class=n>response</span> <span class=o>=</span> <span class=k>await</span> <span class=n>client</span><span class=o>.</span><span class=n>resilient_conversation</span><span class=p>(</span>
</span><span id=__span-9-165><a id=__codelineno-9-165 name=__codelineno-9-165 href=#__codelineno-9-165></a>            <span class=n>user_input</span><span class=o>=</span><span class=s2>&quot;Check compliance status for all vessels&quot;</span><span class=p>,</span>
</span><span id=__span-9-166><a id=__codelineno-9-166 name=__codelineno-9-166 href=#__codelineno-9-166></a>            <span class=n>context</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;priority&quot;</span><span class=p>:</span> <span class=s2>&quot;high&quot;</span><span class=p>,</span> <span class=s2>&quot;deadline&quot;</span><span class=p>:</span> <span class=s2>&quot;24 hours&quot;</span><span class=p>},</span>
</span><span id=__span-9-167><a id=__codelineno-9-167 name=__codelineno-9-167 href=#__codelineno-9-167></a>            <span class=n>fallback_response</span><span class=o>=</span><span class=s2>&quot;I&#39;ll help you check compliance status as soon as my systems are fully operational.&quot;</span>
</span><span id=__span-9-168><a id=__codelineno-9-168 name=__codelineno-9-168 href=#__codelineno-9-168></a>        <span class=p>)</span>
</span><span id=__span-9-169><a id=__codelineno-9-169 name=__codelineno-9-169 href=#__codelineno-9-169></a>
</span><span id=__span-9-170><a id=__codelineno-9-170 name=__codelineno-9-170 href=#__codelineno-9-170></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Response:&quot;</span><span class=p>,</span> <span class=n>response</span><span class=p>)</span>
</span><span id=__span-9-171><a id=__codelineno-9-171 name=__codelineno-9-171 href=#__codelineno-9-171></a>
</span><span id=__span-9-172><a id=__codelineno-9-172 name=__codelineno-9-172 href=#__codelineno-9-172></a>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-9-173><a id=__codelineno-9-173 name=__codelineno-9-173 href=#__codelineno-9-173></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Conversation failed: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span></code></pre></div> <h2 id=performance-optimization>Performance Optimization<a class=headerlink href=#performance-optimization title="Anchor link to this section for reference">&para;</a></h2> <h3 id=efficient-claude-integration-patterns>Efficient Claude Integration Patterns<a class=headerlink href=#efficient-claude-integration-patterns title="Anchor link to this section for reference">&para;</a></h3> <div class="language-python highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=k>class</span><span class=w> </span><span class=nc>OptimizedClaudeClient</span><span class=p>(</span><span class=n>CrewMCPClaudeClient</span><span class=p>):</span>
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Optimized client for high-performance Claude integration&quot;&quot;&quot;</span>
</span><span id=__span-10-3><a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a>
</span><span id=__span-10-4><a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-10-5><a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a>        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>()</span>
</span><span id=__span-10-6><a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a>        <span class=bp>self</span><span class=o>.</span><span class=n>response_cache</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-10-7><a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a>        <span class=bp>self</span><span class=o>.</span><span class=n>cache_ttl</span> <span class=o>=</span> <span class=mi>300</span>  <span class=c1># 5 minutes</span>
</span><span id=__span-10-8><a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a>
</span><span id=__span-10-9><a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a>    <span class=k>def</span><span class=w> </span><span class=nf>_get_cache_key</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>messages</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>],</span> <span class=n>tools</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span><span id=__span-10-10><a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Generate cache key for request&quot;&quot;&quot;</span>
</span><span id=__span-10-11><a id=__codelineno-10-11 name=__codelineno-10-11 href=#__codelineno-10-11></a>        <span class=kn>import</span><span class=w> </span><span class=nn>hashlib</span>
</span><span id=__span-10-12><a id=__codelineno-10-12 name=__codelineno-10-12 href=#__codelineno-10-12></a>        <span class=n>content</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>({</span>
</span><span id=__span-10-13><a id=__codelineno-10-13 name=__codelineno-10-13 href=#__codelineno-10-13></a>            <span class=s2>&quot;messages&quot;</span><span class=p>:</span> <span class=n>messages</span><span class=p>,</span>
</span><span id=__span-10-14><a id=__codelineno-10-14 name=__codelineno-10-14 href=#__codelineno-10-14></a>            <span class=s2>&quot;tools&quot;</span><span class=p>:</span> <span class=p>[</span><span class=n>tool</span><span class=p>[</span><span class=s2>&quot;name&quot;</span><span class=p>]</span> <span class=k>for</span> <span class=n>tool</span> <span class=ow>in</span> <span class=n>tools</span><span class=p>]</span>
</span><span id=__span-10-15><a id=__codelineno-10-15 name=__codelineno-10-15 href=#__codelineno-10-15></a>        <span class=p>},</span> <span class=n>sort_keys</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-10-16><a id=__codelineno-10-16 name=__codelineno-10-16 href=#__codelineno-10-16></a>        <span class=k>return</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>content</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span><span id=__span-10-17><a id=__codelineno-10-17 name=__codelineno-10-17 href=#__codelineno-10-17></a>
</span><span id=__span-10-18><a id=__codelineno-10-18 name=__codelineno-10-18 href=#__codelineno-10-18></a>    <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>cached_message_create</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>:</span>
</span><span id=__span-10-19><a id=__codelineno-10-19 name=__codelineno-10-19 href=#__codelineno-10-19></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Create message with intelligent caching&quot;&quot;&quot;</span>
</span><span id=__span-10-20><a id=__codelineno-10-20 name=__codelineno-10-20 href=#__codelineno-10-20></a>
</span><span id=__span-10-21><a id=__codelineno-10-21 name=__codelineno-10-21 href=#__codelineno-10-21></a>        <span class=n>cache_key</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_cache_key</span><span class=p>(</span>
</span><span id=__span-10-22><a id=__codelineno-10-22 name=__codelineno-10-22 href=#__codelineno-10-22></a>            <span class=n>kwargs</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;messages&quot;</span><span class=p>,</span> <span class=p>[]),</span>
</span><span id=__span-10-23><a id=__codelineno-10-23 name=__codelineno-10-23 href=#__codelineno-10-23></a>            <span class=n>kwargs</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;tools&quot;</span><span class=p>,</span> <span class=p>[])</span>
</span><span id=__span-10-24><a id=__codelineno-10-24 name=__codelineno-10-24 href=#__codelineno-10-24></a>        <span class=p>)</span>
</span><span id=__span-10-25><a id=__codelineno-10-25 name=__codelineno-10-25 href=#__codelineno-10-25></a>
</span><span id=__span-10-26><a id=__codelineno-10-26 name=__codelineno-10-26 href=#__codelineno-10-26></a>        <span class=c1># Check cache</span>
</span><span id=__span-10-27><a id=__codelineno-10-27 name=__codelineno-10-27 href=#__codelineno-10-27></a>        <span class=k>if</span> <span class=n>cache_key</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>response_cache</span><span class=p>:</span>
</span><span id=__span-10-28><a id=__codelineno-10-28 name=__codelineno-10-28 href=#__codelineno-10-28></a>            <span class=n>cached_response</span><span class=p>,</span> <span class=n>timestamp</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>response_cache</span><span class=p>[</span><span class=n>cache_key</span><span class=p>]</span>
</span><span id=__span-10-29><a id=__codelineno-10-29 name=__codelineno-10-29 href=#__codelineno-10-29></a>            <span class=k>if</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>-</span> <span class=n>timestamp</span> <span class=o>&lt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>cache_ttl</span><span class=p>:</span>
</span><span id=__span-10-30><a id=__codelineno-10-30 name=__codelineno-10-30 href=#__codelineno-10-30></a>                <span class=k>return</span> <span class=n>cached_response</span>
</span><span id=__span-10-31><a id=__codelineno-10-31 name=__codelineno-10-31 href=#__codelineno-10-31></a>
</span><span id=__span-10-32><a id=__codelineno-10-32 name=__codelineno-10-32 href=#__codelineno-10-32></a>        <span class=c1># Create new response</span>
</span><span id=__span-10-33><a id=__codelineno-10-33 name=__codelineno-10-33 href=#__codelineno-10-33></a>        <span class=n>response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>claude_client</span><span class=o>.</span><span class=n>messages</span><span class=o>.</span><span class=n>create</span><span class=p>(</span><span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span><span id=__span-10-34><a id=__codelineno-10-34 name=__codelineno-10-34 href=#__codelineno-10-34></a>
</span><span id=__span-10-35><a id=__codelineno-10-35 name=__codelineno-10-35 href=#__codelineno-10-35></a>        <span class=c1># Cache response</span>
</span><span id=__span-10-36><a id=__codelineno-10-36 name=__codelineno-10-36 href=#__codelineno-10-36></a>        <span class=bp>self</span><span class=o>.</span><span class=n>response_cache</span><span class=p>[</span><span class=n>cache_key</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>response</span><span class=p>,</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>())</span>
</span><span id=__span-10-37><a id=__codelineno-10-37 name=__codelineno-10-37 href=#__codelineno-10-37></a>
</span><span id=__span-10-38><a id=__codelineno-10-38 name=__codelineno-10-38 href=#__codelineno-10-38></a>        <span class=k>return</span> <span class=n>response</span>
</span><span id=__span-10-39><a id=__codelineno-10-39 name=__codelineno-10-39 href=#__codelineno-10-39></a>
</span><span id=__span-10-40><a id=__codelineno-10-40 name=__codelineno-10-40 href=#__codelineno-10-40></a>    <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>batch_tool_execution</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>tool_calls</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>]:</span>
</span><span id=__span-10-41><a id=__codelineno-10-41 name=__codelineno-10-41 href=#__codelineno-10-41></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Execute multiple tools efficiently&quot;&quot;&quot;</span>
</span><span id=__span-10-42><a id=__codelineno-10-42 name=__codelineno-10-42 href=#__codelineno-10-42></a>
</span><span id=__span-10-43><a id=__codelineno-10-43 name=__codelineno-10-43 href=#__codelineno-10-43></a>        <span class=kn>import</span><span class=w> </span><span class=nn>asyncio</span>
</span><span id=__span-10-44><a id=__codelineno-10-44 name=__codelineno-10-44 href=#__codelineno-10-44></a>        <span class=kn>from</span><span class=w> </span><span class=nn>concurrent.futures</span><span class=w> </span><span class=kn>import</span> <span class=n>ThreadPoolExecutor</span>
</span><span id=__span-10-45><a id=__codelineno-10-45 name=__codelineno-10-45 href=#__codelineno-10-45></a>
</span><span id=__span-10-46><a id=__codelineno-10-46 name=__codelineno-10-46 href=#__codelineno-10-46></a>        <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>execute_single_tool</span><span class=p>(</span><span class=n>tool_call</span><span class=p>:</span> <span class=n>Dict</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>:</span>
</span><span id=__span-10-47><a id=__codelineno-10-47 name=__codelineno-10-47 href=#__codelineno-10-47></a><span class=w>            </span><span class=sd>&quot;&quot;&quot;Execute single tool asynchronously&quot;&quot;&quot;</span>
</span><span id=__span-10-48><a id=__codelineno-10-48 name=__codelineno-10-48 href=#__codelineno-10-48></a>            <span class=n>loop</span> <span class=o>=</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>get_event_loop</span><span class=p>()</span>
</span><span id=__span-10-49><a id=__codelineno-10-49 name=__codelineno-10-49 href=#__codelineno-10-49></a>            <span class=k>with</span> <span class=n>ThreadPoolExecutor</span><span class=p>()</span> <span class=k>as</span> <span class=n>executor</span><span class=p>:</span>
</span><span id=__span-10-50><a id=__codelineno-10-50 name=__codelineno-10-50 href=#__codelineno-10-50></a>                <span class=n>result</span> <span class=o>=</span> <span class=k>await</span> <span class=n>loop</span><span class=o>.</span><span class=n>run_in_executor</span><span class=p>(</span>
</span><span id=__span-10-51><a id=__codelineno-10-51 name=__codelineno-10-51 href=#__codelineno-10-51></a>                    <span class=n>executor</span><span class=p>,</span>
</span><span id=__span-10-52><a id=__codelineno-10-52 name=__codelineno-10-52 href=#__codelineno-10-52></a>                    <span class=bp>self</span><span class=o>.</span><span class=n>execute_tool</span><span class=p>,</span>
</span><span id=__span-10-53><a id=__codelineno-10-53 name=__codelineno-10-53 href=#__codelineno-10-53></a>                    <span class=n>tool_call</span><span class=p>[</span><span class=s2>&quot;name&quot;</span><span class=p>],</span>
</span><span id=__span-10-54><a id=__codelineno-10-54 name=__codelineno-10-54 href=#__codelineno-10-54></a>                    <span class=n>tool_call</span><span class=p>[</span><span class=s2>&quot;input&quot;</span><span class=p>]</span>
</span><span id=__span-10-55><a id=__codelineno-10-55 name=__codelineno-10-55 href=#__codelineno-10-55></a>                <span class=p>)</span>
</span><span id=__span-10-56><a id=__codelineno-10-56 name=__codelineno-10-56 href=#__codelineno-10-56></a>                <span class=k>return</span> <span class=p>{</span>
</span><span id=__span-10-57><a id=__codelineno-10-57 name=__codelineno-10-57 href=#__codelineno-10-57></a>                    <span class=s2>&quot;tool_use_id&quot;</span><span class=p>:</span> <span class=n>tool_call</span><span class=p>[</span><span class=s2>&quot;id&quot;</span><span class=p>],</span>
</span><span id=__span-10-58><a id=__codelineno-10-58 name=__codelineno-10-58 href=#__codelineno-10-58></a>                    <span class=s2>&quot;result&quot;</span><span class=p>:</span> <span class=n>result</span><span class=p>,</span>
</span><span id=__span-10-59><a id=__codelineno-10-59 name=__codelineno-10-59 href=#__codelineno-10-59></a>                    <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;tool_result&quot;</span>
</span><span id=__span-10-60><a id=__codelineno-10-60 name=__codelineno-10-60 href=#__codelineno-10-60></a>                <span class=p>}</span>
</span><span id=__span-10-61><a id=__codelineno-10-61 name=__codelineno-10-61 href=#__codelineno-10-61></a>
</span><span id=__span-10-62><a id=__codelineno-10-62 name=__codelineno-10-62 href=#__codelineno-10-62></a>        <span class=c1># Execute all tools concurrently</span>
</span><span id=__span-10-63><a id=__codelineno-10-63 name=__codelineno-10-63 href=#__codelineno-10-63></a>        <span class=n>tasks</span> <span class=o>=</span> <span class=p>[</span><span class=n>execute_single_tool</span><span class=p>(</span><span class=n>tool_call</span><span class=p>)</span> <span class=k>for</span> <span class=n>tool_call</span> <span class=ow>in</span> <span class=n>tool_calls</span><span class=p>]</span>
</span><span id=__span-10-64><a id=__codelineno-10-64 name=__codelineno-10-64 href=#__codelineno-10-64></a>        <span class=n>results</span> <span class=o>=</span> <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>gather</span><span class=p>(</span><span class=o>*</span><span class=n>tasks</span><span class=p>,</span> <span class=n>return_exceptions</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-10-65><a id=__codelineno-10-65 name=__codelineno-10-65 href=#__codelineno-10-65></a>
</span><span id=__span-10-66><a id=__codelineno-10-66 name=__codelineno-10-66 href=#__codelineno-10-66></a>        <span class=c1># Format results for Claude</span>
</span><span id=__span-10-67><a id=__codelineno-10-67 name=__codelineno-10-67 href=#__codelineno-10-67></a>        <span class=n>formatted_results</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-10-68><a id=__codelineno-10-68 name=__codelineno-10-68 href=#__codelineno-10-68></a>        <span class=k>for</span> <span class=n>result</span> <span class=ow>in</span> <span class=n>results</span><span class=p>:</span>
</span><span id=__span-10-69><a id=__codelineno-10-69 name=__codelineno-10-69 href=#__codelineno-10-69></a>            <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>result</span><span class=p>,</span> <span class=ne>Exception</span><span class=p>):</span>
</span><span id=__span-10-70><a id=__codelineno-10-70 name=__codelineno-10-70 href=#__codelineno-10-70></a>                <span class=n>formatted_results</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span><span id=__span-10-71><a id=__codelineno-10-71 name=__codelineno-10-71 href=#__codelineno-10-71></a>                    <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;tool_result&quot;</span><span class=p>,</span>
</span><span id=__span-10-72><a id=__codelineno-10-72 name=__codelineno-10-72 href=#__codelineno-10-72></a>                    <span class=s2>&quot;tool_use_id&quot;</span><span class=p>:</span> <span class=s2>&quot;error&quot;</span><span class=p>,</span>
</span><span id=__span-10-73><a id=__codelineno-10-73 name=__codelineno-10-73 href=#__codelineno-10-73></a>                    <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>({</span><span class=s2>&quot;error&quot;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>result</span><span class=p>)})</span>
</span><span id=__span-10-74><a id=__codelineno-10-74 name=__codelineno-10-74 href=#__codelineno-10-74></a>                <span class=p>})</span>
</span><span id=__span-10-75><a id=__codelineno-10-75 name=__codelineno-10-75 href=#__codelineno-10-75></a>            <span class=k>else</span><span class=p>:</span>
</span><span id=__span-10-76><a id=__codelineno-10-76 name=__codelineno-10-76 href=#__codelineno-10-76></a>                <span class=n>formatted_results</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span><span id=__span-10-77><a id=__codelineno-10-77 name=__codelineno-10-77 href=#__codelineno-10-77></a>                    <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;tool_result&quot;</span><span class=p>,</span>
</span><span id=__span-10-78><a id=__codelineno-10-78 name=__codelineno-10-78 href=#__codelineno-10-78></a>                    <span class=s2>&quot;tool_use_id&quot;</span><span class=p>:</span> <span class=n>result</span><span class=p>[</span><span class=s2>&quot;tool_use_id&quot;</span><span class=p>],</span>
</span><span id=__span-10-79><a id=__codelineno-10-79 name=__codelineno-10-79 href=#__codelineno-10-79></a>                    <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>result</span><span class=p>[</span><span class=s2>&quot;result&quot;</span><span class=p>])</span>
</span><span id=__span-10-80><a id=__codelineno-10-80 name=__codelineno-10-80 href=#__codelineno-10-80></a>                <span class=p>})</span>
</span><span id=__span-10-81><a id=__codelineno-10-81 name=__codelineno-10-81 href=#__codelineno-10-81></a>
</span><span id=__span-10-82><a id=__codelineno-10-82 name=__codelineno-10-82 href=#__codelineno-10-82></a>        <span class=k>return</span> <span class=n>formatted_results</span>
</span><span id=__span-10-83><a id=__codelineno-10-83 name=__codelineno-10-83 href=#__codelineno-10-83></a>
</span><span id=__span-10-84><a id=__codelineno-10-84 name=__codelineno-10-84 href=#__codelineno-10-84></a>    <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>optimized_workflow</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_input</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span><span id=__span-10-85><a id=__codelineno-10-85 name=__codelineno-10-85 href=#__codelineno-10-85></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Optimized conversation workflow&quot;&quot;&quot;</span>
</span><span id=__span-10-86><a id=__codelineno-10-86 name=__codelineno-10-86 href=#__codelineno-10-86></a>
</span><span id=__span-10-87><a id=__codelineno-10-87 name=__codelineno-10-87 href=#__codelineno-10-87></a>        <span class=n>start_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span><span id=__span-10-88><a id=__codelineno-10-88 name=__codelineno-10-88 href=#__codelineno-10-88></a>
</span><span id=__span-10-89><a id=__codelineno-10-89 name=__codelineno-10-89 href=#__codelineno-10-89></a>        <span class=n>message</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>cached_message_create</span><span class=p>(</span>
</span><span id=__span-10-90><a id=__codelineno-10-90 name=__codelineno-10-90 href=#__codelineno-10-90></a>            <span class=n>model</span><span class=o>=</span><span class=s2>&quot;claude-3-5-sonnet-20241022&quot;</span><span class=p>,</span>
</span><span id=__span-10-91><a id=__codelineno-10-91 name=__codelineno-10-91 href=#__codelineno-10-91></a>            <span class=n>max_tokens</span><span class=o>=</span><span class=mi>2048</span><span class=p>,</span>
</span><span id=__span-10-92><a id=__codelineno-10-92 name=__codelineno-10-92 href=#__codelineno-10-92></a>            <span class=n>messages</span><span class=o>=</span><span class=p>[{</span><span class=s2>&quot;role&quot;</span><span class=p>:</span> <span class=s2>&quot;user&quot;</span><span class=p>,</span> <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=n>user_input</span><span class=p>}],</span>
</span><span id=__span-10-93><a id=__codelineno-10-93 name=__codelineno-10-93 href=#__codelineno-10-93></a>            <span class=n>tools</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>tools</span>
</span><span id=__span-10-94><a id=__codelineno-10-94 name=__codelineno-10-94 href=#__codelineno-10-94></a>        <span class=p>)</span>
</span><span id=__span-10-95><a id=__codelineno-10-95 name=__codelineno-10-95 href=#__codelineno-10-95></a>
</span><span id=__span-10-96><a id=__codelineno-10-96 name=__codelineno-10-96 href=#__codelineno-10-96></a>        <span class=n>conversation</span> <span class=o>=</span> <span class=p>[{</span><span class=s2>&quot;role&quot;</span><span class=p>:</span> <span class=s2>&quot;user&quot;</span><span class=p>,</span> <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=n>user_input</span><span class=p>}]</span>
</span><span id=__span-10-97><a id=__codelineno-10-97 name=__codelineno-10-97 href=#__codelineno-10-97></a>        <span class=n>current_message</span> <span class=o>=</span> <span class=n>message</span>
</span><span id=__span-10-98><a id=__codelineno-10-98 name=__codelineno-10-98 href=#__codelineno-10-98></a>        <span class=n>conversation</span><span class=o>.</span><span class=n>append</span><span class=p>({</span><span class=s2>&quot;role&quot;</span><span class=p>:</span> <span class=s2>&quot;assistant&quot;</span><span class=p>,</span> <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=n>current_message</span><span class=o>.</span><span class=n>content</span><span class=p>})</span>
</span><span id=__span-10-99><a id=__codelineno-10-99 name=__codelineno-10-99 href=#__codelineno-10-99></a>
</span><span id=__span-10-100><a id=__codelineno-10-100 name=__codelineno-10-100 href=#__codelineno-10-100></a>        <span class=c1># Process tool calls efficiently</span>
</span><span id=__span-10-101><a id=__codelineno-10-101 name=__codelineno-10-101 href=#__codelineno-10-101></a>        <span class=k>while</span> <span class=nb>any</span><span class=p>(</span><span class=n>content</span><span class=o>.</span><span class=n>type</span> <span class=o>==</span> <span class=s2>&quot;tool_use&quot;</span> <span class=k>for</span> <span class=n>content</span> <span class=ow>in</span> <span class=n>current_message</span><span class=o>.</span><span class=n>content</span><span class=p>):</span>
</span><span id=__span-10-102><a id=__codelineno-10-102 name=__codelineno-10-102 href=#__codelineno-10-102></a>            <span class=n>tool_calls</span> <span class=o>=</span> <span class=p>[</span><span class=n>c</span> <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>current_message</span><span class=o>.</span><span class=n>content</span> <span class=k>if</span> <span class=n>c</span><span class=o>.</span><span class=n>type</span> <span class=o>==</span> <span class=s2>&quot;tool_use&quot;</span><span class=p>]</span>
</span><span id=__span-10-103><a id=__codelineno-10-103 name=__codelineno-10-103 href=#__codelineno-10-103></a>
</span><span id=__span-10-104><a id=__codelineno-10-104 name=__codelineno-10-104 href=#__codelineno-10-104></a>            <span class=c1># Batch execute tools</span>
</span><span id=__span-10-105><a id=__codelineno-10-105 name=__codelineno-10-105 href=#__codelineno-10-105></a>            <span class=n>tool_results</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>batch_tool_execution</span><span class=p>(</span><span class=n>tool_calls</span><span class=p>)</span>
</span><span id=__span-10-106><a id=__codelineno-10-106 name=__codelineno-10-106 href=#__codelineno-10-106></a>
</span><span id=__span-10-107><a id=__codelineno-10-107 name=__codelineno-10-107 href=#__codelineno-10-107></a>            <span class=n>conversation</span><span class=o>.</span><span class=n>append</span><span class=p>({</span><span class=s2>&quot;role&quot;</span><span class=p>:</span> <span class=s2>&quot;user&quot;</span><span class=p>,</span> <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=n>tool_results</span><span class=p>})</span>
</span><span id=__span-10-108><a id=__codelineno-10-108 name=__codelineno-10-108 href=#__codelineno-10-108></a>
</span><span id=__span-10-109><a id=__codelineno-10-109 name=__codelineno-10-109 href=#__codelineno-10-109></a>            <span class=n>current_message</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>cached_message_create</span><span class=p>(</span>
</span><span id=__span-10-110><a id=__codelineno-10-110 name=__codelineno-10-110 href=#__codelineno-10-110></a>                <span class=n>model</span><span class=o>=</span><span class=s2>&quot;claude-3-5-sonnet-20241022&quot;</span><span class=p>,</span>
</span><span id=__span-10-111><a id=__codelineno-10-111 name=__codelineno-10-111 href=#__codelineno-10-111></a>                <span class=n>max_tokens</span><span class=o>=</span><span class=mi>2048</span><span class=p>,</span>
</span><span id=__span-10-112><a id=__codelineno-10-112 name=__codelineno-10-112 href=#__codelineno-10-112></a>                <span class=n>messages</span><span class=o>=</span><span class=n>conversation</span><span class=p>,</span>
</span><span id=__span-10-113><a id=__codelineno-10-113 name=__codelineno-10-113 href=#__codelineno-10-113></a>                <span class=n>tools</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>tools</span>
</span><span id=__span-10-114><a id=__codelineno-10-114 name=__codelineno-10-114 href=#__codelineno-10-114></a>            <span class=p>)</span>
</span><span id=__span-10-115><a id=__codelineno-10-115 name=__codelineno-10-115 href=#__codelineno-10-115></a>
</span><span id=__span-10-116><a id=__codelineno-10-116 name=__codelineno-10-116 href=#__codelineno-10-116></a>            <span class=n>conversation</span><span class=o>.</span><span class=n>append</span><span class=p>({</span><span class=s2>&quot;role&quot;</span><span class=p>:</span> <span class=s2>&quot;assistant&quot;</span><span class=p>,</span> <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=n>current_message</span><span class=o>.</span><span class=n>content</span><span class=p>})</span>
</span><span id=__span-10-117><a id=__codelineno-10-117 name=__codelineno-10-117 href=#__codelineno-10-117></a>
</span><span id=__span-10-118><a id=__codelineno-10-118 name=__codelineno-10-118 href=#__codelineno-10-118></a>        <span class=n>execution_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>-</span> <span class=n>start_time</span>
</span><span id=__span-10-119><a id=__codelineno-10-119 name=__codelineno-10-119 href=#__codelineno-10-119></a>
</span><span id=__span-10-120><a id=__codelineno-10-120 name=__codelineno-10-120 href=#__codelineno-10-120></a>        <span class=c1># Extract response</span>
</span><span id=__span-10-121><a id=__codelineno-10-121 name=__codelineno-10-121 href=#__codelineno-10-121></a>        <span class=n>text_response</span> <span class=o>=</span> <span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>join</span><span class=p>([</span>
</span><span id=__span-10-122><a id=__codelineno-10-122 name=__codelineno-10-122 href=#__codelineno-10-122></a>            <span class=n>content</span><span class=o>.</span><span class=n>text</span> <span class=k>for</span> <span class=n>content</span> <span class=ow>in</span> <span class=n>current_message</span><span class=o>.</span><span class=n>content</span>
</span><span id=__span-10-123><a id=__codelineno-10-123 name=__codelineno-10-123 href=#__codelineno-10-123></a>            <span class=k>if</span> <span class=n>content</span><span class=o>.</span><span class=n>type</span> <span class=o>==</span> <span class=s2>&quot;text&quot;</span>
</span><span id=__span-10-124><a id=__codelineno-10-124 name=__codelineno-10-124 href=#__codelineno-10-124></a>        <span class=p>])</span>
</span><span id=__span-10-125><a id=__codelineno-10-125 name=__codelineno-10-125 href=#__codelineno-10-125></a>
</span><span id=__span-10-126><a id=__codelineno-10-126 name=__codelineno-10-126 href=#__codelineno-10-126></a>        <span class=k>return</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>text_response</span><span class=si>}</span><span class=se>\n\n</span><span class=s2>_[Processed in </span><span class=si>{</span><span class=n>execution_time</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>s]_&quot;</span>
</span></code></pre></div> <h2 id=testing-claude-integration>Testing Claude Integration<a class=headerlink href=#testing-claude-integration title="Anchor link to this section for reference">&para;</a></h2> <h3 id=comprehensive-test-suite>Comprehensive Test Suite<a class=headerlink href=#comprehensive-test-suite title="Anchor link to this section for reference">&para;</a></h3> <div class="language-python highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=kn>import</span><span class=w> </span><span class=nn>pytest</span>
</span><span id=__span-11-2><a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class=kn>from</span><span class=w> </span><span class=nn>unittest.mock</span><span class=w> </span><span class=kn>import</span> <span class=n>Mock</span><span class=p>,</span> <span class=n>patch</span>
</span><span id=__span-11-3><a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a><span class=kn>import</span><span class=w> </span><span class=nn>json</span>
</span><span id=__span-11-4><a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a>
</span><span id=__span-11-5><a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a><span class=k>class</span><span class=w> </span><span class=nc>TestClaudeCrewMCPIntegration</span><span class=p>:</span>
</span><span id=__span-11-6><a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a>
</span><span id=__span-11-7><a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a>    <span class=nd>@pytest</span><span class=o>.</span><span class=n>fixture</span>
</span><span id=__span-11-8><a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a>    <span class=k>def</span><span class=w> </span><span class=nf>mock_claude_client</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-11-9><a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a>        <span class=n>client</span> <span class=o>=</span> <span class=n>CrewMCPClaudeClient</span><span class=p>()</span>
</span><span id=__span-11-10><a id=__codelineno-11-10 name=__codelineno-11-10 href=#__codelineno-11-10></a>        <span class=n>client</span><span class=o>.</span><span class=n>claude_client</span> <span class=o>=</span> <span class=n>Mock</span><span class=p>()</span>
</span><span id=__span-11-11><a id=__codelineno-11-11 name=__codelineno-11-11 href=#__codelineno-11-11></a>        <span class=n>client</span><span class=o>.</span><span class=n>execute_tool</span> <span class=o>=</span> <span class=n>Mock</span><span class=p>()</span>
</span><span id=__span-11-12><a id=__codelineno-11-12 name=__codelineno-11-12 href=#__codelineno-11-12></a>        <span class=k>return</span> <span class=n>client</span>
</span><span id=__span-11-13><a id=__codelineno-11-13 name=__codelineno-11-13 href=#__codelineno-11-13></a>
</span><span id=__span-11-14><a id=__codelineno-11-14 name=__codelineno-11-14 href=#__codelineno-11-14></a>    <span class=nd>@pytest</span><span class=o>.</span><span class=n>mark</span><span class=o>.</span><span class=n>asyncio</span>
</span><span id=__span-11-15><a id=__codelineno-11-15 name=__codelineno-11-15 href=#__codelineno-11-15></a>    <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>test_basic_crew_search</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>mock_claude_client</span><span class=p>):</span>
</span><span id=__span-11-16><a id=__codelineno-11-16 name=__codelineno-11-16 href=#__codelineno-11-16></a>        <span class=c1># Mock Claude response</span>
</span><span id=__span-11-17><a id=__codelineno-11-17 name=__codelineno-11-17 href=#__codelineno-11-17></a>        <span class=n>mock_content</span> <span class=o>=</span> <span class=n>Mock</span><span class=p>()</span>
</span><span id=__span-11-18><a id=__codelineno-11-18 name=__codelineno-11-18 href=#__codelineno-11-18></a>        <span class=n>mock_content</span><span class=o>.</span><span class=n>type</span> <span class=o>=</span> <span class=s2>&quot;tool_use&quot;</span>
</span><span id=__span-11-19><a id=__codelineno-11-19 name=__codelineno-11-19 href=#__codelineno-11-19></a>        <span class=n>mock_content</span><span class=o>.</span><span class=n>name</span> <span class=o>=</span> <span class=s2>&quot;search_crew&quot;</span>
</span><span id=__span-11-20><a id=__codelineno-11-20 name=__codelineno-11-20 href=#__codelineno-11-20></a>        <span class=n>mock_content</span><span class=o>.</span><span class=n>id</span> <span class=o>=</span> <span class=s2>&quot;test-id&quot;</span>
</span><span id=__span-11-21><a id=__codelineno-11-21 name=__codelineno-11-21 href=#__codelineno-11-21></a>        <span class=n>mock_content</span><span class=o>.</span><span class=n>input</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;query&quot;</span><span class=p>:</span> <span class=s2>&quot;deck officers&quot;</span><span class=p>}</span>
</span><span id=__span-11-22><a id=__codelineno-11-22 name=__codelineno-11-22 href=#__codelineno-11-22></a>
</span><span id=__span-11-23><a id=__codelineno-11-23 name=__codelineno-11-23 href=#__codelineno-11-23></a>        <span class=n>mock_message</span> <span class=o>=</span> <span class=n>Mock</span><span class=p>()</span>
</span><span id=__span-11-24><a id=__codelineno-11-24 name=__codelineno-11-24 href=#__codelineno-11-24></a>        <span class=n>mock_message</span><span class=o>.</span><span class=n>content</span> <span class=o>=</span> <span class=p>[</span><span class=n>mock_content</span><span class=p>]</span>
</span><span id=__span-11-25><a id=__codelineno-11-25 name=__codelineno-11-25 href=#__codelineno-11-25></a>
</span><span id=__span-11-26><a id=__codelineno-11-26 name=__codelineno-11-26 href=#__codelineno-11-26></a>        <span class=n>mock_claude_client</span><span class=o>.</span><span class=n>claude_client</span><span class=o>.</span><span class=n>messages</span><span class=o>.</span><span class=n>create</span><span class=o>.</span><span class=n>return_value</span> <span class=o>=</span> <span class=n>mock_message</span>
</span><span id=__span-11-27><a id=__codelineno-11-27 name=__codelineno-11-27 href=#__codelineno-11-27></a>
</span><span id=__span-11-28><a id=__codelineno-11-28 name=__codelineno-11-28 href=#__codelineno-11-28></a>        <span class=c1># Mock tool result</span>
</span><span id=__span-11-29><a id=__codelineno-11-29 name=__codelineno-11-29 href=#__codelineno-11-29></a>        <span class=n>mock_claude_client</span><span class=o>.</span><span class=n>execute_tool</span><span class=o>.</span><span class=n>return_value</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-11-30><a id=__codelineno-11-30 name=__codelineno-11-30 href=#__codelineno-11-30></a>            <span class=s2>&quot;matches&quot;</span><span class=p>:</span> <span class=p>[{</span><span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=s2>&quot;John Doe&quot;</span><span class=p>,</span> <span class=s2>&quot;rank&quot;</span><span class=p>:</span> <span class=s2>&quot;Chief Officer&quot;</span><span class=p>}],</span>
</span><span id=__span-11-31><a id=__codelineno-11-31 name=__codelineno-11-31 href=#__codelineno-11-31></a>            <span class=s2>&quot;total_count&quot;</span><span class=p>:</span> <span class=mi>1</span>
</span><span id=__span-11-32><a id=__codelineno-11-32 name=__codelineno-11-32 href=#__codelineno-11-32></a>        <span class=p>}</span>
</span><span id=__span-11-33><a id=__codelineno-11-33 name=__codelineno-11-33 href=#__codelineno-11-33></a>
</span><span id=__span-11-34><a id=__codelineno-11-34 name=__codelineno-11-34 href=#__codelineno-11-34></a>        <span class=c1># Test the flow</span>
</span><span id=__span-11-35><a id=__codelineno-11-35 name=__codelineno-11-35 href=#__codelineno-11-35></a>        <span class=n>message</span> <span class=o>=</span> <span class=n>mock_claude_client</span><span class=o>.</span><span class=n>claude_client</span><span class=o>.</span><span class=n>messages</span><span class=o>.</span><span class=n>create</span><span class=p>(</span>
</span><span id=__span-11-36><a id=__codelineno-11-36 name=__codelineno-11-36 href=#__codelineno-11-36></a>            <span class=n>model</span><span class=o>=</span><span class=s2>&quot;claude-3-5-sonnet-20241022&quot;</span><span class=p>,</span>
</span><span id=__span-11-37><a id=__codelineno-11-37 name=__codelineno-11-37 href=#__codelineno-11-37></a>            <span class=n>max_tokens</span><span class=o>=</span><span class=mi>1024</span><span class=p>,</span>
</span><span id=__span-11-38><a id=__codelineno-11-38 name=__codelineno-11-38 href=#__codelineno-11-38></a>            <span class=n>messages</span><span class=o>=</span><span class=p>[{</span><span class=s2>&quot;role&quot;</span><span class=p>:</span> <span class=s2>&quot;user&quot;</span><span class=p>,</span> <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=s2>&quot;Find deck officers&quot;</span><span class=p>}],</span>
</span><span id=__span-11-39><a id=__codelineno-11-39 name=__codelineno-11-39 href=#__codelineno-11-39></a>            <span class=n>tools</span><span class=o>=</span><span class=n>CREW_MCP_CLAUDE_TOOLS</span>
</span><span id=__span-11-40><a id=__codelineno-11-40 name=__codelineno-11-40 href=#__codelineno-11-40></a>        <span class=p>)</span>
</span><span id=__span-11-41><a id=__codelineno-11-41 name=__codelineno-11-41 href=#__codelineno-11-41></a>
</span><span id=__span-11-42><a id=__codelineno-11-42 name=__codelineno-11-42 href=#__codelineno-11-42></a>        <span class=k>assert</span> <span class=n>message</span><span class=o>.</span><span class=n>content</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>type</span> <span class=o>==</span> <span class=s2>&quot;tool_use&quot;</span>
</span><span id=__span-11-43><a id=__codelineno-11-43 name=__codelineno-11-43 href=#__codelineno-11-43></a>        <span class=k>assert</span> <span class=n>message</span><span class=o>.</span><span class=n>content</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>name</span> <span class=o>==</span> <span class=s2>&quot;search_crew&quot;</span>
</span><span id=__span-11-44><a id=__codelineno-11-44 name=__codelineno-11-44 href=#__codelineno-11-44></a>
</span><span id=__span-11-45><a id=__codelineno-11-45 name=__codelineno-11-45 href=#__codelineno-11-45></a>    <span class=nd>@pytest</span><span class=o>.</span><span class=n>mark</span><span class=o>.</span><span class=n>asyncio</span>
</span><span id=__span-11-46><a id=__codelineno-11-46 name=__codelineno-11-46 href=#__codelineno-11-46></a>    <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>test_conversation_manager</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-11-47><a id=__codelineno-11-47 name=__codelineno-11-47 href=#__codelineno-11-47></a>        <span class=n>manager</span> <span class=o>=</span> <span class=n>ClaudeCrewConversationManager</span><span class=p>()</span>
</span><span id=__span-11-48><a id=__codelineno-11-48 name=__codelineno-11-48 href=#__codelineno-11-48></a>
</span><span id=__span-11-49><a id=__codelineno-11-49 name=__codelineno-11-49 href=#__codelineno-11-49></a>        <span class=c1># Mock the client</span>
</span><span id=__span-11-50><a id=__codelineno-11-50 name=__codelineno-11-50 href=#__codelineno-11-50></a>        <span class=k>with</span> <span class=n>patch</span><span class=o>.</span><span class=n>object</span><span class=p>(</span><span class=n>manager</span><span class=o>.</span><span class=n>client</span><span class=p>,</span> <span class=s1>&#39;claude_client&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>mock_claude</span><span class=p>,</span> \
</span><span id=__span-11-51><a id=__codelineno-11-51 name=__codelineno-11-51 href=#__codelineno-11-51></a>             <span class=n>patch</span><span class=o>.</span><span class=n>object</span><span class=p>(</span><span class=n>manager</span><span class=o>.</span><span class=n>client</span><span class=p>,</span> <span class=s1>&#39;execute_tool&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>mock_execute</span><span class=p>:</span>
</span><span id=__span-11-52><a id=__codelineno-11-52 name=__codelineno-11-52 href=#__codelineno-11-52></a>
</span><span id=__span-11-53><a id=__codelineno-11-53 name=__codelineno-11-53 href=#__codelineno-11-53></a>            <span class=c1># Setup mocks</span>
</span><span id=__span-11-54><a id=__codelineno-11-54 name=__codelineno-11-54 href=#__codelineno-11-54></a>            <span class=n>mock_text_content</span> <span class=o>=</span> <span class=n>Mock</span><span class=p>()</span>
</span><span id=__span-11-55><a id=__codelineno-11-55 name=__codelineno-11-55 href=#__codelineno-11-55></a>            <span class=n>mock_text_content</span><span class=o>.</span><span class=n>type</span> <span class=o>=</span> <span class=s2>&quot;text&quot;</span>
</span><span id=__span-11-56><a id=__codelineno-11-56 name=__codelineno-11-56 href=#__codelineno-11-56></a>            <span class=n>mock_text_content</span><span class=o>.</span><span class=n>text</span> <span class=o>=</span> <span class=s2>&quot;I&#39;ll help you find deck officers.&quot;</span>
</span><span id=__span-11-57><a id=__codelineno-11-57 name=__codelineno-11-57 href=#__codelineno-11-57></a>
</span><span id=__span-11-58><a id=__codelineno-11-58 name=__codelineno-11-58 href=#__codelineno-11-58></a>            <span class=n>mock_message</span> <span class=o>=</span> <span class=n>Mock</span><span class=p>()</span>
</span><span id=__span-11-59><a id=__codelineno-11-59 name=__codelineno-11-59 href=#__codelineno-11-59></a>            <span class=n>mock_message</span><span class=o>.</span><span class=n>content</span> <span class=o>=</span> <span class=p>[</span><span class=n>mock_text_content</span><span class=p>]</span>
</span><span id=__span-11-60><a id=__codelineno-11-60 name=__codelineno-11-60 href=#__codelineno-11-60></a>
</span><span id=__span-11-61><a id=__codelineno-11-61 name=__codelineno-11-61 href=#__codelineno-11-61></a>            <span class=n>mock_claude</span><span class=o>.</span><span class=n>messages</span><span class=o>.</span><span class=n>create</span><span class=o>.</span><span class=n>return_value</span> <span class=o>=</span> <span class=n>mock_message</span>
</span><span id=__span-11-62><a id=__codelineno-11-62 name=__codelineno-11-62 href=#__codelineno-11-62></a>
</span><span id=__span-11-63><a id=__codelineno-11-63 name=__codelineno-11-63 href=#__codelineno-11-63></a>            <span class=n>response</span> <span class=o>=</span> <span class=k>await</span> <span class=n>manager</span><span class=o>.</span><span class=n>chat</span><span class=p>(</span><span class=s2>&quot;Find available deck officers&quot;</span><span class=p>)</span>
</span><span id=__span-11-64><a id=__codelineno-11-64 name=__codelineno-11-64 href=#__codelineno-11-64></a>
</span><span id=__span-11-65><a id=__codelineno-11-65 name=__codelineno-11-65 href=#__codelineno-11-65></a>            <span class=k>assert</span> <span class=s2>&quot;help you find deck officers&quot;</span> <span class=ow>in</span> <span class=n>response</span>
</span><span id=__span-11-66><a id=__codelineno-11-66 name=__codelineno-11-66 href=#__codelineno-11-66></a>            <span class=n>mock_claude</span><span class=o>.</span><span class=n>messages</span><span class=o>.</span><span class=n>create</span><span class=o>.</span><span class=n>assert_called</span><span class=p>()</span>
</span><span id=__span-11-67><a id=__codelineno-11-67 name=__codelineno-11-67 href=#__codelineno-11-67></a>
</span><span id=__span-11-68><a id=__codelineno-11-68 name=__codelineno-11-68 href=#__codelineno-11-68></a>    <span class=k>def</span><span class=w> </span><span class=nf>test_tool_schema_validation</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-11-69><a id=__codelineno-11-69 name=__codelineno-11-69 href=#__codelineno-11-69></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Test that all tool schemas are valid&quot;&quot;&quot;</span>
</span><span id=__span-11-70><a id=__codelineno-11-70 name=__codelineno-11-70 href=#__codelineno-11-70></a>        <span class=k>for</span> <span class=n>tool</span> <span class=ow>in</span> <span class=n>CREW_MCP_CLAUDE_TOOLS</span><span class=p>:</span>
</span><span id=__span-11-71><a id=__codelineno-11-71 name=__codelineno-11-71 href=#__codelineno-11-71></a>            <span class=k>assert</span> <span class=s2>&quot;name&quot;</span> <span class=ow>in</span> <span class=n>tool</span>
</span><span id=__span-11-72><a id=__codelineno-11-72 name=__codelineno-11-72 href=#__codelineno-11-72></a>            <span class=k>assert</span> <span class=s2>&quot;description&quot;</span> <span class=ow>in</span> <span class=n>tool</span>
</span><span id=__span-11-73><a id=__codelineno-11-73 name=__codelineno-11-73 href=#__codelineno-11-73></a>            <span class=k>assert</span> <span class=s2>&quot;input_schema&quot;</span> <span class=ow>in</span> <span class=n>tool</span>
</span><span id=__span-11-74><a id=__codelineno-11-74 name=__codelineno-11-74 href=#__codelineno-11-74></a>            <span class=k>assert</span> <span class=s2>&quot;type&quot;</span> <span class=ow>in</span> <span class=n>tool</span><span class=p>[</span><span class=s2>&quot;input_schema&quot;</span><span class=p>]</span>
</span><span id=__span-11-75><a id=__codelineno-11-75 name=__codelineno-11-75 href=#__codelineno-11-75></a>            <span class=k>assert</span> <span class=s2>&quot;properties&quot;</span> <span class=ow>in</span> <span class=n>tool</span><span class=p>[</span><span class=s2>&quot;input_schema&quot;</span><span class=p>]</span>
</span><span id=__span-11-76><a id=__codelineno-11-76 name=__codelineno-11-76 href=#__codelineno-11-76></a>
</span><span id=__span-11-77><a id=__codelineno-11-77 name=__codelineno-11-77 href=#__codelineno-11-77></a>    <span class=nd>@pytest</span><span class=o>.</span><span class=n>mark</span><span class=o>.</span><span class=n>asyncio</span>
</span><span id=__span-11-78><a id=__codelineno-11-78 name=__codelineno-11-78 href=#__codelineno-11-78></a>    <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>test_error_handling</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-11-79><a id=__codelineno-11-79 name=__codelineno-11-79 href=#__codelineno-11-79></a>        <span class=n>client</span> <span class=o>=</span> <span class=n>ResilientClaudeClient</span><span class=p>()</span>
</span><span id=__span-11-80><a id=__codelineno-11-80 name=__codelineno-11-80 href=#__codelineno-11-80></a>
</span><span id=__span-11-81><a id=__codelineno-11-81 name=__codelineno-11-81 href=#__codelineno-11-81></a>        <span class=k>with</span> <span class=n>patch</span><span class=o>.</span><span class=n>object</span><span class=p>(</span><span class=n>client</span><span class=p>,</span> <span class=s1>&#39;claude_client&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>mock_claude</span><span class=p>:</span>
</span><span id=__span-11-82><a id=__codelineno-11-82 name=__codelineno-11-82 href=#__codelineno-11-82></a>            <span class=c1># Simulate API error</span>
</span><span id=__span-11-83><a id=__codelineno-11-83 name=__codelineno-11-83 href=#__codelineno-11-83></a>            <span class=n>mock_claude</span><span class=o>.</span><span class=n>messages</span><span class=o>.</span><span class=n>create</span><span class=o>.</span><span class=n>side_effect</span> <span class=o>=</span> <span class=n>APIError</span><span class=p>(</span><span class=s2>&quot;API Error&quot;</span><span class=p>)</span>
</span><span id=__span-11-84><a id=__codelineno-11-84 name=__codelineno-11-84 href=#__codelineno-11-84></a>
</span><span id=__span-11-85><a id=__codelineno-11-85 name=__codelineno-11-85 href=#__codelineno-11-85></a>            <span class=n>result</span> <span class=o>=</span> <span class=k>await</span> <span class=n>client</span><span class=o>.</span><span class=n>safe_message_create</span><span class=p>([</span>
</span><span id=__span-11-86><a id=__codelineno-11-86 name=__codelineno-11-86 href=#__codelineno-11-86></a>                <span class=p>{</span><span class=s2>&quot;role&quot;</span><span class=p>:</span> <span class=s2>&quot;user&quot;</span><span class=p>,</span> <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=s2>&quot;test&quot;</span><span class=p>}</span>
</span><span id=__span-11-87><a id=__codelineno-11-87 name=__codelineno-11-87 href=#__codelineno-11-87></a>            <span class=p>])</span>
</span><span id=__span-11-88><a id=__codelineno-11-88 name=__codelineno-11-88 href=#__codelineno-11-88></a>
</span><span id=__span-11-89><a id=__codelineno-11-89 name=__codelineno-11-89 href=#__codelineno-11-89></a>            <span class=k>assert</span> <span class=n>result</span> <span class=ow>is</span> <span class=kc>None</span>
</span><span id=__span-11-90><a id=__codelineno-11-90 name=__codelineno-11-90 href=#__codelineno-11-90></a>
</span><span id=__span-11-91><a id=__codelineno-11-91 name=__codelineno-11-91 href=#__codelineno-11-91></a><span class=c1># Run tests</span>
</span><span id=__span-11-92><a id=__codelineno-11-92 name=__codelineno-11-92 href=#__codelineno-11-92></a><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&quot;__main__&quot;</span><span class=p>:</span>
</span><span id=__span-11-93><a id=__codelineno-11-93 name=__codelineno-11-93 href=#__codelineno-11-93></a>    <span class=n>pytest</span><span class=o>.</span><span class=n>main</span><span class=p>([</span><span class=vm>__file__</span><span class=p>])</span>
</span></code></pre></div> <p>This comprehensive Claude integration guide provides everything needed to successfully integrate the Crew Appraisals MCP tools with Claude, leveraging its advanced reasoning capabilities and conversational strengths for sophisticated crew management workflows.</p> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title="Last update"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_datetime" title="September 26, 2025 05:23:29 UTC">2025-09-26 05:23:29</span> </span> <span class=md-source-file__fact> <span class=md-icon title=Created> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_datetime" title="September 26, 2025 05:23:29 UTC">2025-09-26 05:23:29</span> </span> </aside> <form class=md-feedback name=feedback hidden> <fieldset> <legend class=md-feedback__title> Was this page helpful? </legend> <div class=md-feedback__inner> <div class=md-feedback__list> <button class="md-feedback__icon md-icon" type=submit title="This page was helpful" data-md-value=1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81"/></svg> </button> <button class="md-feedback__icon md-icon" type=submit title="This page could be improved" data-md-value=0> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14"/></svg> </button> </div> <div class=md-feedback__note> <div data-md-value=1 hidden> Thanks for your feedback! </div> <div data-md-value=0 hidden> Thanks for your feedback! </div> </div> </div> </fieldset> </form> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../openai/ class="md-footer__link md-footer__link--prev" aria-label="Previous: OpenAI Integration"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> OpenAI Integration </div> </div> </a> <a href=../../../models/ class="md-footer__link md-footer__link--next" aria-label="Next: Data Models Overview"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> Data Models Overview </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2024 - Crew Management System </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/example/crewing-backend target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> <a href=https://hub.docker.com/r/example/crewing-backend target=_blank rel=noopener title=hub.docker.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M349.9 236.3h-66.1v-59.4h66.1zm0-204.3h-66.1v60.7h66.1zm78.2 144.8H362v59.4h66.1zm-156.3-72.1h-66.1v60.1h66.1zm78.1 0h-66.1v60.1h66.1zm276.8 100c-14.4-9.7-47.6-13.2-73.1-8.4-3.3-24-16.7-44.9-41.1-63.7l-14-9.3-9.3 14c-18.4 27.8-23.4 73.6-3.7 103.8-8.7 4.7-25.8 11.1-48.4 10.7H2.4c-8.7 50.8 5.8 116.8 44 162.1 37.1 43.9 92.7 66.2 165.4 66.2 157.4 0 273.9-72.5 328.4-204.2 21.4.4 67.6.1 91.3-45.2 1.5-2.5 6.6-13.2 8.5-17.1zm-511.1-27.9h-66v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1zm78.1 0h-66.1v59.4h66.1zm-78.1-72.1h-66.1v60.1h66.1z"/></svg> </a> <a href=https://crewing.slack.com target=_blank rel=noopener title=crewing.slack.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M94.1 315.1c0 25.9-21.2 47.1-47.1 47.1S0 341 0 315.1 21.2 268 47.1 268h47.1v47.1zm23.7 0c0-25.9 21.2-47.1 47.1-47.1s47.1 21.2 47.1 47.1v117.8c0 25.9-21.2 47.1-47.1 47.1s-47.1-21.2-47.1-47.1zm47.1-189c-25.9 0-47.1-21.2-47.1-47.1s21.2-47 47.1-47S212 53.2 212 79.1v47.1h-47.1zm0 23.7c25.9 0 47.1 21.2 47.1 47.1S190.8 244 164.9 244H47.1C21.2 244 0 222.8 0 196.9s21.2-47.1 47.1-47.1zm189 47.1c0-25.9 21.2-47.1 47.1-47.1s47 21.2 47 47.1-21.2 47.1-47.1 47.1h-47.1v-47.1zm-23.7 0c0 25.9-21.2 47.1-47.1 47.1S236 222.8 236 196.9V79.1c0-25.9 21.2-47.1 47.1-47.1s47.1 21.2 47.1 47.1zm-47.1 189c25.9 0 47.1 21.2 47.1 47.1s-21.2 47-47.1 47-47.1-21.2-47.1-47.1v-47.1h47.1zm0-23.7c-25.9 0-47.1-21.2-47.1-47.1s21.2-47.1 47.1-47.1h117.8c25.9 0 47.1 21.2 47.1 47.1s-21.2 47.1-47.1 47.1z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <div class=md-consent data-md-component=consent id=__consent hidden> <div class=md-consent__overlay></div> <aside class=md-consent__inner> <form class="md-consent__form md-grid md-typeset" name=consent> <h4>Cookie consent</h4> <p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for.</p> <input class=md-toggle type=checkbox id=__settings> <div class=md-consent__settings> <ul class=task-list> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=analytics checked> <span class=task-list-indicator></span> Google Analytics </label> </li> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=github checked> <span class=task-list-indicator></span> GitHub </label> </li> </ul> </div> <div class=md-consent__controls> <button class="md-button md-button--primary">Accept</button> <label class=md-button for=__settings>Manage settings</label> </div> </form> </aside> </div> <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout((function(){document.querySelector("[data-md-component=consent]").hidden=!1}),250);var form=document.forms.consent;for(var action of["submit","reset"])form.addEventListener(action,(function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map((function(e){return[e,!0]})))),location.hash="",location.reload()}))</script> <script id=__config type=application/json>{"base": "../../..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.code.select", "content.tabs.link", "content.tooltips", "header.autohide", "navigation.expand", "navigation.footer", "navigation.indexes", "navigation.instant", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.path", "navigation.prune", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow", "toc.integrate"], "search": "../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": {"API": "api", "Authentication": "auth", "Docker": "docker", "Kubernetes": "k8s", "MCP": "mcp", "TDD": "tdd", "Testing": "testing"}, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "latest", "provider": "mike"}}</script> <script src=../../../assets/javascripts/bundle.f55a23d4.min.js></script> <script src=../../../javascripts/custom.js></script> <script src=../../../javascripts/mathjax.js></script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script> </body> </html>